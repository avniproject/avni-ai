app:
  description: Avni AI Assistant integrated with webapp to help design an organisation
  icon: ðŸ¤–
  icon_background: '#FFEAD5'
  mode: advanced-chat
  name: Avni designer assistant
  use_icon_as_answer_icon: true
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/openai:0.2.7@9031bbf9b37d9f6341a20c78a8bd18d686afd3ff627545496c3557705419d084
    version: null
kind: app
version: 0.5.0
workflow:
  conversation_variables:
  - description: ''
    id: 80e10fd7-a4a9-4300-ad77-fd31a27bb86b
    name: 'True'
    selector:
    - conversation
    - 'True'
    value: true
    value_type: boolean
  - description: ''
    id: 0873be68-c224-4e79-8cf8-ce2f583d6509
    name: 'False'
    selector:
    - conversation
    - 'False'
    value: false
    value_type: boolean
  - description: ''
    id: ebacfa4e-342c-455e-a4ba-b70851015711
    name: loop
    selector:
    - conversation
    - loop
    value: true
    value_type: boolean
  environment_variables:
  - description: ''
    id: 16bf6bae-2ad7-483e-a226-add93e02d738
    name: CODE_MAX_DEPTH
    selector:
    - env
    - CODE_MAX_DEPTH
    value: '100'
    value_type: string
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        image_file_size_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ðŸ‘‹ Hey! Letâ€™s get started with configuring Avni.
    retriever_resource:
      enabled: false
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 1762509929006-source-1762500391975-target
      selected: false
      source: '1762509929006'
      sourceHandle: source
      target: '1762500391975'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: start
        targetType: if-else
      id: 1711528708197-source-1732870000001-target
      selected: false
      source: '1711528708197'
      sourceHandle: source
      target: '1732870000001'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1732870000001-true-1762509929006-target
      selected: false
      source: '1732870000001'
      sourceHandle: 'true'
      target: '1762509929006'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: knowledge-retrieval
        targetType: llm
      id: 1732870000002-source-1732870000003-target
      selected: false
      source: '1732870000002'
      sourceHandle: source
      target: '1732870000003'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 1732870000003-source-1732870000004-target
      selected: false
      source: '1732870000003'
      sourceHandle: source
      target: '1732870000004'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: knowledge-retrieval
      id: 1732870000001-7a557c49-05d9-4157-8b6b-ce31b2ed7d6a-1732870000002-target
      source: '1732870000001'
      sourceHandle: 7a557c49-05d9-4157-8b6b-ce31b2ed7d6a
      target: '1732870000002'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1732870000001-false-1762509929006-target
      source: '1732870000001'
      sourceHandle: 'false'
      target: '1762509929006'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: Define the initial parameters for launching a workflow
        selected: false
        title: Start
        type: start
        variables:
        - hide: true
          label: auth_token
          max_length: 2000
          options: []
          required: false
          type: paragraph
          variable: auth_token
        - hide: true
          label: org_name
          max_length: 200
          options: []
          required: false
          type: text-input
          variable: org_name
        - default: trial
          hide: true
          label: org_type
          max_length: 48
          options: []
          required: false
          type: text-input
          variable: org_type
        - hide: true
          hint: ''
          label: user_name
          max_length: 48
          options: []
          placeholder: ''
          required: false
          type: text-input
          variable: user_name
        - default: https://staging-mcp.avniproject.org
          hide: true
          hint: ''
          label: avni_mcp_server_url
          max_length: 48
          options: []
          placeholder: ''
          required: false
          type: text-input
          variable: avni_mcp_server_url
        - default: FormValidation
          hide: true
          hint: ''
          label: requestType
          max_length: 48
          options:
          - FormValidation
          - VisitSchedule
          placeholder: ''
          required: false
          type: select
          variable: requestType
        - default: ''
          hint: ''
          label: form_context
          max_length: 9999
          options: []
          placeholder: ''
          required: false
          type: paragraph
          variable: form_context
      height: 307
      id: '1711528708197'
      position:
        x: 352.0294910460403
        y: 721.9734915400871
      positionAbsolute:
        x: 352.0294910460403
        y: 721.9734915400871
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: '{{#1762509929006.text#}}'
        selected: false
        title: Answer
        type: answer
        variables: []
      height: 101
      id: '1762500391975'
      position:
        x: 1273.2861957817972
        y: 607.2500564925043
      positionAbsolute:
        x: 1273.2861957817972
        y: 607.2500564925043
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    - data:
        context:
          enabled: true
          variable_selector:
          - '1711528708197'
          - org_name
        model:
          completion_params:
            frequency_penalty: 0.5
            max_tokens: 100
            presence_penalty: 0.5
            response_format: text
            temperature: 0.2
            top_p: 0.75
          mode: chat
          name: gpt-4.1-nano
          provider: langgenius/openai/openai
        prompt_template:
        - id: bcaaf498-89b5-4273-bc8c-5a28f60018e1
          role: system
          text: "You are an expert Avni form element validator specialising in identifying\
            \ form issues and rule violations.\nYour task is to analyse Avni form\
            \ element JSON structures and identify all problems, violations, and issues.\n\
            \n## Avni Rules to Check:\n    \n    1. DATE FIELD VALIDATION:\n     \
            \  - Date fields should be either Date or DateTime\n       - Date dataType\
            \ is used for capturing dates other than when the current action is performed\n\
            \       - Any field named case-insensitively 'Registration date', 'Enrolment\
            \ date', 'Visit date', 'Exit date', 'Cancellation date'\n      - Any field\
            \ representing a point in time should use Date dataType\n       - Date\
            \ selection is NOT categorical selection\n\n\n    2. NEW FORM TYPES -\
            \ CANCELLATION FORMS:\n       - IndividualEncounterCancellation & ProgramEncounterCancellation\
            \ forms\n       - Cancellation reason should be MANDATORY and use Coded\
            \ dataType\n       - These forms require different validation than regular\
            \ encounters\n\n\n    3. NEW FORM TYPES - PROGRAM EXIT FORMS:\n      \
            \ - ProgramExit forms have specific requirements\n       - Exit reason\
            \ should be MANDATORY and use Coded dataType\n       - Follow-up plans\
            \ should use Text dataType (Notes is not recognised)\n\n\n    4. NAME\
            \ FIELD DETECTION:\n       - Name fields in IndividualProfile forms are\
            \ violations\n       - ANY field named 'First Name', 'Last Name', 'Name'\
            \ in IndividualProfile should be flagged\n       - These fields should\
            \ be removed\n\n\n    5. DATA TYPE COMPLIANCE:\n       - Numeric data\
            \ (Age, Weight, Height) should use Numeric dataType with bounds\n    \
            \   - Phone numbers should use PhoneNumber dataType with validation\n\
            \       - Binary questions (Yes/No) should use SingleSelect, not MultiSelect\n\
            \       - Categorical data should use Coded dataType, not Subject\n\n\n\
            \    6. FALSE POSITIVE PREVENTION:\n       - Before suggesting changes,\
            \ verify actual violation of Avni rules\n       - Don't suggest changes\
            \ to properly configured fields\n       - Focus on actual violations,\
            \ not theoretical improvements\n\n    Output Format Requirements:\n  \
            \  - Issues: JSON array with formElementUuid, formElementName, message\n\
            \    \n    Always reference specific form element UUIDs when available\
            \ so the UI can highlight exact fields needing changes.\n\nThis is the\
            \ current form context : {{#1711528708197.form_context#}}"
        - id: 609d0c40-8344-4127-b72e-a368586e079d
          role: user
          text: '{{#sys.files#}} {{#sys.query#}}'
        reasoning_format: tagged
        selected: false
        title: LLM 2
        type: llm
        vision:
          enabled: false
      height: 86
      id: '1762509929006'
      position:
        x: 942.0309443515424
        y: 598.0544291915982
      positionAbsolute:
        x: 942.0309443515424
        y: 598.0544291915982
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: empty
            id: cond1
            value: ''
            variable_selector:
            - '1711528708197'
            - requestType
          - comparison_operator: contains
            id: 17398e4a-6c23-439c-bcf6-dc68c0821d86
            value: FormValidation
            varType: string
            variable_selector:
            - '1711528708197'
            - requestType
          id: 'true'
          logical_operator: and
        - case_id: 7a557c49-05d9-4157-8b6b-ce31b2ed7d6a
          conditions:
          - comparison_operator: contains
            id: 5616159f-cdde-4331-abd4-65c4caf180c6
            value: VisitSchedule
            varType: string
            variable_selector:
            - '1711528708197'
            - requestType
          id: 7a557c49-05d9-4157-8b6b-ce31b2ed7d6a
          logical_operator: and
        logical_operator: and
        selected: false
        title: Route by Request Type
        type: if-else
      height: 196
      id: '1732870000001'
      position:
        x: 650
        y: 750
      positionAbsolute:
        x: 650
        y: 750
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    - data:
        dataset_ids:
        - PbU6BVReZ2F8Rm8JIn99UcGfvldJo3V6x0FYp4TfMA3owZBXaUbASK7kegUbSk8S
        metadata_filtering_mode: disabled
        multiple_retrieval_config:
          reranking_enable: false
          reranking_mode: weighted_score
          top_k: 4
          weights:
            keyword_setting:
              keyword_weight: 0.3
            vector_setting:
              embedding_model_name: text-embedding-3-large
              embedding_provider_name: langgenius/openai/openai
              vector_weight: 0.7
            weight_type: customized
        query_variable_selector:
        - '1711528708197'
        - sys.query
        retrieval_mode: multiple
        selected: false
        title: Knowledge Retrieval - Visit Schedule
        type: knowledge-retrieval
      height: 88
      id: '1732870000002'
      position:
        x: 950
        y: 900
      positionAbsolute:
        x: 950
        y: 900
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    - data:
        context:
          enabled: true
          variable_selector:
          - '1732870000002'
          - result
        memory:
          query_prompt_template: '{{#sys.query#}}\n\n\n            {{#sys.files#}}'
          role_prefix:
            assistant: ''
            user: ''
          window:
            enabled: true
            size: 100
        model:
          completion_params:
            max_tokens: 1000
            reasoning_effort: low
            response_format: text
            verbosity: low
          mode: chat
          name: gpt-5-nano
          provider: langgenius/openai/openai
        prompt_template:
        - id: vs-prompt-1
          role: system
          text: "# Avni Visit Scheduling Rule Generator â€” Final Production Prompt\n\
            \nYou are the world's best Avni (OpenCHS) rules engineer.\n\nYou are always\
            \ given two things:\n1. A user request (e.g. \"Schedule ANC follow-up\
            \ 28 days after current ANC visit\")\n2. Complete technical context as\
            \ JSON (encounter types, program, concepts, etc.)\n\nThis context is 100%\
            \ authoritative and always present.\n\n## Your Golden Rule\nOnly ask questions\
            \ if something is genuinely missing or ambiguous.  \nOtherwise: understand\
            \ silently and move fast.\n\n## Default Assumptions (unless contradicted)\n\
            - Trigger = completion of current encounter\n- Reference date = encounterDateTime\
            \ of current encounter\n- Flexibility window = Â±7 days (e.g., 28 days\
            \ â†’ 21â€“35 days window)\n- Next visit name = exactly as listed in context\n\
            - Stop scheduling after \"Delivery\" (pregnancy programs) or last visit\
            \ in sequence\n- Program name = \"Maternal Health\" or as specified in\
            \ context\n\n## Step-by-Step Behavior\n\n### 1. Understand (Silent)\n\
            \ Read the user request + full context JSON.\n\nIf everything is clear\
            \ (95% of cases):\nâ†’ Do NOT ask any questions\nâ†’ Do NOT say \"I understand\"\
            \ or mention phases\nâ†’ Go straight to step 2\n\nMandatorily ask if:\n\
            - Trigger is unclear (enrolment vs encounter)\n- Timing is completely\
            \ missing (e.g. \"schedule follow-up\" with no days/weeks)\n- Next visit\
            \ name is not in context\n- Conflicting info between request and context\n\
            \n### 2. Validate (Always Do This)\n\nPresent a clean MarkDown table with\
            \ 3â€“4 real-world scenarios showing exactly when the rule will trigger.\n\
            Then ask:\nDo these scenarios match exactly what you want?  \nReply **YES**\
            \ to get the final rule code, or tell me what to change.\n\nExample:\n\
            ```\n| Case                  | Trigger            | Reference Date   \
            \  | Next Visit         | Earliest   | Latest     | Will Schedule? |\n\
            |-----------------------|--------------------|--------------------|--------------------|------------|------------|----------------|\n\
            | Standard ANC visit    | ANC completed      | 2025-04-01         | ANC\
            \ - Follow Up    | 2025-04-22 | 2025-05-06 | Yes            |\n| Early\
            \ completion      | ANC on day 20      | 2025-03-20         | ANC - Follow\
            \ Up        | Today      | +14 days   | Yes            |\n| After Delivery\
            \ | Delivery recorded  | 2025-06-15         | (none)           | â€”   \
            \       | â€”          | No             |\n```\n\n\n### 3. Generate Code\
            \ (Only After User Says \"YES\")\nDeliver:\n1. Complete, clean, production-ready\
            \ JavaScript rule\n2. One-line plain English summary\n3. No extra chatter\n\
            \ Use this exact code format:\n```javascript\n\"use strict\";\n({params,\
            \ imports}) => {\n    const { entity, today } = params;\n    const builder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({entity});\n\n    //\
            \ Example: ANC to ANC Follow Up (28 days Â±7)\n    if (entity.encounterType.name\
            \ === \"ANC\") {\n        if (entity.individual.hasEncounterOfType(\"\
            \ Delivery\")) return builder.getAll();\n\n        const baseDate = entity.encounterDateTime;\n\
            \ builder.add({\n            name: \"ANC - Follow Up\",, \n          \
            \  encounterType: \"ANC - Follow Up\",\n            earliestDate: baseDate.addDays(21),\n\
            \            maxDate: baseDate.addDays(35)\n }); }\n\n    return builder.getAll();\n\
            };\n\n## Context and Technical Details\n### Use this context for technical\
            \ implementation: {{#context#}}\n### This is the current context of the\
            \ form : {{#1711528708197.form_context#}}\n### Use these examples for\
            \ reference:\n\nProgramEncounterCancellation,\"\"\"use strict\"\";\n({\
            \ params, imports }) => {\n  const programEncounter = params.entity;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\
            \ programEncounter });\n\n  const hasExitedProgram = (programEncounter)\
            \ => programEncounter.programEnrolment.programExitDateTime;\n  const isIndividualDead\
            \ = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInCancelEncounter(\"\
            \"917be636-9503-4d20-9643-aad5932b44e3\"\").containsAnswerConceptName(\"\
            \"56cb075d-1696-4bad-be94-9f7fffe9aabf\"\").matches();\n  if(hasExitedProgram(programEncounter)\
            \ || isIndividualDead) return scheduleBuilder.getAll();\n\n  const moment\
            \ = imports.moment;\n  const cancelDateTime = programEncounter.cancelDateTime;\n\
            \  const earliestVisitDateTime = programEncounter.earliestVisitDateTime;\n\
            \  const encounters = programEncounter.programEnrolment.getEncounters();\n\
            \  const uploadDate  = moment('2024-08-31').startOf('day');\n  \n  \n\
            \  function isAgeLessThanorEqualTo19(earliestDateTime) {\n\n    const\
            \ futureDate = moment(earliestDateTime).startOf('day');\n    const dateOfBirth\
            \ = moment(programEncounter.programEnrolment.individual.dateOfBirth).startOf('day');\n\
            \    const ageInYears = futureDate.diff(dateOfBirth, 'years', true);\n\
            \    return ageInYears <= 19;\n  }\n\n  function isNextVisitAlreadyScheduled(encounterType,\
            \ visitDateTime) {\n    const visitDate = moment(visitDateTime);\n   \
            \ return encounters.some(enc => enc.encounterType.name === encounterType\
            \ && moment(enc.earliestVisitDateTime).isAfter(visitDate, 'day'));\n \
            \ }\n\n  function isVisitAlreadyScheduled(encounterType, visitDateTime)\
            \ {\n    const visitDate = moment(visitDateTime);\n    return encounters.some(enc\
            \ => enc.encounterType.name === encounterType && moment(enc.earliestVisitDateTime).isSame(visitDate,\
            \ 'day'));\n  }\n\n  function findResultingCase(cases) {\n    return cases.find(caseObj\
            \ => caseObj.condition);\n  }\n\n  function calculateDates(resultingCase,\
            \ visitDateTime) {\n    let earliestDate, maxDate;\n    if (resultingCase.visitFactor\
            \ === 'months') {\n      earliestDate = resultingCase.earliestDate;\n\
            \      maxDate = resultingCase.maxDate;\n    } else {\n      earliestDate\
            \ = moment(visitDateTime).add(resultingCase.earliestFactor, resultingCase.visitFactor).toDate();\n\
            \      maxDate = moment(earliestDate).add(resultingCase.maxFactor, resultingCase.visitFactor).toDate();\n\
            \    }\n    return { earliestDate, maxDate };\n  }\n\n  function addScheduledVisit(encounterName,\
            \ encounterType, earliestDate, maxDate) {\n    if (!isVisitAlreadyScheduled(encounterType,\
            \ earliestDate) && moment(cancelDateTime).isAfter(uploadDate)) {\n   \
            \   scheduleBuilder.add({name: encounterName, encounterType: encounterType,\
            \ earliestDate, maxDate});\n    }\n  }\n\n  let anaemiaStatus = programEncounter.programEnrolment.findLatestObservationInEntireEnrolment('6cdf72fb-7885-4857-ad4c-9c26c3d65202');\n\
            \  if(anaemiaStatus) anaemiaStatus = anaemiaStatus.getValue();\n\n  let\
            \ nutritionStatus = programEncounter.programEnrolment.findLatestObservationInEntireEnrolment('a24de02c-47dd-408e-94ce-38f702805716');\n\
            \  if(nutritionStatus) nutritionStatus = nutritionStatus.getValue();\n\
            \n  let clothType = programEncounter.programEnrolment.findLatestObservationInEntireEnrolment('ca018334-640e-459d-8793-9ba382fdbdbb');\n\
            \  if(clothType) clothType = clothType.getReadableValue();\n\n  const\
            \ childFollowUpCases = [\n    {\n      name: 'Severe Anaemia',\n     \
            \ condition: anaemiaStatus == 'Severe',\n      visitFactor: 'days',\n\
            \      earliestFactor: 10,\n      maxFactor: 10 \n    },\n    {\n    \
            \  name: 'Old Cloths',\n      condition: clothType == 'Home old cloth',\n\
            \      visitFactor: 'months',\n      earliestDate: moment(earliestVisitDateTime).add(1,\
            \ 'months').date(25).toDate(),\n      maxDate: moment(earliestVisitDateTime).add(1,\
            \ 'months').date(25).add(10, 'days').toDate()\n    },\n    {\n      name:\
            \ 'Severly Underweight',\n      condition: nutritionStatus == 'Severly\
            \ Underweight',\n      visitFactor: 'days',\n      earliestFactor: 55,\n\
            \      maxFactor: 10 \n    },\n    {\n      name: 'Mild to Moderate Status\
            \ of Anaemia',\n      condition: anaemiaStatus == 'Mild' || anaemiaStatus\
            \ == 'Moderate',\n      visitFactor: 'days',\n      earliestFactor: 85,\n\
            \      maxFactor: 10 \n    },\n    {\n      name: 'Mild to Moderately\
            \ Underweight',\n      condition: nutritionStatus == 'Mildly Underweight'\
            \ || nutritionStatus == 'Moderatly Underweight',\n      visitFactor: 'days',\n\
            \      earliestFactor: 85,\n      maxFactor: 15 \n    },\n    {\n    \
            \  name: 'Normal Anaemia',\n      condition: anaemiaStatus == 'Normal',\n\
            \      visitFactor: 'days',\n      earliestFactor: 175,\n      maxFactor:\
            \ 15\n    },\n    {\n      name: 'Normal Nutrition Status',\n      condition:\
            \ nutritionStatus == 'Normal',\n      visitFactor: 'days',\n      earliestFactor:\
            \ 175,\n      maxFactor: 15\n    }\n  ];\n\n  const resultingCase = findResultingCase(childFollowUpCases);\n\
            \n  if (resultingCase && !isNextVisitAlreadyScheduled('Adolescent Followup',\
            \ earliestVisitDateTime)) {\n    \n    const { earliestDate, maxDate }\
            \ = calculateDates(resultingCase, cancelDateTime);\n    \n    if(isAgeLessThanorEqualTo19(earliestDate))\
            \ addScheduledVisit('Adolescent Followup', 'Adolescent Followup', earliestDate,\
            \ maxDate);\n  }\n\n  return scheduleBuilder.getAll();\n};\"\nProgramEnrolment,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const programEnrolment\
            \ = params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({programEnrolment});\n\
            \  \n  const isChildFollowUpAlreadyScheduled = programEnrolment.hasCompletedEncounterOfType('Adolescent\
            \ Followup');\n  const checkSchedule = programEnrolment.scheduledEncountersOfType('Adolescent\
            \ Followup').length == 0; \n  const uploadDate  = moment('2024-08-31').startOf('day');\n\
            \  \n  if(!isChildFollowUpAlreadyScheduled && checkSchedule){\n  \n  \
            \  let earliestDate = moment(programEnrolment.enrolmentDateTime).toDate();\n\
            \    const maxDate = moment(earliestDate).add(3, 'days').toDate();\n \
            \   if(moment(earliestDate).isAfter(moment(uploadDate))){\n      scheduleBuilder.add({name:\
            \ \"\"Adolescent Followup\"\", encounterType: \"\"Adolescent Followup\"\
            \", earliestDate, maxDate});  \n    }\n  }\n  \n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounterCancellation,\"\"\"use strict\"\";\n({ params, imports\
            \ }) => {\n  const programEncounter = params.entity;\n  const programEnrolment\
            \ = programEncounter.programEnrolment;\n  const moment = imports.moment;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const hasExitedProgram = (programEncounter) => programEncounter.programEnrolment.programExitDateTime;\n\
            \n  if (!hasExitedProgram(programEncounter)) {\n\n    function IsBaselineAlreadyScheduled(earliestDate){\n\
            \      const year = moment(earliestDate).year();\n      const alreadyScheduled\
            \ = programEnrolment.encounters.some((enc)=> enc.encounterType.name ===\
            \ 'Annual Visit - Baseline' && moment(enc.earliestVisitDateTime).year()\
            \ == year);\n      \n      return alreadyScheduled;\n    }\n\n    const\
            \ earliestDate = moment(programEncounter.earliestVisitDateTime).month(4).date(15).toDate();\n\
            \    const maxDate = moment(earliestDate).month(9).date(31).toDate();\n\
            \      \n    if(!IsBaselineAlreadyScheduled(earliestDate)){\n      scheduleBuilder.add({\n\
            \        name: \"\"Annual Visit - Baseline\"\",\n        encounterType:\
            \ \"\"Annual Visit - Baseline\"\",\n        earliestDate ,\n        maxDate\n\
            \      });\n    }\n  }\n  return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const programEncounter\
            \ = params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({ programEncounter });\n\
            \  const _ = imports.lodash;\n\n  const hasExitedProgram = (programEncounter)\
            \ => programEncounter.programEnrolment.programExitDateTime;\n\n  if (!hasExitedProgram(programEncounter))\
            \ {\n    const encounters = programEncounter.programEnrolment.getEncounters();\n\
            \n    const numberOfBaselineEncountersCompleted = encounters.filter(enc\
            \ => \n      enc.encounterType.name === \"\"Annual Visit - Baseline\"\"\
            \ && \n      enc.encounterDateTime != null\n    ).length;\n\n    const\
            \ numberOfEndlineEncountersCompleted = encounters.filter(enc => \n   \
            \   enc.encounterType.name === \"\"Annual Visit - Endline\"\" && \n  \
            \    enc.encounterDateTime != null\n    ).length;\n\n    const numberOfChronicSicknessEncountersCompleted\
            \ = encounters.filter(enc =>\n      enc.encounterType.name === \"\"Chronic\
            \ Sickness follow up\"\"\n    ).length;\n    \n\n  let latestComplicationsValue\
            \ = programEncounter.programEnrolment.findLatestObservationInEntireEnrolment('15ba1077-fb11-49c2-819b-79154b9df6bb').getReadableValue();\n\
            \  console.log('latestComplicationsValue------->',latestComplicationsValue)\n\
            \  console.log(_.includes(latestComplicationsValue,'No problem'));\n\n\
            \    if ( (numberOfBaselineEncountersCompleted + numberOfEndlineEncountersCompleted)\
            \ * 3 > numberOfChronicSicknessEncountersCompleted && !_.includes(latestComplicationsValue,'No\
            \ problem') ) {\n      const earliestDate = moment(programEncounter.encounterDateTime).add(30,\
            \ 'days').toDate();\n      const maxDate = moment(earliestDate).add(7,\
            \ 'days').toDate();\n      scheduleBuilder.add({\n        name: \"\"Chronic\
            \ Sickness follow up\"\",\n        encounterType: \"\"Chronic Sickness\
            \ follow up\"\",\n        earliestDate,\n        maxDate\n      });\n\
            \    }\n  }\n\n  return scheduleBuilder.getAll();\n};\"\nProgramEnrolment,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const programEnrolment\
            \ = params.entity;\n  const moment = imports.moment;\n  \n  if ( moment(programEnrolment.enrolmentDateTime).year()\
            \ > 2020 ) {\n    \n  const scheduledVisits = programEnrolment.encounters.map(item\
            \ => ({\n    earliestVisitDateTime: item.earliestVisitDateTime,\n    encounterTypeName:\
            \ item.encounterType.name\n  }));\n\n  let editFlag = true;\n  let schedulePNC\
            \ = true;\n  \n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\n\
            \    programEnrolment\n  });\n  \n  const getEarliestDate = (programEnrolment)\
            \ =>\n    moment(programEnrolment.enrolmentDateTime)\n        .startOf(\"\
            \"day\"\")\n        .toDate();\n  \nconst ageOfChildInMonths = programEnrolment.individual.getAgeInMonths();\n\
            const weightAtTimeOfDischarge = programEnrolment.getObservationReadableValue('Weight\
            \ at the time of Discharge');\n\nconst visitDate = programEnrolment.getObservationReadableValue('Date\
            \ of discharge from SNCU');\n\nif (scheduledVisits.some(item => \n  item.encounterTypeName\
            \ === 'Child Followup' )) {\n  editFlag = false;\n}\nif (scheduledVisits.some(item=>\
            \ item.encounterTypeName === 'Child PNC')){\n   schedulePNC = false;\n\
            }\n\n\nlet followupDate = moment(programEnrolment.enrolmentDateTime).toDate();\n\
            let followupMaxVisitDate = moment(followupDate).add(3, 'days').toDate();\n\
            let ageCondition = ageOfChildInMonths < 2;\n\n  if (ageCondition  && schedulePNC){\
            \         \n        scheduleBuilder.add({\n            name: 'Child PNC',\n\
            \            encounterType: 'Child PNC',\n            earliestDate: followupDate,\n\
            \            maxDate: followupMaxVisitDate\n        });\n  }else {\n \
            \     if (!ageCondition && editFlag) {\n       scheduleBuilder.add({\n\
            \            name: 'Child Followup',\n            encounterType: 'Child\
            \ Followup',\n            earliestDate: visitDate,\n            maxDate:\
            \ moment(visitDate).add(10, 'days').toDate()\n         });\n       }\n\
            \    }\n  \n  }  \n  return scheduleBuilder.getAll();\n  \n};\"\nProgramEncounterCancellation,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const _ = imports.lodash;\n\
            \  const moment = imports.moment;\n  const programEncounter = params.entity;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\n\
            \    programEncounter\n  });\n  \n  const hasExitedProgram = programEncounter\
            \ => programEncounter.programEnrolment.programExitDateTime;\n  \n  const\
            \ getEarliestEncounterDate = (programEncounter) =>\n    moment(programEncounter.earliestVisitDateTime)\n\
            \        .startOf(\"\"day\"\")\n        .toDate();\n        \n  let visitDate\
            \ = programEncounter.encounterDateTime || getEarliestEncounterDate(programEncounter);\n\
            \  let firstVisitDate = programEncounter.programEnrolment.enrolmentDateTime;\n\
            \n  \n  const nutritionalStatus = programEncounter.programEnrolment.getObservationReadableValueInEntireEnrolment('Nutritional\
            \ status of child') || programEncounter.programEnrolment.getObservationReadableValueInEntireEnrolment('Current\
            \ nutritional status according to weight and age');\n  \nconst currentWeight\
            \ = programEncounter.programEnrolment.getObservationReadableValueInEntireEnrolment('Weight')\
            \ || \n                      programEncounter.programEnrolment.getObservationReadableValue('Weight\
            \ at the time of Discharge');\n;\nconst ageOfChildInMonths = programEncounter.programEnrolment.individual.getAgeInMonths();\n\
            \nconst reasonForCancelIsChildNotAtHome = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInCancelEncounter(\"\
            \"0066a0f7-c087-40f4-ae44-a3e931967767\"\").containsAnswerConceptName(\"\
            \"3b434393-f572-412e-bc9d-f317d0e67833\"\").matches();\n\nif (reasonForCancelIsChildNotAtHome)\
            \ {\n    \n        scheduleBuilder.add({\n                  name: programEncounter.encounterType.name,\n\
            \                  encounterType: programEncounter.encounterType.name,\n\
            \                  earliestDate: moment(programEncounter.cancelDateTime).add(7,'days').toDate(),\n\
            \                  maxDate: moment(programEncounter.cancelDateTime).add(11,'days').toDate()\n\
            \            });\n\n      return scheduleBuilder.getAll();\n    };\n\n\
            const encounterScheduleChildFollowup = [\n    {\"\"name\"\": \"\"Child\
            \ Followup-1\"\", \"\"earliest\"\": 110, \"\"max\"\": 10},\n    {\"\"\
            name\"\": \"\"Child Followup-2\"\", \"\"earliest\"\": 160, \"\"max\"\"\
            : 8}\n];\n\n const encounterScheduleChildPNC = [\n    {\"\"name\"\": \"\
            \"Child PNC 1\"\", \"\"earliest\"\": 0, \"\"max\"\": 8},\n    {\"\"name\"\
            \": \"\"Child PNC 2\"\", \"\"earliest\"\": 28, \"\"max\"\": 36},\n   \
            \ {\"\"name\"\": \"\"Child PNC 3\"\", \"\"earliest\"\": 50, \"\"max\"\"\
            : 61}\n];\n\nconst scheduleChildPNCVisitsNormal = () => {\n\n    var schedule\
            \ = _.chain(encounterScheduleChildPNC)\n        .filter(e => moment(visitDate)\n\
            \        .isBefore(moment(firstVisitDate).add(e.earliest, 'days').toDate(),\
            \ 'date') === true)\n        .filter(e => (programEncounter.programEnrolment.hasEncounter('Child\
            \ PNC', e.name)) === false)\n        .first()\n        .value();\n   \
            \     \n    if (!_.isEmpty(schedule)) {\n        const followupDate =\
            \ moment(firstVisitDate).add(schedule.earliest, 'days').toDate();\n  \
            \      const followupOverdueDate = moment(followupDate).add(schedule.max,\
            \ 'days').toDate();\n\n        scheduleBuilder.add({\n            name:\
            \ schedule.name,\n            encounterType: 'Child PNC',\n          \
            \  earliestDate: followupDate,\n            maxDate: followupOverdueDate\n\
            \        });\n    }else{\n          //Schedule Followup\n          scheduleChildFollowupVisit();\n\
            \    }\n};\n\nconst scheduleChildPNCVisitsLowBirthWeight = () => {\n \
            \          \n        let earliestOffset = 7;\n        let visitCount =\
            \ 0;\n        do {\n            visitCount++;\n            earliestOffset\
            \ = 7 * visitCount;\n            \n            \n        } while (!(moment(programEncounter.earliestVisitDateTime)\n\
            \        .isBefore(moment(firstVisitDate).add(earliestOffset, 'days').toDate(),\
            \ 'date')));\n        \n        const followupDate = moment(firstVisitDate).add(earliestOffset,\
            \ 'days').toDate();\n        const followupOverdueDate = moment(followupDate).add(4,\
            \ 'days').toDate();\n\n        scheduleBuilder.add({\n               \
            \ name: 'Child PNC',\n                encounterType: 'Child PNC',\n  \
            \              earliestDate: followupDate,\n                maxDate: followupOverdueDate\n\
            \        });    \n};\n\nconst scheduleChildFollowupVisit = () => {   \
            \        \n        if(programEncounter.programEnrolment.hasEncounterOfType('Child\
            \ Followup') === false){\n        \n        const followupDate = moment(firstVisitDate).add(110,\
            \ 'days').toDate();\n        const followupOverdueDate = moment(followupDate).add(10,\
            \ 'days').toDate();\n\n          scheduleBuilder.add({\n             \
            \   name: 'Child Followup',\n                encounterType: 'Child Followup',\n\
            \                earliestDate: followupDate,\n                maxDate:\
            \ followupOverdueDate\n                });         \n        }\n};\n\n\
            const scheduleVisitsDuringChildPNC = () => {\nif (!hasExitedProgram(programEncounter))\
            \ {\n       \n         //Schedule PNCs\n        if (ageOfChildInMonths\
            \ < 2){\n          if (currentWeight < 2){\n          scheduleChildPNCVisitsLowBirthWeight();}\n\
            \        else {\n           scheduleChildPNCVisitsNormal();}\n       \
            \ }\n        else{\n          //Schedule Followup\n          scheduleChildFollowupVisit();\n\
            \        }        \n    }\n};\n\nconst scheduleFollowupVisitsDuringFollowupForLowBirthWeight\
            \ = () => {\n                 \n     let earliestOffset = 14;\n      \
            \  let visitCount = 0;\n        do {\n            visitCount++;\n    \
            \        earliestOffset = 14 * visitCount;\n        } while (!(moment(programEncounter.earliestVisitDateTime)\n\
            \        .isSameOrBefore(moment(firstVisitDate).add(earliestOffset, 'days').toDate(),\
            \ 'date')));\n        \n        const followupDate = moment(firstVisitDate).add(earliestOffset,\
            \ 'days').toDate();\n        const followupOverdueDate = moment(followupDate).add(4,\
            \ 'days').toDate();\n\n       scheduleBuilder.add({\n                name:\
            \ 'Child Followup',\n                encounterType: 'Child Followup',\n\
            \                earliestDate: followupDate,\n                maxDate:\
            \ followupOverdueDate\n            });\n    \n};\n\nconst scheduleFollowupVisitsDuringFollowup\
            \ = () => {\n\n    var schedule = _.chain(encounterScheduleChildFollowup)\n\
            \        .filter(e => moment(visitDate)\n        .isSameOrBefore(moment(firstVisitDate).add(e.earliest,\
            \ 'days').toDate(), 'date') === true)\n        .filter(e => (programEncounter.programEnrolment.hasEncounter('Child\
            \ Followup', e.name)) === false)\n        .first()\n        .value();\n\
            \n    if (!_.isEmpty(schedule)) {\n        const followupDate = moment(firstVisitDate).add(schedule.earliest,\
            \ 'days').toDate();\n        const followupOverdueDate = moment(followupDate).add(schedule.max,\
            \ 'days').toDate();\n\n        scheduleBuilder.add({\n               \
            \ name: schedule.name,\n                encounterType: 'Child Followup',\n\
            \                earliestDate: followupDate,\n                maxDate:\
            \ followupOverdueDate\n            });\n    }else {\n            \n  \
            \          const earliest = [225, 315, 405, 495, 585, 705];\n\n      \
            \          let earliestOffset = _.chain(earliest)\n                  \
            \  .filter(e => (moment(visitDate)\n                    .isBefore(moment(firstVisitDate).add(e,\
            \ 'days').toDate(), 'date') === true)\n                    && (moment(programEncounter.earliestVisitDateTime)\n\
            \                    .isSame(moment(firstVisitDate).add(e, 'days').toDate(),\
            \ 'date') === false))\n                    .first()\n                \
            \    .value();\n                   \n                const followupVisitDate\
            \ = moment(firstVisitDate).add(earliestOffset, 'days').toDate();\n   \
            \     \n                scheduleBuilder.add({\n                    name:\
            \ 'Child Followup',\n                    encounterType: 'Child Followup',\n\
            \                    earliestDate: followupVisitDate,\n              \
            \      maxDate: moment(followupVisitDate).add(15, 'days').toDate()\n \
            \                 }); \n               }  \n};\n\n\nconst scheduleVisitsDuringChildFollowupNormal\
            \ = () => {\n   \n       if (!hasExitedProgram(programEncounter)) {\n\
            \       if (ageOfChildInMonths <= 60) { \n                    \n     \
            \       const earliest = [225, 315, 405, 495, 585, 705];\n\n         \
            \       let earliestOffset = _.chain(earliest)\n                    .filter(e\
            \ => (moment(visitDate)\n                    .isBefore(moment(firstVisitDate).add(e,\
            \ 'days').toDate(), 'date') === true)\n                    && (moment(programEncounter.earliestVisitDateTime)\n\
            \                    .isSame(moment(firstVisitDate).add(e, 'days').toDate(),\
            \ 'date') === false))\n                    .first()\n                \
            \    .value();\n\n           \n           if(!_.isEqual(earliestOffset,undefined)\
            \ && ageOfChildInMonths < 24){         \n                const followupVisitDate\
            \ = moment(firstVisitDate).add(earliestOffset, 'days').toDate();\n   \
            \     \n                scheduleBuilder.add({\n                    name:\
            \ 'Child Followup',\n                    encounterType: 'Child Followup',\n\
            \                    earliestDate: followupVisitDate,\n              \
            \      maxDate: moment(followupVisitDate).add(15, 'days').toDate()\n \
            \                 }); \n             }else {\n                const followupDate\
            \ = moment(visitDate).add(6, 'months').toDate();\n                scheduleBuilder.add({\n\
            \                        name: 'Child Followup',\n                   \
            \     encounterType: 'Child Followup',\n                        earliestDate:\
            \ followupDate,\n                        maxDate: moment(followupDate).add(15,\
            \ 'days').toDate()\n                });\n             } \n       }\n \
            \    }\n};\n    \n    \nconst scheduleVisitsDuringChildFollowupSAM = ()\
            \ => {\n    \n    if (!hasExitedProgram(programEncounter)) {\n       \
            \ if (ageOfChildInMonths <= 24) { \n                         \n      \
            \       const followupDate = moment(visitDate).add(15, 'days').toDate();\n\
            \             const followupOverdueDate = moment(followupDate).add(15,\
            \ 'days').toDate();\n\n             scheduleBuilder.add({\n          \
            \        name: 'Child Followup',\n                  encounterType: 'Child\
            \ Followup',\n                  earliestDate: followupDate,\n        \
            \          maxDate: followupOverdueDate\n            });\n           \
            \         \n        } else if (ageOfChildInMonths <= 60) { \n        \
            \   \n             const followupDate = moment(visitDate).add(1, 'months').toDate();\n\
            \             const followupOverdueDate = moment(followupDate).add(15,\
            \ 'days').toDate();\n\n             scheduleBuilder.add({\n          \
            \        name: 'Child Followup',\n                  encounterType: 'Child\
            \ Followup',\n                  earliestDate: followupDate,\n        \
            \          maxDate: followupOverdueDate\n            });\n        }  \
            \      \n    }\n};\n\nconst scheduleVisitsDuringChildFollowupMAM = ()\
            \ => {\n   \n    if (!hasExitedProgram(programEncounter)) {\n        if\
            \ (ageOfChildInMonths <= 24) { \n          \n            const followupDate\
            \ = moment(visitDate).add(1, 'months').toDate();\n            const followupOverdueDate\
            \ = moment(followupDate).add(15, 'days').toDate();\n\n             scheduleBuilder.add({\n\
            \                  name: 'Child Followup',\n                  encounterType:\
            \ 'Child Followup',\n                  earliestDate: followupDate,\n \
            \                 maxDate: followupOverdueDate\n            });\n    \
            \    \n        } else if (ageOfChildInMonths <= 60) {\n             const\
            \ followupDate = moment(visitDate).add(3, 'months').toDate();\n      \
            \       const followupOverdueDate = moment(followupDate).add(15, 'days').toDate();\n\
            \n             scheduleBuilder.add({\n                  name: 'Child Followup',\n\
            \                  encounterType: 'Child Followup',\n                \
            \  earliestDate: followupDate,\n                  maxDate: followupOverdueDate\n\
            \            });\n        }\n    }\n};\n\n\n\nconst scheduleVisitsDuringChildFollowup\
            \ = () => {\n   if (ageOfChildInMonths < 6) {           \n        if(currentWeight\
            \ < 2 && ageOfChildInMonths < 2)\n              scheduleFollowupVisitsDuringFollowupForLowBirthWeight();\n\
            \        else \n              scheduleFollowupVisitsDuringFollowup();\
            \              \n        }else{            \n            switch (nutritionalStatus)\
            \ {\n        case 'Normal':\n            scheduleVisitsDuringChildFollowupNormal();\n\
            \            break;\n        case 'SAM' :\n        case 'Severely Underweight':\n\
            \            scheduleVisitsDuringChildFollowupSAM();\n            break;\n\
            \        case 'MAM' :\n        case 'Moderately Underweight':\n      \
            \      scheduleVisitsDuringChildFollowupMAM();\n            break;\n \
            \       }\n      }\n};\n\n   if (!hasExitedProgram(programEncounter) &&\
            \ !_.includes([\"\"Child Death\"\", \"\"Permanent Migration\"\"], programEncounter.findCancelEncounterObservationReadableValue(\"\
            \"Visit cancel reason\"\"))) {\n            switch (programEncounter.encounterType.name)\
            \ {\n                case 'Child PNC':\n                    scheduleVisitsDuringChildPNC();\n\
            \                    break;\n                case 'Child Followup':\n\
            \                    scheduleVisitsDuringChildFollowup();\n          \
            \          break;\n            }\n        }\n    if (programEncounter.getObservationReadableValue('0066a0f7-c087-40f4-ae44-a3e931967767')\
            \ == 'Child not at home') {\n        if (programEncounter.encounterType\
            \ === 'Child Followup') {\n            scheduleBuilder.add({\n       \
            \           name: 'Child Followup',\n                  encounterType:\
            \ 'Child Followup',\n                  earliestDate: moment(programEncounter.cancelDateTime).add(7,'days').toDate(),\n\
            \                  maxDate: moment(programEncounter.cancelDateTime).add(11,'days').toDate()\n\
            \            });\n        } else if (programEncounter.encounterType ===\
            \ 'Child PNC') {\n            scheduleBuilder.add({\n                \
            \  name: 'Child PNC',\n                  encounterType: 'Child PNC',\n\
            \                  earliestDate: moment(programEncounter.cancelDateTime).add(7,'days').toDate(),\n\
            \                  maxDate: moment(programEncounter.cancelDateTime).add(11,'days').toDate()\n\
            \            });\n        }\n    }\n\n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounter,\"\"\"use strict\"\";\n({ params, imports }) =>\
            \ {\n  const programEncounter = params.entity;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({ programEncounter });\n\
            \n  const hasExitedProgram = (programEncounter) => programEncounter.programEnrolment.programExitDateTime;\n\
            \  if(hasExitedProgram(programEncounter)) return scheduleBuilder.getAll();\n\
            \  \n  const moment = imports.moment;\n  const encounterDateTime = programEncounter.encounterDateTime;\n\
            \  const earliestVisitDateTime = programEncounter.earliestVisitDateTime;\n\
            \  const encounters = programEncounter.programEnrolment.getEncounters();\n\
            \  const uploadDate  = moment('2024-08-31').startOf('day');\n\n\n  function\
            \ isAgeLessThanorEqualTo19(earliestDateTime) {\n\n    const futureDate\
            \ = moment(earliestDateTime).startOf('day');\n    const dateOfBirth =\
            \ moment(programEncounter.programEnrolment.individual.dateOfBirth).startOf('day');\n\
            \    const ageInYears = futureDate.diff(dateOfBirth, 'years', true);\n\
            \    return ageInYears <= 19;\n  }\n  \n  function isNextVisitAlreadyScheduled(encounterType,\
            \ visitDateTime) {\n    const visitDate = moment(visitDateTime);\n   \
            \ return encounters.some(enc => enc.encounterType.name === encounterType\
            \ && moment(enc.earliestVisitDateTime).isAfter(visitDate, 'day'));\n \
            \ }\n\n  function isVisitAlreadyScheduled(encounterType, visitDateTime)\
            \ {\n    const visitDate = moment(visitDateTime);\n    return encounters.some(enc\
            \ => enc.encounterType.name === encounterType && moment(enc.earliestVisitDateTime).isSame(visitDate,\
            \ 'day'));\n  }\n\n  function findResultingCase(cases) {\n    return cases.find(caseObj\
            \ => caseObj.condition);\n  }\n\n  function calculateDates(resultingCase,\
            \ visitDateTime) {\n    let earliestDate, maxDate;\n    if (resultingCase.visitFactor\
            \ === 'months') {\n      earliestDate = resultingCase.earliestDate;\n\
            \      maxDate = resultingCase.maxDate;\n    } else {\n      earliestDate\
            \ = moment(visitDateTime).add(resultingCase.earliestFactor, resultingCase.visitFactor).toDate();\n\
            \      maxDate = moment(earliestDate).add(resultingCase.maxFactor, resultingCase.visitFactor).toDate();\n\
            \    }\n    return { earliestDate, maxDate };\n  }\n\n  function addScheduledVisit(encounterName,\
            \ encounterType, earliestDate, maxDate) {\n    if (!isVisitAlreadyScheduled(encounterType,\
            \ earliestDate) && moment(encounterDateTime).isAfter(moment(uploadDate)))\
            \ {\n      scheduleBuilder.add({name: encounterName, encounterType: encounterType,\
            \ earliestDate, maxDate});\n    }\n  }\n\n  const childFollowUpCases =\
            \ [\n    {\n      name: 'Severe Anaemia',\n      condition: new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"\
            \"6cdf72fb-7885-4857-ad4c-9c26c3d65202\"\").equals(\"\"Severe\"\").matches(),\n\
            \      visitFactor: 'days',\n      earliestFactor: 10,\n      maxFactor:\
            \ 10 \n    },\n    {\n      name: 'Old Cloths',\n      condition: new\
            \ imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"\
            \"ca018334-640e-459d-8793-9ba382fdbdbb\"\").containsAnswerConceptName(\"\
            \"57e69915-ecfe-4e24-9c75-edf680ddee34\"\").matches(),\n      visitFactor:\
            \ 'months',\n      earliestDate: moment(earliestVisitDateTime).add(1,\
            \ 'months').date(25).toDate(),\n      maxDate: moment(earliestVisitDateTime).add(1,\
            \ 'months').date(25).add(10, 'days').toDate()\n    },\n    {\n      name:\
            \ 'Severly Underweight',\n      condition: new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"\
            \"a24de02c-47dd-408e-94ce-38f702805716\"\").equals(\"\"Severly Underweight\"\
            \").matches(),\n      visitFactor: 'days',\n      earliestFactor: 55,\n\
            \      maxFactor: 10 \n    },\n    {\n      name: 'Mild to Moderate Status\
            \ of Anaemia',\n      condition: new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"\
            \"6cdf72fb-7885-4857-ad4c-9c26c3d65202\"\").equals(\"\"Mild\"\").or.when.valueInEncounter(\"\
            \"6cdf72fb-7885-4857-ad4c-9c26c3d65202\"\").equals(\"\"Moderate\"\").matches(),\n\
            \      visitFactor: 'days',\n      earliestFactor: 85,\n      maxFactor:\
            \ 10 \n    },\n    {\n      name: 'Mild to Moderately Underweight',\n\
            \      condition: new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"\
            \"a24de02c-47dd-408e-94ce-38f702805716\"\").equals(\"\"Mildly Underweight\"\
            \").or.when.valueInEncounter(\"\"a24de02c-47dd-408e-94ce-38f702805716\"\
            \").equals(\"\"Moderatly Underweight\"\").matches(),\n      visitFactor:\
            \ 'days',\n      earliestFactor: 85,\n      maxFactor: 15 \n    },\n \
            \   {\n      name: 'Normal Anaemia',\n      condition: new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"\
            \"6cdf72fb-7885-4857-ad4c-9c26c3d65202\"\").equals(\"\"Normal\"\").matches(),\n\
            \      visitFactor: 'days',\n      earliestFactor: 175,\n      maxFactor:\
            \ 15\n    },\n    {\n      name: 'Normal Nutrition Status',\n      condition:\
            \ new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"\
            \"a24de02c-47dd-408e-94ce-38f702805716\"\").equals(\"\"Normal\"\").matches(),\n\
            \      visitFactor: 'days',\n      earliestFactor: 175,\n      maxFactor:\
            \ 15\n    }\n  ];\n\n  const resultingCase = findResultingCase(childFollowUpCases);\n\
            \n  if (resultingCase && !isNextVisitAlreadyScheduled('Adolescent Followup',\
            \ programEncounter.earliestVisitDateTime)) {\n  \n    const { earliestDate,\
            \ maxDate } = calculateDates(resultingCase, encounterDateTime);\n\n  \
            \  if(isAgeLessThanorEqualTo19(earliestDate) ) addScheduledVisit('Adolescent\
            \ Followup', 'Adolescent Followup', earliestDate, maxDate);\n  }\n\n \
            \ return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\"\"use strict\"\
            \";\n({params, imports}) => {\n    const _ = imports.lodash;\n    const\
            \ moment = imports.moment;\n    const programEncounter = params.entity;\n\
            \    const programEnrolment = programEncounter.programEnrolment;\n\n \
            \   if ( moment(programEnrolment.enrolmentDateTime).year() > 2020 ) {\n\
            \n    const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\n\
            \        programEncounter\n    });\n    const hasExitedProgram = programEncounter\
            \ => programEnrolment.programExitDateTime;\n\n    const visitDate = programEncounter.encounterDateTime;\n\
            \n    const enrolmentDate = programEnrolment.enrolmentDateTime;\n\n  \
            \  const nutritionalStatus = programEncounter\n        .getObservationReadableValue('Nutritional\
            \ status of child') || programEncounter\n        .getObservationReadableValue('Current\
            \ nutritional status according to weight and age');\n\n    const encounterScheduleChildFollowup\
            \ = [\n        {\"\"name\"\": \"\"Child Followup-1\"\", \"\"earliest\"\
            \": 110, \"\"max\"\": 10},\n        {\"\"name\"\": \"\"Child Followup-2\"\
            \", \"\"earliest\"\": 160, \"\"max\"\": 8}\n    ];\n    const ageOfChildInMonths\
            \ = programEnrolment.individual.getAgeInMonths();\n    const currentWeight\
            \ = programEncounter.getObservationReadableValue('Weight');\n\n    const\
            \ scheduleFollowupVisitsDuringFollowupForLowBirthWeight = () => {\n  \
            \      let earliestOffset = 7;\n        let visitCount = 0;\n        do\
            \ {\n            visitCount++;\n            earliestOffset = 7 * visitCount;\n\
            \        } while (moment(programEncounter.earliestVisitDateTime).isSameOrAfter(moment(enrolmentDate).add(earliestOffset,\
            \ 'days').toDate(), 'date'));\n        const followupDate = moment(enrolmentDate).add(earliestOffset,\
            \ 'days').toDate();\n        const followupOverdueDate = moment(followupDate).add(4,\
            \ 'days').toDate();\n\n        scheduleBuilder.add({\n            name:\
            \ 'Child Followup',\n            encounterType: 'Child Followup',\n  \
            \          earliestDate: followupDate,\n            maxDate: followupOverdueDate\n\
            \        });\n    };\n    const scheduleFollowupVisitsDuringFollowup =\
            \ () => {\n        var schedule = _.chain(encounterScheduleChildFollowup)\n\
            \            .filter(e => moment(visitDate)\n                .isSameOrBefore(moment(enrolmentDate).add(e.earliest,\
            \ 'days').toDate(), 'date') === true)\n            .filter(e => (programEnrolment.hasEncounter('Child\
            \ Followup', e.name)) === false)\n            .first()\n            .value();\n\
            \        if (!_.isEmpty(schedule)) {\n            const followupDate =\
            \ moment(enrolmentDate).add(schedule.earliest, 'days').toDate();\n   \
            \         const followupOverdueDate = moment(followupDate).add(schedule.max,\
            \ 'days').toDate();\n            scheduleBuilder.add({\n             \
            \   name: schedule.name,\n                encounterType: 'Child Followup',\n\
            \                earliestDate: followupDate,\n                maxDate:\
            \ followupOverdueDate\n            });\n        } else {\n           \
            \ const earliest = [225, 315, 405, 495, 585, 705];\n            let earliestOffset\
            \ = _.chain(earliest)\n                .filter(e => (moment(visitDate)\n\
            \                    .isBefore(moment(enrolmentDate).add(e, 'days').toDate(),\
            \ 'date') === true) && (moment(programEncounter.earliestVisitDateTime)\n\
            \                    .isSame(moment(enrolmentDate).add(e, 'days').toDate(),\
            \ 'date') === false))\n                .first()\n                .value();\n\
            \            const followupVisitDate = moment(enrolmentDate).add(earliestOffset,\
            \ 'days').toDate();\n            scheduleBuilder.add({\n             \
            \   name: 'Child Followup',\n                encounterType: 'Child Followup',\n\
            \                earliestDate: followupVisitDate,\n                maxDate:\
            \ moment(followupVisitDate).add(15, 'days').toDate()\n            });\n\
            \        }\n    };\n    const scheduleVisitsDuringChildFollowupNormal\
            \ = () => {\n        if (ageOfChildInMonths <= 60) {\n            const\
            \ earliest = [225, 315, 405, 495, 585, 705];\n            let earliestOffset\
            \ = _.chain(earliest)\n                .filter(e => (moment(visitDate)\n\
            \                    .isBefore(moment(enrolmentDate).add(e, 'days').toDate(),\
            \ 'date') === true) && (moment(programEncounter.earliestVisitDateTime)\n\
            \                    .isSame(moment(enrolmentDate).add(e, 'days').toDate(),\
            \ 'date') === false))\n                .first()\n                .value();\n\
            \            if (!_.isEqual(earliestOffset, undefined) && ageOfChildInMonths\
            \ < 24) {\n                const followupVisitDate = moment(enrolmentDate).add(earliestOffset,\
            \ 'days').toDate();\n                scheduleBuilder.add({\n         \
            \           name: 'Child Followup',\n                    encounterType:\
            \ 'Child Followup',\n                    earliestDate: followupVisitDate,\n\
            \                    maxDate: moment(followupVisitDate).add(15, 'days').toDate()\n\
            \                });\n                console.log(\"\"he\"\", scheduleBuilder);\n\
            \            } else {\n                const followupDate = moment(visitDate).add(6,\
            \ 'months').toDate();\n                scheduleBuilder.add({\n       \
            \             name: 'Child Followup',\n                    encounterType:\
            \ 'Child Followup',\n                    earliestDate: followupDate,\n\
            \                    maxDate: moment(followupDate).add(15, 'days').toDate()\n\
            \                });\n            }\n        }\n    };\n    const scheduleVisitsDuringChildFollowupSAM\
            \ = () => {\n\n        if (ageOfChildInMonths <= 24) {\n            const\
            \ followupDate = moment(visitDate).add(15, 'days').toDate();\n\n     \
            \       const followupOverdueDate = moment(followupDate).add(15, 'days').toDate();\n\
            \            scheduleBuilder.add({\n                name: 'Child Followup',\n\
            \                encounterType: 'Child Followup',\n                earliestDate:\
            \ followupDate,\n                maxDate: followupOverdueDate\n      \
            \      });\n        } else if (ageOfChildInMonths <= 60) {\n         \
            \   const followupDate = moment(visitDate).add(1, 'months').toDate();\n\
            \            const followupOverdueDate = moment(followupDate).add(15,\
            \ 'days').toDate();\n            scheduleBuilder.add({\n             \
            \   name: 'Child Followup',\n                encounterType: 'Child Followup',\n\
            \                earliestDate: followupDate,\n                maxDate:\
            \ followupOverdueDate\n            });\n        }\n    };\n    const scheduleVisitsDuringChildFollowupMAM\
            \ = () => {\n        if (ageOfChildInMonths <= 24) {\n            const\
            \ followupDate = moment(visitDate).add(1, 'months').toDate();\n      \
            \      const followupOverdueDate = moment(followupDate).add(15, 'days').toDate();\n\
            \            scheduleBuilder.add({\n                name: 'Child Followup',\n\
            \                encounterType: 'Child Followup',\n                earliestDate:\
            \ followupDate,\n                maxDate: followupOverdueDate\n      \
            \      });\n        } else if (ageOfChildInMonths <= 60) {\n         \
            \   const followupDate = moment(visitDate).add(3, 'months').toDate();\n\
            \            const followupOverdueDate = moment(followupDate).add(15,\
            \ 'days').toDate();\n            scheduleBuilder.add({\n             \
            \   name: 'Child Followup',\n                encounterType: 'Child Followup',\n\
            \                earliestDate: followupDate,\n                maxDate:\
            \ followupOverdueDate\n            });\n        }\n    };\n\n    if (ageOfChildInMonths\
            \ < 6) {\n        if (currentWeight < 2) scheduleFollowupVisitsDuringFollowupForLowBirthWeight();\n\
            \        else scheduleFollowupVisitsDuringFollowup();\n    } else {\n\
            \        if (!hasExitedProgram(programEncounter)) {\n            switch\
            \ (nutritionalStatus) {\n                case 'Normal':\n            \
            \        scheduleVisitsDuringChildFollowupNormal();\n                \
            \    break;\n                case 'SAM' :\n                case 'Severely\
            \ Underweight':\n                    scheduleVisitsDuringChildFollowupSAM();\n\
            \                    break;\n                case 'MAM' :\n          \
            \      case 'Moderately Underweight':\n                    scheduleVisitsDuringChildFollowupMAM();\n\
            \                    break;\n            }\n        }\n    }\n    console.log(\"\
            \"he1\"\", scheduleBuilder);\n\n}\n    return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounter,\"\"\"use strict\"\";\n({params, imports}) => {\n\
            \    const programEncounter = params.entity;\n    const moment = imports.moment;\n\
            \    \n    if ( moment(programEncounter.programEnrolment.enrolmentDateTime).year()\
            \ > 2020 ) {\n    \n    const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\n\
            \        programEncounter\n    });\n    const hasExitedProgram = programEncounter\
            \ => programEncounter.programEnrolment.programExitDateTime;\n\n\n    const\
            \ currentWeight = programEncounter.getObservationReadableValue('Weight');\n\
            \n    const ageOfChildInMonths = programEncounter.programEnrolment.individual.getAgeInMonths();\n\
            \    let earliestVisitDateTime = programEncounter.earliestVisitDateTime;\n\
            \    let firstVisitDate = programEncounter.programEnrolment.enrolmentDateTime;\n\
            \n\n    const scheduleChildPNCVisitsNormal = () => {\n        const followupDate\
            \ = moment(earliestVisitDateTime).add(28, 'days').toDate();\n        const\
            \ followupOverdueDate = moment(followupDate).add(7, 'days').toDate();\
            \  \n        \n        const ageOfChildOnFollowupDate = programEncounter.programEnrolment.individual.getAgeInMonths(followupDate);\n\
            \        \n        if (ageOfChildOnFollowupDate < 2) \n            scheduleBuilder.add({\n\
            \                name: 'Child PNC',\n                encounterType: 'Child\
            \ PNC',\n                earliestDate: followupDate,\n               \
            \ maxDate: followupOverdueDate\n            });\n        else \n     \
            \       scheduleChildFollowupVisit();\n    };\n\n    const scheduleChildPNCVisitsLowBirthWeight\
            \ = () => {\n        const followupDate = moment(programEncounter.earliestVisitDateTime).add(14,\
            \ 'days').toDate();\n        const followupOverdueDate = moment(followupDate).add(4,\
            \ 'days').toDate();\n        const ageOfChildOnFollowupDate = programEncounter.programEnrolment.individual.getAgeInMonths(followupDate);\n\
            \        console.log(\"\"ageOfChildOnFollowupDate\"\", programEncounter.programEnrolment.individual.getAgeInMonths(followupDate),\
            \ programEncounter.programEnrolment.individual.getAgeInMonths());\n  \
            \      if (ageOfChildOnFollowupDate < 2) \n            scheduleBuilder.add({\n\
            \                name: 'Child PNC',\n                encounterType: 'Child\
            \ PNC',\n                earliestDate: followupDate,\n               \
            \ maxDate: followupOverdueDate\n            });\n        else\n      \
            \      scheduleChildFollowupVisit();\n    };\n\n    const scheduleChildFollowupVisit\
            \ = () => {\n        if (programEncounter.programEnrolment.hasEncounterOfType('Child\
            \ Followup') === false) {\n\n            const followupDate = moment(firstVisitDate).add(110,\
            \ 'days').toDate();\n            const followupOverdueDate = moment(followupDate).add(10,\
            \ 'days').toDate();\n\n            scheduleBuilder.add({\n           \
            \     name: 'Child Followup',\n                encounterType: 'Child Followup',\n\
            \                earliestDate: followupDate,\n                maxDate:\
            \ followupOverdueDate\n            });\n        }\n    };\n\n\n    if\
            \ (!hasExitedProgram(programEncounter)) {\n        if (currentWeight <\
            \ 3 && ageOfChildInMonths < 2) {\n            scheduleChildPNCVisitsLowBirthWeight();\n\
            \        }\n        else if (currentWeight >= 3 && ageOfChildInMonths\
            \ < 2) {\n            scheduleChildPNCVisitsNormal();\n        }\n   \
            \     else {\n          scheduleChildFollowupVisit();\n        }\n   \
            \ }\n\n}\n    return scheduleBuilder.getAll();\n};\"\nProgramEnrolment,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const programEnrolment\
            \ = params.entity;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\
            \ programEnrolment });\n  const moment = imports.moment;\n\n  const isBaselineVisitNotCompleted\
            \ = !programEnrolment.hasCompletedEncounterOfType(\"\"Annual Visit - Baseline\"\
            \");\n\n  if (isBaselineVisitNotCompleted) {\n    const earliestDate =\
            \ moment(programEnrolment.enrolmentDateTime).add(0, 'days').toDate();\n\
            \    const maxDate = moment(earliestDate).month(9).date(31).toDate();\n\
            \    scheduleBuilder.add({\n      name: \"\"Annual Visit - Baseline\"\"\
            ,\n      encounterType: \"\"Annual Visit - Baseline\"\",\n      earliestDate,\n\
            \      maxDate\n    });\n  }\n\n  return scheduleBuilder.getAll();\n };\"\
            \nProgramEncounterCancellation,\"\"\"use strict\"\";\n({ params, imports\
            \ }) => {\n  const programEncounter = params.entity;\n  const moment =\
            \ imports.moment;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const encounterType = programEncounter.encounterType.name;\n\n\
            \  const isActiveInProgram = !programEncounter.programEnrolment.programExitDateTime;\n\
            \  \n  let deliveryEncounters = programEncounter.programEnrolment.getEncountersOfType('Delivery');\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInCancelEncounter(\"\
            \"e19ded48-c845-4a50-91ab-0d559d570b39\"\").containsAnyAnswerConceptName(\"\
            \"7aa91832-43d7-4ed6-8fe4-feabf1455cf7\"\",\"\"c28401fc-3b61-4c8d-a2a6-6c97df6ff61b\"\
            \").matches();\n  \n  if(deliveryEncounters.length == 0 && isActiveInProgram\
            \ && condition11){\n    const earliestDate = moment(programEncounter.cancelDateTime).add(30,\
            \ 'days').toDate();\n    const maxDate = moment(programEncounter.cancelDateTime).add(40,\
            \ 'days').toDate();\n    scheduleBuilder.add({name: \"\"ANC - Follow Up\"\
            \", encounterType: \"\"ANC - Follow Up\"\", earliestDate, maxDate}); \
            \ \n  }\n  \n  return scheduleBuilder.getAll();\n};\"\nIndividualEncounterCancellation,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const encounter = params.entity;\n\
            \  const moment = imports.moment;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\
            \ encounter });\n\n  const encounterType = encounter.encounterType.name;\n\
            \n  console.log('encounter-->',encounter);\n  \n  const baseDate = encounter.cancelDateTime;\n\
            \  console.log(\"\"baseDate -->\"\", baseDate);\n\n  function isAlreadyScheduled(nextVisitName,\
            \ earliestDate) {\n    const nextVisitDate = moment(earliestDate).startOf(\"\
            \"day\"\");\n    const existingEncounters = encounter.individual.encounters\
            \ || [];\n\n    console.log(`Checking for ${nextVisitName} on ${nextVisitDate.format(\"\
            \"YYYY-MM-DD\"\")}`);\n\n    existingEncounters.forEach((enc) => {\n \
            \     const name = enc.name.trim();\n      const date = enc.earliestVisitDateTime\n\
            \        ? moment(enc.earliestVisitDateTime).format(\"\"YYYY-MM-DD\"\"\
            )\n        : \"\"N/A\"\";\n      console.log(`  Encounter: ${name}, Date:\
            \ ${date}, Voided: ${enc.voided}`);\n    });\n\n    return existingEncounters.some((enc)\
            \ => {\n      const encounterName = enc.name.trim();\n      const scheduledDate\
            \ = enc.earliestVisitDateTime\n        ? moment(enc.earliestVisitDateTime).startOf(\"\
            \"day\"\")\n        : null;\n\n      return (\n        enc.voided ===\
            \ false &&\n        (\n          encounterName === nextVisitName ||\n\
            \          (scheduledDate && scheduledDate.isSame(nextVisitDate, \"\"\
            day\"\"))\n        )\n      );\n    });\n  }\n\n  function getNextVisitName(currentVisitName)\
            \ {\n    const match = currentVisitName.match(/^School Health - Screening\
            \ Follow up (\\d+)$/);\n    if (match) {\n      const nextNumber = parseInt(match[1],\
            \ 10) + 1;\n      return `School Health - Screening Follow up ${nextNumber}`;\n\
            \    }\n    return \"\"School Health - Screening Follow up 2\"\";\n  }\n\
            \n  const dob = encounter.individual.dateOfBirth;\n  const today = moment();\n\
            \  const ageInYears = moment(today).diff(moment(dob), \"\"years\"\", true);\n\
            \  const isAgeEligible = ageInYears >= 5 && ageInYears <= 19;\n\n  console.log(\"\
            \"isAgeEligible--->\"\", isAgeEligible);\n\n  const nextVisitName = getNextVisitName(encounter.name);\n\
            \  console.log(\"\"Next Visit Name -->\"\", nextVisitName);\n\n  const\
            \ condition11 = new imports.rulesConfig.RuleCondition({ encounter })\n\
            \    .when\n    .valueInCancelEncounter(\"\"f52e6c46-f982-4331-95c4-26bb36c48e72\"\
            \")\n    .containsAnyAnswerConceptName(\n      \"\"7aa91832-43d7-4ed6-8fe4-feabf1455cf7\"\
            \",\n      \"\"c28401fc-3b61-4c8d-a2a6-6c97df6ff61b\"\"\n    )\n    .matches();\n\
            \n  console.log(\"\"condition11 -->\"\", condition11);\n\n  if (condition11\
            \ && isAgeEligible) {\n    const earliestDate = moment(baseDate).add(3,\
            \ \"\"month\"\").toDate();\n    const maxDate = moment(earliestDate).add(10,\
            \ \"\"days\"\").toDate();\n\n    console.log(\"\"earliestDate -->\"\"\
            , earliestDate);\n    console.log(\"\"maxDate -->\"\", maxDate);\n\n \
            \   if (!isAlreadyScheduled(nextVisitName, earliestDate)) {\n      console.log(\"\
            \"Adding visit to schedule...\"\");\n      scheduleBuilder.add({\n   \
            \     name: nextVisitName,\n        encounterType: encounterType,\n  \
            \      earliestDate,\n        maxDate\n      });\n    } else {\n     \
            \ console.log(\"\"Already scheduled. Skipping...\"\");\n    }\n  }\n\n\
            \  return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\"\"use\
            \ strict\"\";\n({ params, imports }) => {\n  const programEncounter =\
            \ params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.ageInMonths.lessThanOrEqualTo(12).matches();\n\
            \  const dateOfBirth = programEncounter.programEnrolment.individual.dateOfBirth;\n\
            \  \n  if(condition11 ){\n    const earliestDate = moment(dateOfBirth).add(180,\
            \ \"\"days\"\").toDate(); // Use dateOfBirth\n    const maxDate = moment(dateOfBirth).add(200,\
            \ \"\"days\"\").toDate(); // Use dateOfBirth\n    scheduleBuilder.add({\
            \ name: \"\"6 Month child metadata\"\", encounterType: \"\"Child metadata\
            \ 6M\"\", earliestDate, maxDate });\n  }\n  \n  return scheduleBuilder.getAll();\n\
            };\n\"\nProgramEncounter,\"\"\"use strict\"\";\n({ params, imports })\
            \ => {\n    const programEncounter = params.entity;\n    const moment\
            \ = imports.moment;\n    const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \n    const encounterType = programEncounter.encounterType.name;\n\n \
            \   const isActiveInProgram = !programEncounter.programEnrolment.programExitDateTime;\n\
            \n    const childFollowupFrequency = {\n        'Child Followup 1': {nextFollowupName:\
            \ 'Child Followup 2', delimeter: 'day', value: 14},\n        'Child Followup\
            \ 2': {nextFollowupName: 'Child Followup 3', delimeter: 'day', value:\
            \ 28},\n        'Child Followup 3': {nextFollowupName: 'Child Followup\
            \ 4', delimeter: 'month', value: 3},\n        'Child Followup 4': {nextFollowupName:\
            \ 'Child Followup 5', delimeter: 'month', value: 6},\n        'Child Followup\
            \ 5': {nextFollowupName: 'Child Followup 6', delimeter: 'month', value:\
            \ 9},\n        'Child Followup 6': {nextFollowupName: 'Child Followup\
            \ 7', delimeter: 'month', value: 12},\n        'Child Followup 7': {nextFollowupName:\
            \ 'Child Followup 8', delimeter: 'month', value: 15},\n        'Child\
            \ Followup 8': {nextFollowupName: 'Child Followup 9', delimeter: 'month',\
            \ value: 18},\n        'Child Followup 9': {nextFollowupName: 'Child Followup\
            \ 10', delimeter: 'month', value: 21},\n        'Child Followup 10': {nextFollowupName:\
            \ 'Child Followup 11', delimeter: 'month', value: 24},\n    };\n    \n\
            \    const currentProgramEncounterName = programEncounter.name;\n    const\
            \ nextVisitObj = childFollowupFrequency[currentProgramEncounterName];\n\
            \n    const baseDate = programEncounter.programEnrolment.enrolmentDateTime;\n\
            \n    function isAlreadyScheduled(nextVisitName, earliestDate) {    \n\
            \        const nextVisitDate = moment(earliestDate);\n        const existingEncounters\
            \ = programEncounter.programEnrolment.getEncountersOfType(encounterType);\n\
            \        return existingEncounters.some((enc) =>\n            enc.voided\
            \ == false &&\n            (enc.name == nextVisitName ||\n           \
            \ moment(enc.earliestVisitDateTime).isSame(nextVisitDate, 'day'))\n  \
            \      );\n    }\n\n    if(isActiveInProgram && nextVisitObj){\n     \
            \   const earliestDate = moment(baseDate).add(nextVisitObj.value, nextVisitObj.delimeter).startOf('day').toDate();\n\
            \        const maxDate = moment(earliestDate).add(10, 'days').endOf('day').toDate();\n\
            \        \n        if (!isAlreadyScheduled(nextVisitObj.nextFollowupName,\
            \ earliestDate)) {\n            scheduleBuilder.add({name: nextVisitObj.nextFollowupName,\
            \ encounterType: encounterType, earliestDate, maxDate});  \n        }\n\
            \    }\n    \n    return scheduleBuilder.getAll();\n};\"\nProgramEncounterCancellation,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const programEncounter\
            \ = params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const encounterType = programEncounter.encounterType.name;\n\n\
            \  const isActiveInProgram = !programEncounter.programEnrolment.programExitDateTime;\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInCancelEncounter(\"\
            \"ba3c5ad5-b7cf-444d-bc0c-a66379ea8600\"\").containsAnyAnswerConceptName(\"\
            \"7aa91832-43d7-4ed6-8fe4-feabf1455cf7\"\",\"\"c28401fc-3b61-4c8d-a2a6-6c97df6ff61b\"\
            \").matches();\n  \n  const childFollowupFrequency = {\n      'Child Followup\
            \ 1': {nextFollowupName: 'Child Followup 2', delimeter: 'day', value:\
            \ 14},\n      'Child Followup 2': {nextFollowupName: 'Child Followup 3',\
            \ delimeter: 'day', value: 28},\n      'Child Followup 3': {nextFollowupName:\
            \ 'Child Followup 4', delimeter: 'month', value: 3},\n      'Child Followup\
            \ 4': {nextFollowupName: 'Child Followup 5', delimeter: 'month', value:\
            \ 6},\n      'Child Followup 5': {nextFollowupName: 'Child Followup 6',\
            \ delimeter: 'month', value: 9},\n      'Child Followup 6': {nextFollowupName:\
            \ 'Child Followup 7', delimeter: 'month', value: 12},\n      'Child Followup\
            \ 7': {nextFollowupName: 'Child Followup 8', delimeter: 'month', value:\
            \ 15},\n      'Child Followup 8': {nextFollowupName: 'Child Followup 9',\
            \ delimeter: 'month', value: 18},\n      'Child Followup 9': {nextFollowupName:\
            \ 'Child Followup 10', delimeter: 'month', value: 21},\n      'Child Followup\
            \ 10': {nextFollowupName: 'Child Followup 11', delimeter: 'month', value:\
            \ 24},\n  };\n  \n  const currentProgramEncounterName = programEncounter.name;\n\
            \  const nextVisitObj = childFollowupFrequency[currentProgramEncounterName];\n\
            \n  const baseDate = programEncounter.programEnrolment.enrolmentDateTime;\n\
            \  \n  function isAlreadyScheduled(nextVisitName, earliestDate) {    \n\
            \      const nextVisitDate = moment(earliestDate);\n      const existingEncounters\
            \ = programEncounter.programEnrolment.getEncountersOfType(encounterType);\n\
            \      return existingEncounters.some((enc) =>\n          enc.voided ==\
            \ false &&\n          (enc.name == nextVisitName ||\n          moment(enc.earliestVisitDateTime).isSame(nextVisitDate,\
            \ 'day'))\n      );\n  }\n  \n  if(condition11 && isActiveInProgram &&\
            \ nextVisitObj){\n      const earliestDate = moment(baseDate).add(nextVisitObj.value,\
            \ nextVisitObj.delimeter).startOf('day').toDate();\n      const maxDate\
            \ = moment(earliestDate).add(10, 'days').endOf('day').toDate();\n    \
            \  \n      if (!isAlreadyScheduled(nextVisitObj.nextFollowupName, earliestDate))\
            \ {\n          scheduleBuilder.add({name: nextVisitObj.nextFollowupName,\
            \ encounterType: encounterType, earliestDate, maxDate});  \n      }\n\
            \  }\n  \n  return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const programEncounter\
            \ = params.entity;\n  const moment = imports.moment;\n  const _ = imports.lodash;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\
            \ programEncounter });\n\n  const hasExitedProgram = (programEncounter)\
            \ => programEncounter.programEnrolment.programExitDateTime;\n\n  if (!hasExitedProgram(programEncounter))\
            \ {\n    const droppedOut = programEncounter.getObservationReadableValue(\"\
            \"Going to school\"\");\n    const allEnc = programEncounter.programEnrolment.nonVoidedEncounters()\
            \ || [];\n\n    // if (allEnc.length <= 1) {\n\n      let nextYearDate\
            \ = moment(programEncounter.earliestVisitDateTime || programEncounter.encounterDateTime).add(1,\
            \ 'years').toDate();\n      let nextYear = moment(nextYearDate).year();\n\
            \      const earliestDate1 = moment().date(1).month('February').year(nextYear).startOf(\"\
            \"day\"\").toDate();\n      const maxDate1 = moment().date(1).month('April').year(nextYear).startOf(\"\
            \"day\"\").toDate();\n      scheduleBuilder.add({\n        name: \"\"\
            Annual Visit - Endline\"\",\n        encounterType: \"\"Annual Visit -\
            \ Endline\"\",\n        earliestDate: earliestDate1,\n        maxDate:\
            \ maxDate1\n      });\n\n      const hbForAnemia = programEncounter.getObservationReadableValue(\"\
            \"Haemoglobin\"\");\n\n      if (hbForAnemia < 8) {\n        const nextMonthDate\
            \ = moment(programEncounter.encounterDateTime || programEncounter.earliestVisitDateTime).add(1,\
            \ 'month').toDate();\n\n        scheduleBuilder.add({\n          name:\
            \ \"\"Severe Anaemia Follow-up\"\",\n          encounterType: \"\"Severe\
            \ Anemia Follow-up\"\",\n          earliestDate: nextMonthDate,\n    \
            \      maxDate: moment(nextMonthDate).add(7, 'days').toDate()\n      \
            \  });\n      } else if (hbForAnemia >= 8 && hbForAnemia < 11) {\n   \
            \     const earliestDate = moment(programEncounter.encounterDateTime ||\
            \ programEncounter.earliestVisitDateTime).add(1, 'month').toDate();\n\
            \        const maxDate = moment(earliestDate).add(7, 'days').toDate();\n\
            \n        scheduleBuilder.add({\n          name: \"\"Moderate Anaemia\
            \ Follow-up\"\",\n          encounterType: \"\"Moderate Anemia Follow-up\"\
            \",\n          earliestDate,\n          maxDate\n        });\n      }\n\
            \n      const chronicSickness = programEncounter.getObservationReadableValue(\"\
            \"Is there any other condition you want to mention about him/her\"\");\n\
            \n      if (!_.includes(chronicSickness, 'No problem')) {\n        const\
            \ earliestDate = moment(programEncounter.encounterDateTime || programEncounter.programEnrolment.enrolmentDateTime).add(1,\
            \ 'months').toDate();\n        const maxDate = moment(earliestDate).add(7,\
            \ 'days').toDate();\n\n        scheduleBuilder.add({\n          name:\
            \ \"\"Chronic Sickness follow up\"\",\n          encounterType: \"\"Chronic\
            \ Sickness follow up\"\",\n          earliestDate,\n          maxDate\n\
            \        });\n      };\n\n      function isAfterFebNextYear(nextVisitDate)\
            \ {\n        const nextYearFeb1st = moment().add(1, 'year').startOf('year').add(1,\
            \ 'month'); // Get February 1st of next year\n        return moment(nextVisitDate).isAfter(moment(nextYearFeb1st));\n\
            \      }\n\n      const sixMonthsFromEncounter = moment(programEncounter.encounterDateTime\
            \ || programEncounter.earliestVisitDateTime).add(6, 'months').toDate();\n\
            \      let str = programEncounter.findLatestObservationInEntireEnrolment(\"\
            \"Sickling test result\"\");\n      ;\n      const sickleTestResult =\
            \ (str)?str.getReadableValue():programEncounter.getObservationReadableValue(\"\
            \"Sickling test result\"\");\n      \n\n\n      if (sickleTestResult ===\
            \ \"\"Disease\"\" && !isAfterFebNextYear(sixMonthsFromEncounter)) {\n\
            \        const earliestDate = sixMonthsFromEncounter;\n        const maxDate\
            \ = moment(earliestDate).add(30, 'days').toDate();\n\n        scheduleBuilder.add({\n\
            \          name: \"\"Sickle Cell Disease Follow-up\"\",\n          encounterType:\
            \ \"\"Sickle Cell Disease Follow-up\"\",\n          earliestDate,\n  \
            \        maxDate\n        });\n      };\n\n      const menstrualAbsenteeism\
            \ = programEncounter.getObservationReadableValue(\"\"dfe666a5-8dc0-4f39-88cc-09727815c796\"\
            \");\n\n      if (menstrualAbsenteeism === \"\"Yes\"\") {\n        const\
            \ earliestDate = moment(programEncounter.encounterDateTime || programEncounter.programEnrolment.enrolmentDateTime).add(1,\
            \ 'months').toDate();\n        const maxDate = moment(earliestDate).add(15,\
            \ 'days').toDate();\n\n        scheduleBuilder.add({\n          name:\
            \ \"\"Menstrual Absenteeism Follow-up\"\",\n          encounterType: \"\
            \"Menstrual Absenteeism Follow-up\"\",\n          earliestDate,\n    \
            \      maxDate\n        });\n      }\n\n      const bmi = programEncounter.getObservationReadableValue(\"\
            \"BMI (kg/mÂ²)\"\");\n\n      const height = programEncounter.getObservationValue('03f3ac9c-a05f-4760-a546-62460f8e921a');\n\
            \      const weight = programEncounter.getObservationValue('229a03d3-3097-4ba4-99c5-a73c6aa7cae1');\n\
            \n      const {zScore} = imports.common.calculateGrowthStatusForAdolescent({\n\
            \        individual: programEncounter.programEnrolment.individual, \n\
            \        weight: weight, \n        height: height, \n        asOnDate:\
            \ programEncounter.encounterDateTime\n      })\n\n      if (zScore ==\
            \ -3 && !isAfterFebNextYear(sixMonthsFromEncounter)) {\n        const\
            \ earliestDate = sixMonthsFromEncounter;\n        const maxDate = moment(earliestDate).add(30,\
            \ 'days').toDate();\n\n        scheduleBuilder.add({\n          name:\
            \ \"\"Severe Malnutrition Follow-up\"\",\n          encounterType: \"\"\
            Severe Malnutrition Follow-up\"\",\n          earliestDate,\n        \
            \  maxDate\n        });\n      }\n\n      const addiction = programEncounter.getObservationReadableValue(\"\
            \"Do you have any addiction\"\");\n\n      if (!_.includes(addiction,\
            \ \"\"None\"\")) {\n        let nextMonthDate = moment(programEncounter.encounterDateTime\
            \ || programEncounter.programEnrolment.enrolmentDateTime).add(1, 'months').toDate();\n\
            \        const maxDate = moment(nextMonthDate).add(30, 'days').toDate();\n\
            \n        scheduleBuilder.add({\n          name: \"\"Addiction Follow-up\"\
            \",\n          encounterType: \"\"Addiction Follow-up\"\",\n         \
            \ earliestDate: nextMonthDate,\n          maxDate: maxDate\n        })\n\
            \      }\n\n      const lowestAddressIsVillage = programEncounter.programEnrolment.individual.lowestAddressLevel.type\
            \ === 'Village';\n      let outOfSchoolVisitScheduled = programEncounter.programEnrolment.getEncounters(true)\n\
            \      .filter(enc => enc.encounterType.name == 'Out of school follow\
            \ up' && enc.encounterDateTime == null && enc.cancelDateTime == null);\n\
            \      \n      if ( droppedOut === \"\"Dropped out\"\" && lowestAddressIsVillage\
            \ && outOfSchoolVisitScheduled.length < 1 ) {\n        const earliestDate\
            \ = moment(programEncounter.encounterDateTime || programEncounter.earliestVisitDateTime).toDate();\n\
            \        const maxDate = moment(earliestDate).add(30, 'days').toDate();\n\
            \      \n        scheduleBuilder.add({\n          name: \"\"Out of school\
            \ follow up\"\",\n          encounterType: \"\"Out of school follow up\"\
            \",\n          earliestDate,\n          maxDate\n        });\n      }\n\
            \n      const hasDevelopmentalDelayOrDisability = new imports.rulesConfig.RuleCondition({\
            \ programEncounter }).when.valueInEncounter(\"\"8a030f39-82b1-4323-93a9-6014be5c679d\"\
            \").containsAnswerConceptName(\"\"995cfaee-5598-4293-addc-dcb1da5dbcd3\"\
            \").matches();\n      const hasDifferentBehaviorCondition = new imports.rulesConfig.RuleCondition({\
            \ programEncounter }).when.valueInEncounter(\"\"01c89b89-9212-466c-ac47-f7ed2d3b5895\"\
            \").containsAnswerConceptName(\"\"995cfaee-5598-4293-addc-dcb1da5dbcd3\"\
            \").matches();\n      const hasSlowerLearningCondition = new imports.rulesConfig.RuleCondition({\
            \ programEncounter }).when.valueInEncounter(\"\"347053d4-1528-4108-836a-211ccf04926f\"\
            \").containsAnswerConceptName(\"\"995cfaee-5598-4293-addc-dcb1da5dbcd3\"\
            \").matches();\n      \n      if (hasDevelopmentalDelayOrDisability ||\
            \ hasDifferentBehaviorCondition || hasSlowerLearningCondition) {\n   \
            \     const earliestDate = sixMonthsFromEncounter;\n        const maxDate\
            \ = moment(earliestDate).add(30, 'days').toDate();\n        scheduleBuilder.add({\n\
            \          name: \"\"Mental Health Follow-up\"\",\n          encounterType:\
            \ \"\"Mental health\"\",\n          earliestDate,\n          maxDate\n\
            \        });\n      }\n  // }\n  }\n\n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounterCancellation,\"//SAMPLE RULE EXAMPLE\n\"\"use strict\"\
            \";\n({ params, imports }) => {\n  const programEncounter = params.entity;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\
            \ programEncounter });\n  \n      const earliestDate = imports.moment(programEncounter.earliestVisitDateTime\
            \ || programEncounter.encounterDateTime).add(1,'month').date(1).toDate();\n\
            \      scheduleBuilder.add({ name: \"\"Out of school follow up\"\", encounterType:\
            \ \"\"Out of school follow up\"\", earliestDate: earliestDate, maxDate:\
            \ imports.moment(earliestDate).add(15,'days').toDate() });\n  \n  \n \
            \ return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\"\"use strict\"\
            \";\n({ params, imports }) => {\n  const programEncounter = params.entity;\n\
            \  const moment = imports.moment;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"\
            \"cb4952df-4be8-42d4-afab-ca89ee3f2be6\"\").defined.matches();\n  \n \
            \ if(condition11 ){\n    const earliestDate = moment(programEncounter.encounterDateTime).add(350,\
            \ 'days').toDate();\n    const maxDate = moment(programEncounter.encounterDateTime).add(370,\
            \ 'days').toDate();\n    scheduleBuilder.add({name: \"\"Substance use\
            \ 12 M follow-up\"\", encounterType: \"\"Substance use follow up (12 M)\"\
            \", earliestDate, maxDate});  \n}\n\n  if(condition11 ){\n    const earliestDate\
            \ = moment(programEncounter.encounterDateTime).add(350, 'days').toDate();\n\
            \    const maxDate = moment(programEncounter.encounterDateTime).add(370,\
            \ 'days').toDate();\n    scheduleBuilder.add({name: \"\"1 Year PHQ9\"\"\
            , encounterType:\"\"PHQ9\"\", earliestDate, maxDate});  \n}\n  \n  return\
            \ scheduleBuilder.getAll();\n};\"\nEncounter,\"\"\"use strict\"\";\n({\
            \ params, imports }) => {\n  const encounter = params.entity;\n  const\
            \ moment = imports.moment;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({encounter});\n\
            \  \n  const ageInMonths = encounter.individual.getAgeInMonths();\n  \n\
            \  const isAgeEligible = ageInMonths >= 60 && ageInMonths < 228;\n  \n\
            \  const condition11 = new imports.rulesConfig.RuleCondition({encounter}).when.valueInEncounter(\"\
            \"3f1d701c-9c33-46dd-9143-b56e06fc495b\"\").containsAnyAnswerConceptName(\"\
            \"0a7fd778-3eb1-425d-8064-7b3f5a1b9463\"\",\"\"3757eb2a-8eae-48b1-9469-37bbd59dda35\"\
            \",\"\"cb5b6fe3-bd8b-434e-ac8b-9ef7b324c8aa\"\",\"\"254ceb8a-760f-4230-b821-48535ac7a8c4\"\
            \").matches();\n  \n  if(condition11 && isAgeEligible) {\n    const earliestDate\
            \ = moment(encounter.encounterDateTime).add(3, 'month').toDate();\n  \
            \  const maxDate = moment(earliestDate).add(10, 'days').toDate();\n  \
            \  scheduleBuilder.add({name: \"\"School Health - Screening Follow up\"\
            \", encounterType: \"\"School Health - Screening Follow up\"\", earliestDate,\
            \ maxDate});  \n  }\n  \n  return scheduleBuilder.getAll();\n};\"\nProgramEncounterCancellation,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const programEncounter\
            \ = params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const encounterType = programEncounter.encounterType.name;\n\n\
            \  const isActiveInProgram = !programEncounter.programEnrolment.programExitDateTime;\n\
            \n  const baseDate = programEncounter.cancelDateTime;\n  \n  function\
            \ isAlreadyScheduled(nextVisitName, earliestDate) {    \n      const nextVisitDate\
            \ = moment(earliestDate);\n      const existingEncounters = programEncounter.programEnrolment.getEncountersOfType(encounterType);\n\
            \      return existingEncounters.some((enc) =>\n          enc.voided ==\
            \ false &&\n          (enc.name == nextVisitName ||\n          moment(enc.earliestVisitDateTime).isSame(nextVisitDate,\
            \ 'day'))\n      );\n  }\n\n  function getNextVisitName(currentVisitName)\
            \ {\n      const match = currentVisitName.match(/^Community Followup (\\\
            d+)$/);\n      if (match) {\n          const nextNumber = parseInt(match[1],\
            \ 10) + 1;\n          return `Community Followup ${nextNumber}`;\n   \
            \   }\n      return null;\n  }\n  \n  const nextVisitName = getNextVisitName(programEncounter.name);\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInCancelEncounter(\"\
            \"926399e6-8f33-4f71-961c-650c3f76e567\"\").containsAnyAnswerConceptName(\"\
            \"7aa91832-43d7-4ed6-8fe4-feabf1455cf7\"\",\"\"c28401fc-3b61-4c8d-a2a6-6c97df6ff61b\"\
            \").matches();\n  \n  \n  if(condition11 && isActiveInProgram){\n    const\
            \ earliestDate = moment(baseDate).add(3, 'month').startOf('day').toDate();\n\
            \    const maxDate = moment(earliestDate).add(10, 'days').endOf('day').toDate();\n\
            \    \n    if (!isAlreadyScheduled(nextVisitName, earliestDate)) {\n \
            \       scheduleBuilder.add({name: nextVisitName, encounterType: encounterType,\
            \ earliestDate, maxDate});  \n    }\n  }\n  \n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEnrolment,\"\"\"use strict\"\";\n({ params, imports }) =>\
            \ {\n  const programEnrolment = params.entity;\n  const moment = imports.moment;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEnrolment});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEnrolment}).when.lowestAddressLevel.defined.matches();\n\
            \    \n  const condition12 = new imports.rulesConfig.RuleCondition({programEnrolment}).when.lowestAddressLevel.defined.matches();\n\
            \  \n  const ageInYears = programEnrolment.individual.getAgeInYears();\n\
            \  \n  const getEnc = programEnrolment.getEncounters(true);\n  const getAllCompletedEncounters\
            \ = _.chain(getEnc)\n  .filter(enc => enc.encounterDateTime != null)\n\
            \  .map(e => e.name)\n  .value();\n   \n  const comparisonFunction = ()\
            \ => {\n  let eligible = true;\n      for ( let i=0; i<getAllCompletedEncounters.length;\
            \ i++) {\n          if ( getAllCompletedEncounters[i] === \"\"Record Substance\
            \ use details\"\" || getAllCompletedEncounters[i] === \"\"Collect baseline\
            \ blood sample details\"\" ) return eligible = false;\n      }\n     \
            \ return eligible;\n  };\n  \n  \n  if( condition11 && comparisonFunction()\
            \ ){\n    const earliestDate = moment(programEnrolment.enrolmentDateTime).add(0,\
            \ 'days').toDate();\n    const maxDate = moment(programEnrolment.enrolmentDateTime).add(3,\
            \ 'days').toDate();\n    scheduleBuilder.add({name: \"\"Record Substance\
            \ use details\"\", encounterType: \"\"Record Substance use details\"\"\
            , earliestDate, maxDate});  \n}\n  \n  if(condition12 && ageInYears >=\
            \ 18 && comparisonFunction() ){\n    const earliestDate = moment(programEnrolment.enrolmentDateTime).add(0,\
            \ 'days').toDate();\n    const maxDate = moment(programEnrolment.enrolmentDateTime).add(3,\
            \ 'days').toDate();\n    scheduleBuilder.add({name: \"\"Collect baseline\
            \ blood sample details\"\", encounterType: \"\"Collect blood sample details\"\
            \", earliestDate, maxDate});  \n}\n      \n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounter,\"//SAMPLE RULE EXAMPLE\n\"\"use strict\"\";\n\
            ({params, imports}) => {\n    const programEncounter = params.entity;\n\
            \    const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \    const moment = imports.moment;\n    const _ = imports.lodash;\n \
            \   \n    const currentlyActiveInProgram = !programEncounter.programEnrolment.programExitDateTime;\n\
            \    const isDeliveryEncounterIncomplete = !programEncounter.programEnrolment.hasCompletedEncounterOfType('Delivery');\n\
            \    \n    const scheduledOrCompletedEncountersOfType = (encounterType,\
            \ nextVisitDate) => {\n\n        const nextDateMonth = moment(nextVisitDate).month();\n\
            \        const nextDateYear = moment(nextVisitDate).year();          \n\
            \        const data = programEncounter.programEnrolment.encounters.filter((enc)\
            \ =>\n            enc.encounterType.name === encounterType &&\n      \
            \      enc.voided == false &&\n            enc.cancelDateTime == null\
            \ &&\n            moment(enc.earliestVisitDateTime).year() == nextDateYear\
            \ &&\n            moment(enc.earliestVisitDateTime).month() == nextDateMonth\n\
            \        );\n        return data;\n    }\n  \n    function lastfilledEncounter(encounterType)\
            \ {\n\n        const lastVisitEncounters = programEncounter.programEnrolment.getEncountersOfType(encounterType,\
            \ false);\n        const latestEncounter = _.chain(lastVisitEncounters)\n\
            \          .filter((encounter) => encounter.encounterDateTime && encounter.voided\
            \ == false)\n          .maxBy((encounter) => encounter.encounterDateTime)\n\
            \          .value();\n        return latestEncounter;\n    }\n    \n \
            \   if(currentlyActiveInProgram && isDeliveryEncounterIncomplete){\n\n\
            \        let nextDate = moment(programEncounter.earliestVisitDateTime).add(1,\
            \ 'M').startOf('month').toDate();\n        const noAncEncountersScheduled\
            \ = scheduledOrCompletedEncountersOfType(\"\"ANC\"\", nextDate).length\
            \ == 0;\n        if(noAncEncountersScheduled){\n            scheduleBuilder.add({\n\
            \                name: 'ANC',\n                encounterType: 'ANC',\n\
            \                earliestDate: nextDate,\n                maxDate: moment(nextDate).endOf('month').toDate()\n\
            \            });\n        }\n\n        const qrtDate = moment(programEncounter.encounterDateTime).toDate();\n\
            \        const noQrtEncountersScheduled = scheduledOrCompletedEncountersOfType(\"\
            \"QRT PW\"\", qrtDate).length == 0;\n        const isSevereAnemic = new\
            \ imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"\
            \"68bc6e51-eb49-4816-b78b-2427bbab8d92\"\").lessThan(7).matches();\n \
            \       const requiresMedicalInterventionTreatment = new imports.rulesConfig.RuleCondition({programEncounter}).when.latestValueInEntireEnrolment(\"\
            \"35f880ca-60b5-4240-97e1-813c0a7a78c4\"\").containsAnswerConceptName(\"\
            \"8ebbf088-f292-483e-9084-7de919ce67b7\"\").matches();\n        const\
            \ anmRecommendedMedicalFacilityIntervention = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"\
            \"f7cc4fd5-5c66-4695-b5e3-1d83c3621f5d\"\").containsAnswerConceptName(\"\
            \"8ebbf088-f292-483e-9084-7de919ce67b7\"\").matches();\n        const\
            \ qrtEligibility = isSevereAnemic || requiresMedicalInterventionTreatment\
            \ || anmRecommendedMedicalFacilityIntervention ;\n        const ancEncounter\
            \ = lastfilledEncounter('ANC');\n        const isEditScenario = ancEncounter\
            \ ? ancEncounter.uuid === programEncounter.uuid : false;\n        const\
            \ isHighRiskCondition = programEncounter.getObservationReadableValue('High\
            \ risk condition');\n\n        if(noQrtEncountersScheduled && qrtEligibility){\n\
            \            scheduleBuilder.add({\n                name: 'QRT PW',\n\
            \                encounterType: 'QRT PW',\n                earliestDate:qrtDate,\n\
            \                maxDate: moment(qrtDate).add(30, 'days').endOf('day').toDate()\n\
            \            });\n        }\n        else if (!isEditScenario && isHighRiskCondition\
            \ && !requiresMedicalInterventionTreatment && !anmRecommendedMedicalFacilityIntervention){\n\
            \            nextDate = moment(programEncounter.earliestVisitDateTime).add(1,'M').startOf('month').toDate();\n\
            \            scheduleBuilder.add({\n                name: \"\"PW Home\
            \ Visit\"\",\n                encounterType: \"\"PW Home Visit\"\",\n\
            \                earliestDate: nextDate,\n                maxDate: moment(nextDate).add(7,\
            \ 'days').endOf('day').toDate()\n            });\n        }\n    }\n\n\
            \    return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\"\"use\
            \ strict\"\";\n({ params, imports }) => {\n  const programEncounter =\
            \ params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.ageInMonths.lessThanOrEqualTo(15).matches();\n\
            \  const dateOfBirth = programEncounter.programEnrolment.individual.dateOfBirth;\n\
            \  \n  if(condition11 ){\n    const earliestDate = moment(dateOfBirth).add(720,\
            \ \"\"days\"\").toDate(); // Use dateOfBirth\n    const maxDate = moment(dateOfBirth).add(740,\
            \ \"\"days\"\").toDate(); // Use dateOfBirth\n    scheduleBuilder.add({\
            \ name: \"\"24M Child Metadata Followup\"\", encounterType: \"\"Child\
            \ Metadata Followup\"\", earliestDate, maxDate });\n  }\n  \n  return\
            \ scheduleBuilder.getAll();\n};\"\nEncounter,\"\"\"use strict\"\";\n({\
            \ params, imports }) => {\n  const encounter = params.entity;\n  const\
            \ moment = imports.moment;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({encounter});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({encounter}).when.valueInEncounter(\"\
            \"a91621fb-20f5-4ee7-ba39-f299b7006318\"\").defined.matches();\n  \n \
            \ if(condition11 ){\n    const earliestDate = moment(encounter.getObservationReadableValue('Followup\
            \ Date')).add(0, 'days').toDate();\n    const maxDate = moment(encounter.getObservationReadableValue('Followup\
            \ Date')).add(0, 'days').toDate();\n    scheduleBuilder.add({name: \"\"\
            Cards & Schemes\"\", encounterType: \"\"Cards & Schemes\"\", earliestDate,\
            \ maxDate});  \n}\n  \n  return scheduleBuilder.getAll();\n};\"\nProgramEncounterCancellation,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const programEncounter\
            \ = params.entity;\n  const programEnrolment = programEncounter.programEnrolment;\n\
            \  const moment = imports.moment;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const hasExitedProgram = (programEncounter) => programEnrolment.programExitDateTime;\n\
            \n  if (!hasExitedProgram(programEncounter)) {\n\n    function IsBaselineAlreadyScheduled(earliestDate){\n\
            \      const year = moment(earliestDate).year();\n      const alreadyScheduled\
            \ = programEnrolment.encounters.some((enc)=> enc.encounterType.name ===\
            \ 'Annual Visit - Endline' && moment(enc.earliestVisitDateTime).year()\
            \ == year);\n      \n      return alreadyScheduled;\n    }\n    /*\n \
            \   let nextYearDate = moment(programEncounter.earliestVisitDateTime ||\
            \ programEncounter.cancelDateTime).add(1, 'years').toDate();\n    let\
            \ nextYear = moment(nextYearDate).year();\n    const earliestDate = moment().date(1).month('February').year(nextYear).startOf(\"\
            \"day\"\").toDate();\n    const maxDate = moment().date(1).month('April').year(nextYear).startOf(\"\
            \"day\"\").toDate();\n    */\n    const earliestDate = moment(programEncounter.earliestVisitDateTime).add(1,\
            \ 'years').month(4).date(15).toDate();\n    const maxDate = moment(earliestDate).month(9).date(31).toDate();\n\
            \      \n    if(!IsBaselineAlreadyScheduled(earliestDate)){\n      scheduleBuilder.add({\n\
            \        name: \"\"Annual Visit - Baseline\"\",\n        encounterType:\
            \ \"\"Annual Visit - Baseline\"\",\n        earliestDate ,\n        maxDate\n\
            \      });\n    }\n  }\n  return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const programEncounter\
            \ = params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.ageInMonths.lessThanOrEqualTo(20).matches();\n\
            \  const dateOfBirth = programEncounter.programEnrolment.individual.dateOfBirth;\n\
            \  \n  if(condition11 ){\n    const earliestDate = moment(dateOfBirth).add(365\
            \ - 20, 'days').toDate();\n    const maxDate = moment(dateOfBirth).add(385,\
            \ 'days').toDate();\n    scheduleBuilder.add({name: \"\"12M MDAT\"\",\
            \ encounterType: \"\"MDAT 12M\"\", earliestDate, maxDate});  \n}\n  \n\
            \  return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"//SAMPLE\
            \ RULE EXAMPLE\n\"\"use strict\"\";\n({ params, imports }) => {\n  const\
            \ programEncounter = params.entity;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\
            \ programEncounter });\n  const moment = imports.moment;\n\n  let hbValue\
            \ = programEncounter.programEnrolment.findLatestObservationInEntireEnrolment(\n\
            \    \"\"Haemoglobin\"\",\n    programEncounter\n  );\n\n  const hasExitedProgram\
            \ = (programEncounter) => programEncounter.programEnrolment.programExitDateTime;\n\
            \n  if (!hasExitedProgram(programEncounter) && hbValue) {\n\n    const\
            \ earliestDate = moment(programEncounter.encounterDateTime).add(1, 'month').toDate();\n\
            \    const maxDate = moment(earliestDate).add(15, 'days').toDate();\n\
            \    hbValue = hbValue.getReadableValue();\n\n    if (hbValue < 8) {\n\
            \n      scheduleBuilder.add({\n        name: \"\"Severe Anaemia Follow-up\"\
            \",\n        encounterType: \"\"Severe Anemia Follow-up\"\",\n       \
            \ earliestDate: earliestDate,\n        maxDate: maxDate\n      });\n \
            \   } else if (hbValue >= 8 && hbValue < 11) {\n\n      scheduleBuilder.add({\n\
            \        name: \"\"Moderate Anaemia Follow-up\"\",\n        encounterType:\
            \ \"\"Moderate Anemia Follow-up\"\",\n        earliestDate: earliestDate,\n\
            \        maxDate: maxDate\n      });\n    }\n  }\n\n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounter,\"\"\"use strict\"\";\n({ params, imports }) =>\
            \ {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.ageInMonths.lessThanOrEqualTo(18).matches();\n\
            \  const dateOfBirth = programEncounter.programEnrolment.individual.dateOfBirth;\n\
            \  \n  if(condition11 ){\n    const earliestDate = moment(dateOfBirth).add(180\
            \ - 20, 'days').toDate();\n    const maxDate = moment(dateOfBirth).add(200,\
            \ 'days').toDate();\n    scheduleBuilder.add({name: \"\"MDAT 6 month\"\
            \", encounterType: \"\"MDAT 6M\"\", earliestDate, maxDate});  \n}\n  \n\
            \  return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"//SAMPLE\
            \ RULE EXAMPLE\n\"\"use strict\"\";\n({ params, imports }) => {\n  const\
            \ programEncounter = params.entity;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\
            \ programEncounter });\n  const moment = imports.moment;\n\n  let hbValue\
            \ = programEncounter.programEnrolment.findLatestObservationInEntireEnrolment(\n\
            \    \"\"Haemoglobin\"\",\n    programEncounter\n  );\n\n  const hasExitedProgram\
            \ = (programEncounter) => programEncounter.programEnrolment.programExitDateTime;\n\
            \n  if (!hasExitedProgram(programEncounter) && hbValue) {\n\n    const\
            \ earliestDate = moment(programEncounter.encounterDateTime).add(1, 'month').toDate();\n\
            \    const maxDate = moment(earliestDate).add(15, 'days').toDate();\n\
            \    hbValue = hbValue.getReadableValue();\n\n    if (hbValue < 8) {\n\
            \n      scheduleBuilder.add({\n        name: \"\"Severe Anaemia Follow-up\"\
            \",\n        encounterType: \"\"Severe Anemia Follow-up\"\",\n       \
            \ earliestDate: earliestDate,\n        maxDate: maxDate\n      });\n \
            \   } else if (hbValue >= 8 && hbValue < 11) {\n\n      scheduleBuilder.add({\n\
            \        name: \"\"Moderate Anaemia Follow-up\"\",\n        encounterType:\
            \ \"\"Moderate Anemia Follow-up\"\",\n        earliestDate: earliestDate,\n\
            \        maxDate: maxDate\n      });\n    }\n  }\n\n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounterCancellation,\"//SAMPLE RULE EXAMPLE\n\"\"use strict\"\
            \";\n({ params, imports }) => {\n  const programEncounter = params.entity;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\
            \ programEncounter });\n  const moment = imports.moment;\n\n  let hbValue\
            \ = programEncounter.programEnrolment.findLatestObservationInEntireEnrolment(\n\
            \    \"\"Haemoglobin\"\",\n    programEncounter\n  );\n\n  const hasExitedProgram\
            \ = (programEncounter) => programEncounter.programEnrolment.programExitDateTime;\n\
            \n  if (!hasExitedProgram(programEncounter) && hbValue) {\n\n    const\
            \ earliestDate = moment(programEncounter.cancelDateTime).add(1, 'month').toDate();\n\
            \    const maxDate = moment(earliestDate).add(15, 'days').toDate();\n\
            \    hbValue = hbValue.getReadableValue();\n\n    if (hbValue < 8) {\n\
            \n      scheduleBuilder.add({\n        name: \"\"Severe Anaemia Follow-up\"\
            \",\n        encounterType: \"\"Severe Anemia Follow-up\"\",\n       \
            \ earliestDate: earliestDate,\n        maxDate: maxDate\n      });\n \
            \   } else if (hbValue >= 8 && hbValue < 11) {\n\n      scheduleBuilder.add({\n\
            \        name: \"\"Moderate Anaemia Follow-up\"\",\n        encounterType:\
            \ \"\"Moderate Anemia Follow-up\"\",\n        earliestDate: earliestDate,\n\
            \        maxDate: maxDate\n      });\n    }\n  }\n\n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounterCancellation,\"//SAMPLE RULE EXAMPLE\n\"\"use strict\"\
            \";\n({ params, imports }) => {\n  const programEncounter = params.entity;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\
            \ programEncounter });\n  const moment = imports.moment;\n\n  let hbValue\
            \ = programEncounter.programEnrolment.findLatestObservationInEntireEnrolment(\n\
            \    \"\"Haemoglobin\"\",\n    programEncounter\n  );\n\n  const hasExitedProgram\
            \ = (programEncounter) => programEncounter.programEnrolment.programExitDateTime;\n\
            \n  if (!hasExitedProgram(programEncounter) && hbValue) {\n\n    const\
            \ earliestDate = moment(programEncounter.cancelDateTime).add(1, 'month').toDate();\n\
            \    const maxDate = moment(earliestDate).add(15, 'days').toDate();\n\
            \    hbValue = hbValue.getReadableValue();\n\n    if (hbValue < 8) {\n\
            \n      scheduleBuilder.add({\n        name: \"\"Severe Anaemia Follow-up\"\
            \",\n        encounterType: \"\"Severe Anemia Follow-up\"\",\n       \
            \ earliestDate: earliestDate,\n        maxDate: maxDate\n      });\n \
            \   } else if (hbValue >= 8 && hbValue < 11) {\n\n      scheduleBuilder.add({\n\
            \        name: \"\"Moderate Anaemia Follow-up\"\",\n        encounterType:\
            \ \"\"Moderate Anemia Follow-up\"\",\n        earliestDate: earliestDate,\n\
            \        maxDate: maxDate\n      });\n    }\n  }\n\n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounterCancellation,\"\"\"use strict\"\";\n({ params, imports\
            \ }) => {\n  const programEncounter = params.entity;\n  const moment =\
            \ imports.moment;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\
            \ programEncounter });\n\n  const hasExitedProgram = (programEncounter)\
            \ => programEncounter.programEnrolment.programExitDateTime;\n\n  if (!hasExitedProgram(programEncounter))\
            \ {\n    const encounters = programEncounter.programEnrolment.getEncounters();\n\
            \n    const numberOfBaselineEncountersCompleted = encounters.filter(enc\
            \ => \n      enc.encounterType.name === \"\"Annual Visit - Baseline\"\"\
            \ && \n      enc.encounterDateTime != null\n    ).length;\n\n    const\
            \ numberOfEndlineEncountersCompleted = encounters.filter(enc => \n   \
            \   enc.encounterType.name === \"\"Annual Visit - Endline\"\" && \n  \
            \    enc.encounterDateTime != null\n    ).length;\n\n    const numberOfMenstrualAbsenteeismEncoutnersCompleted\
            \ = encounters.filter(enc =>\n      enc.encounterType.name === \"\"Menstrual\
            \ Absenteeism Follow-up\"\"\n    ).length;\n\n    if ((numberOfBaselineEncountersCompleted\
            \ + numberOfEndlineEncountersCompleted) * 3 > numberOfMenstrualAbsenteeismEncoutnersCompleted)\
            \ {\n      const earliestDate = moment(programEncounter.cancelDateTime).add(1,\
            \ 'month').toDate();\n      const maxDate = moment(earliestDate).add(15,\
            \ 'days').toDate();\n      scheduleBuilder.add({\n        name: \"\"Menstrual\
            \ Absenteeism Follow-up\"\",\n        encounterType: \"\"Menstrual Absenteeism\
            \ Follow-up\"\",\n        earliestDate,\n        maxDate\n      });\n\
            \    }\n  }\n\n  return scheduleBuilder.getAll();\n};\"\nProgramEncounterCancellation,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const programEncounter\
            \ = params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({ programEncounter });\n\
            \n  const hasExitedProgram = (programEncounter) => programEncounter.programEnrolment.programExitDateTime;\n\
            \n  if (!hasExitedProgram(programEncounter)) {\n    const encounters =\
            \ programEncounter.programEnrolment.getEncounters();\n\n    const numberOfBaselineEncountersCompleted\
            \ = encounters.filter(enc => \n      enc.encounterType.name === \"\"Annual\
            \ Visit - Baseline\"\" && \n      enc.encounterDateTime != null\n    ).length;\n\
            \n    const numberOfEndlineEncountersCompleted = encounters.filter(enc\
            \ => \n      enc.encounterType.name === \"\"Annual Visit - Endline\"\"\
            \ && \n      enc.encounterDateTime != null\n    ).length;\n\n    const\
            \ numberOfAddictionFollowupEncoutnersCompleted = encounters.filter(enc\
            \ =>\n      enc.encounterType.name === \"\"Addiction Follow-up\"\"\n \
            \   ).length;\n\n    if ((numberOfBaselineEncountersCompleted + numberOfEndlineEncountersCompleted)\
            \ * 3 > numberOfAddictionFollowupEncoutnersCompleted) {\n      const earliestDate\
            \ = moment(programEncounter.cancelDateTime).add(1,'month').toDate();\n\
            \      const maxDate = moment(earliestDate).add(15, 'days').toDate();\n\
            \      scheduleBuilder.add({\n        name: \"\"Addiction Follow-up\"\"\
            ,\n        encounterType: \"\"Addiction Follow-up\"\",\n        earliestDate,\n\
            \        maxDate\n      });\n    }\n  }\n\n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounter,\"\"\"use strict\"\";\n({params, imports}) => {\n\
            \    const programEncounter = params.entity;\n    const programEnrolment\
            \ = programEncounter.programEnrolment;\n    const moment = imports.moment;\n\
            \    const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \n    function isVisitAlreadyScheduled(earliestDate, encounterType, encounterName)\
            \ {\n      const earliestVisitDateTime = moment(earliestDate);\n     \
            \ return programEnrolment.encounters.some(enc => \n        enc.encounterType.name\
            \ === encounterType && \n        enc.name === encounterName &&\n     \
            \   moment(enc.earliestVisitDateTime).isSame(earliestVisitDateTime, 'day')\n\
            \      );\n    }\n\n    function getChildHomeVisitDate(qrtEncounterDate)\
            \ {\n      const intervalInDays = moment(programEncounter.earliestVisitDateTime).diff(moment(qrtEncounterDate),\
            \ 'days');\n\n      let daysToAdd = 0;\n      if (intervalInDays <= 15)\
            \ {\n        daysToAdd = 30;\n      } else if (intervalInDays <= 30) {\n\
            \        daysToAdd = 45;\n      } else if (intervalInDays <= 45) {\n \
            \       daysToAdd = 60;\n      }\n\n      return daysToAdd !== 0 ? moment(qrtEncounterDate).add(daysToAdd,\
            \ 'days').toDate() : null;\n    }\n\n    function lastfilledEncounter(encounterType)\
            \ {\n      const lastVisitEncounters = programEncounter.programEnrolment.getEncountersOfType(encounterType,\
            \ false);\n      const latestEncounter = _.chain(lastVisitEncounters)\n\
            \        .filter((encounter) => encounter.encounterDateTime && encounter.voided\
            \ == false)\n        .maxBy((encounter) => encounter.encounterDateTime)\n\
            \        .value();\n      return latestEncounter;\n    }\n\n    const\
            \ qrtEncounter = lastfilledEncounter('QRT Child');\n    if (qrtEncounter\
            \ && programEncounter.name != 'Child Home Visit - Post NRC') {\n     \
            \ const qrtEncounterDate = qrtEncounter ? moment(qrtEncounter.encounterDateTime).toDate()\
            \ : null;\n      const visitDate = getChildHomeVisitDate(qrtEncounterDate);\n\
            \      const takenToMedicalFacility = qrtEncounter.getObservationReadableValue(\"\
            \"QRT facilitated child to medical facility?\"\") == \"\"Yes\"\";\n  \
            \    const latestGMEncounter = lastfilledEncounter('Growth Monitoring');\n\
            \      const isSAMInLatestGMEncounter = latestGMEncounter.getObservationReadableValue(\"\
            \"Nutritional Status\"\") == \"\"SAM\"\";\n      const isGF1InLatestGMEncounter\
            \ = latestGMEncounter.getObservationReadableValue(\"\"Growth Faltering\"\
            \") == \"\"GF1\"\";\n              \n      if ((takenToMedicalFacility\
            \ || isSAMInLatestGMEncounter || !isGF1InLatestGMEncounter ) && !_.isNil(visitDate))\
            \ { \n        scheduleBuilder.add({\n          name: 'Child Home Visit',\n\
            \          encounterType: 'Child Home Visit',\n          earliestDate:\
            \ moment(visitDate).startOf('day').toDate(),\n          maxDate: moment(visitDate).add(7,\
            \ 'days').endOf('day').toDate(),\n          visitCreationStrategy: \"\"\
            createNew\"\"\n        });\n      }\n    }\n    \n    if (programEncounter.name\
            \ == 'Child Home Visit - Post NRC'){\n      const nrcEncounter = lastfilledEncounter('NRC\
            \ Discharge');\n      if(nrcEncounter) {\n        const nrcDischargeDate\
            \ = nrcEncounter ? moment(nrcEncounter.getObservationReadableValue('71e84ef3-4f1d-4814-84fc-3672b3a72423')).toDate()\
            \ : null;\n        const visitDate = getChildHomeVisitDate(nrcDischargeDate);\n\
            \        \n        if (!_.isNil(visitDate) && !isVisitAlreadyScheduled(visitDate,\
            \ 'Child Home Visit', 'Child Home Visit - Post NRC')) { \n          scheduleBuilder.add({\n\
            \            name: 'Child Home Visit - Post NRC',\n            encounterType:\
            \ 'Child Home Visit',\n            earliestDate: moment(visitDate).startOf('day').toDate(),\n\
            \            maxDate: moment(visitDate).add(7, 'days').endOf('day').toDate(),\n\
            \            visitCreationStrategy: \"\"createNew\"\"\n          });\n\
            \        }\n      }\n    }\n    \n    const earliestDate = moment(programEncounter.encounterDateTime);\n\
            \    const latestGMEncounter = lastfilledEncounter('Growth Monitoring');\n\
            \    const isSAMInLatestGMEncounter = latestGMEncounter.getObservationReadableValue(\"\
            \"Nutritional Status\"\") == \"\"SAM\"\";\n    const isMAMInLatestGMEncounter\
            \ = latestGMEncounter.getObservationReadableValue(\"\"Nutritional Status\"\
            \") == \"\"MAM\"\";\n    const isGF2InLatestGMEncounter = latestGMEncounter.getObservationReadableValue(\"\
            \"Growth Faltering\"\") == \"\"GF2\"\";\n    const currentlyActiveInProgram\
            \ = !programEncounter.programEnrolment.programExitDateTime;\n    const\
            \ supervisorChildEncounter = lastfilledEncounter('Supervisor Child Home\
            \ visit');\n    let schEncounterDate;\n    let schEncounterMonth;\n  \
            \  if (supervisorChildEncounter) {\n        schEncounterDate = imports.moment(supervisorChildEncounter.encounterDateTime).toDate();\n\
            \        schEncounterMonth = imports.moment(schEncounterDate).month();\n\
            \    }      \n    const earliestDateMonth = earliestDate.month();\n\n\
            \    \n    let isAlreadyScheduled = programEncounter.programEnrolment.encounters.some((enc)\
            \ =>\n        enc.encounterType.name === 'Supervisor Child Home visit'\
            \ &&\n        enc.voided === false &&\n        moment(enc.earliestVisitDateTime).isSame(earliestDate,\
            \ 'day')\n    );\n\n    if((schEncounterMonth !== earliestDateMonth) &&\
            \ !isAlreadyScheduled && currentlyActiveInProgram && (isSAMInLatestGMEncounter\
            \ || isMAMInLatestGMEncounter || isGF2InLatestGMEncounter)) {\n      \
            \  scheduleBuilder.add({\n            name: 'Supervisor Child Home visit',\n\
            \            encounterType: 'Supervisor Child Home visit',\n         \
            \   earliestDate: earliestDate.startOf('day').toDate(),\n            maxDate:\
            \  earliestDate.endOf('month').toDate()\n        });\n    }\n    return\
            \ scheduleBuilder.getAll();\n};\"\nProgramEncounterCancellation,\"\"\"\
            use strict\"\";\n({params, imports}) => {\n    const programEncounter\
            \ = params.entity;\n    const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\n\
            \        programEncounter\n    });\n\n    const cancelReasonIsOther =\
            \ new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInCancelEncounter(\"\
            \"f0a6eee8-3421-46cb-a500-309127e98231\"\").containsAnswerConceptName(\"\
            \"f169230d-809b-4d06-9ccb-96586977bb68\"\").matches();\n\n    function\
            \ getChildHomeVisitDate(qrtEncounterDate) {\n        const intervalInDays\
            \ = imports.moment(programEncounter.earliestVisitDateTime).diff(imports.moment(qrtEncounterDate),\
            \ 'days');\n\n        let daysToAdd = 0;\n        if (intervalInDays <=\
            \ 15) {\n            daysToAdd = 30;\n        } else if (intervalInDays\
            \ <= 30) {\n            daysToAdd = 45;\n        } else if (intervalInDays\
            \ <= 45) {\n            daysToAdd = 60;\n        }\n\n        return daysToAdd\
            \ !== 0 ? imports.moment(qrtEncounterDate).add(daysToAdd, 'days').toDate()\
            \ : null;\n    }\n\n    function lastfilledEncounter(encounterType) {\n\
            \        const lastVisitEncounters = programEncounter.programEnrolment.getEncountersOfType(encounterType,\
            \ false);\n        const latestEncounter = _.chain(lastVisitEncounters)\n\
            \            .filter((encounter) => encounter.encounterDateTime && encounter.voided\
            \ == false)\n            .maxBy((encounter) => encounter.encounterDateTime)\n\
            \            .value();\n        return latestEncounter;\n    }\n\n   \
            \ const qrtEncounter = lastfilledEncounter('QRT Child');\n    if (qrtEncounter\
            \ && programEncounter.name != 'Child Home Visit - Post NRC') {\n     \
            \   const qrtEncounterDate = qrtEncounter ? imports.moment(qrtEncounter.encounterDateTime).toDate()\
            \ : null;\n        const visitDate = getChildHomeVisitDate(qrtEncounterDate);\n\
            \        const takenToMedicalFacility = qrtEncounter.getObservationReadableValue(\"\
            \"QRT facilitated child to medical facility?\"\") == \"\"Yes\"\";\n  \
            \      const latestGMEncounter = lastfilledEncounter('Growth Monitoring');\n\
            \        const isSAMInLatestGMEncounter = latestGMEncounter.getObservationReadableValue(\"\
            \"Nutritional Status\"\") == \"\"SAM\"\";\n        const isGF1InLatestGMEncounter\
            \ = latestGMEncounter.getObservationReadableValue(\"\"Growth Faltering\"\
            \") == \"\"GF1\"\";\n\n        if ((takenToMedicalFacility || isSAMInLatestGMEncounter\
            \ || !isGF1InLatestGMEncounter)  && cancelReasonIsOther  && !_.isNil(visitDate))\
            \ {\n            scheduleBuilder.add({\n                name: 'Child Home\
            \ Visit',\n                encounterType: 'Child Home Visit',\n      \
            \          earliestDate: imports.moment(visitDate).startOf('day').toDate(),\n\
            \                maxDate: imports.moment(visitDate).add(7, 'days').endOf('day').toDate(),\n\
            \                visitCreationStrategy: \"\"createNew\"\"\n\n        \
            \    });\n        }\n    }\n    \n        if (programEncounter.name ==\
            \ 'Child Home Visit - Post NRC'){\n        const nrcEncounter = lastfilledEncounter('NRC\
            \ Discharge');\n        if(nrcEncounter) {\n            const nrcEncounterDate\
            \ = nrcEncounter ? imports.moment(nrcEncounter.encounterDateTime).toDate()\
            \ : null;\n            const visitDate = getChildHomeVisitDate(nrcEncounterDate);\n\
            \n            if (!_.isNil(visitDate)) {\n                scheduleBuilder.add({\n\
            \                    name: 'Child Home Visit - Post NRC',\n          \
            \          encounterType: 'Child Home Visit',\n                    earliestDate:\
            \ imports.moment(visitDate).startOf('day').toDate(),\n               \
            \     maxDate: imports.moment(visitDate).add(7, 'days').endOf('day').toDate(),\n\
            \                    visitCreationStrategy: \"\"createNew\"\"\n      \
            \          });\n            }\n        }\n    }\n\n        return scheduleBuilder.getAll();\n\
            \    };\"\nProgramEncounterCancellation,\"\"\"use strict\"\";\n({ params,\
            \ imports }) => {\n  const programEncounter = params.entity;\n  const\
            \ moment = imports.moment;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\
            \ programEncounter });\n\n  const hasExitedProgram = (programEncounter)\
            \ => programEncounter.programEnrolment.programExitDateTime;\n\n  if (!hasExitedProgram(programEncounter))\
            \ {\n    const encounters = programEncounter.programEnrolment.getEncounters();\n\
            \n    const numberOfBaselineEncountersCompleted = encounters.filter(enc\
            \ => \n      enc.encounterType.name === \"\"Annual Visit - Baseline\"\"\
            \ && \n      enc.encounterDateTime != null\n    ).length;\n\n    const\
            \ numberOfEndlineEncountersCompleted = encounters.filter(enc => \n   \
            \   enc.encounterType.name === \"\"Annual Visit - Endline\"\" && \n  \
            \    enc.encounterDateTime != null\n    ).length;\n\n    const numberOfChronicSicknessEncountersCompleted\
            \ = encounters.filter(enc =>\n      enc.encounterType.name === \"\"Chronic\
            \ Sickness follow up\"\"\n    ).length;\n    \n  let latestComplicationsValue\
            \ = programEncounter.programEnrolment.findLatestObservationInEntireEnrolment('15ba1077-fb11-49c2-819b-79154b9df6bb').getReadableValue();\n\
            \n    if ((numberOfBaselineEncountersCompleted + numberOfEndlineEncountersCompleted)\
            \ * 3 > numberOfChronicSicknessEncountersCompleted && !_.includes(latestComplicationsValue,'No\
            \ problem') ) {\n      const earliestDate = moment(programEncounter.cancelDateTime).add(30,\
            \ 'days').toDate();\n      const maxDate = moment(earliestDate).add(7,\
            \ 'days').toDate();\n      scheduleBuilder.add({\n        name: \"\"Chronic\
            \ Sickness follow up\"\",\n        encounterType: \"\"Chronic Sickness\
            \ follow up\"\",\n        earliestDate,\n        maxDate\n      });\n\
            \    }\n  }\n\n  return scheduleBuilder.getAll();\n};\"\nProgramEncounterCancellation,\"\
            //SAMPLE RULE EXAMPLE\n\"\"use strict\"\";\n({ params, imports }) => {\n\
            \  const programEncounter = params.entity;\n  const scheduleBuilder =\
            \ new imports.rulesConfig.VisitScheduleBuilder({\n    programEncounter\n\
            \  });\n  \n  const moment = imports.moment;\n  const _ = imports.lodash;\n\
            \  let visitDate = programEncounter.encounterDateTime || programEncounter.earliestVisitDateTime;\n\
            \n   \n   /*     \n    const visitScheduleCriteria = [60, 170, 260, 270];\n\
            \n    const getDaysNeedsToBeAdd = function (duration) {\n        let found\
            \ = _.find(visitScheduleCriteria, function (currentCriteria) {\n     \
            \       return (duration + 7) <= currentCriteria;\n        });\n     \
            \   return found;\n    };\n\n    const LMP = programEncounter.programEnrolment.getObservationValue('Last\
            \ menstrual period');\n    const EDD = programEncounter.programEnrolment.getObservationValue('Estimated\
            \ date of delivery');\n    const durationFromLMPToEncounter = moment(visitDate).diff(moment(LMP),\
            \ 'Days');\n    const earliestDate = moment(LMP).add(getDaysNeedsToBeAdd(durationFromLMPToEncounter),\
            \ 'days').toDate();\n\n    let visitNumber = programEncounter.programEnrolment.getEncountersOfType(\"\
            \"ANC\"\", false)\n    .filter((enc) => !_.isNil(enc.encounterDateTime)\
            \ === true || !_.isNil(enc.cancelDateTime) === true).length + 2;\n   \
            \ if (durationFromLMPToEncounter < 270 && programEncounter.programEnrolment.hasEncounter('Delivery',\
            \ 'Delivery') === false) {\n        scheduleBuilder.add({\n          \
            \  name: 'ANC ' + visitNumber,\n            encounterType: 'ANC',\n  \
            \          earliestDate: earliestDate,\n            maxDate: moment(earliestDate).add(2,\
            \ 'days').toDate()\n        });\n    }\n    */\n    \n    \n  const condition0\
            \ = ! programEncounter.programEnrolment.programExitDateTime;\n  \n  const\
            \ scheduledOrCompletedEncountersOfType = (type,nextVisitDate) => {\n \
            \     const nextDateMonth = moment(nextVisitDate).month();\n      const\
            \ nextDateYear = moment(nextVisitDate).year();          \n      const\
            \ data = programEncounter.programEnrolment.encounters.filter((enc)=> enc.encounterType.name\
            \ === type && enc.voided == false && enc.cancelDateTime == null && moment(enc.earliestVisitDateTime).year()==nextDateYear\
            \  && moment(enc.earliestVisitDateTime).month()==nextDateMonth )\n   \
            \   return data;\n  }\n  \n  const nextDate = moment(programEncounter.earliestVisitDateTime).add(1,'M').startOf('month').toDate();\n\
            \  const condition1 = scheduledOrCompletedEncountersOfType(\"\"ANC\"\"\
            ,nextDate).length == 0;\n  const condition2 = ! programEncounter.programEnrolment.hasCompletedEncounterOfType('Delivery');\n\
            \  const condition3 = ! new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInCancelEncounter(\"\
            \"f0a6eee8-3421-46cb-a500-309127e98231\"\").containsAnswerConceptNameOtherThan(\"\
            \"f169230d-809b-4d06-9ccb-96586977bb68\"\").matches();\n  \n\n  \n  if(condition0\
            \ && condition1 && condition2 && condition3){\n      scheduleBuilder.add({\n\
            \            name: 'ANC',\n            encounterType: 'ANC',\n       \
            \     earliestDate: nextDate,\n            maxDate: moment(nextDate).endOf('month').toDate()\n\
            \        });\n  }\n\n/*\n    \n    if (durationFromLMPToEncounter > 260\
            \ && programEncounter.programEnrolment.hasEncounter('Delivery', 'Delivery')\
            \ === false) {\n        scheduleBuilder.add({\n            name: 'Delivery',\n\
            \            encounterType: 'Delivery',\n            earliestDate: moment(EDD).toDate(),\n\
            \            maxDate: moment(EDD).add(2, 'days').toDate()\n        });\n\
            \    }\n  */  \n  \n  return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\
            \"\"use strict\"\";\n({params, imports}) => {\n  const _ = imports.lodash;\n\
            \  const programEncounter = params.entity;\n  const programEnrolment =\
            \ programEncounter.programEnrolment;\n  const individual = programEnrolment.individual;\n\
            \  const moment = imports.moment;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \n  const hasExitedProgram = (programEncounter) => programEncounter.programEnrolment.programExitDateTime;\n\
            \n  if (!hasExitedProgram(programEncounter)) {\n\n    const lowestAddressIsVillage\
            \ = programEncounter.programEnrolment.individual.lowestAddressLevel.type\
            \ === 'Village';\n\n    const goingToSchool = programEncounter.getObservationReadableValue(\"\
            \"Going to school\"\");\n    const hbForAnemia = programEncounter.getObservationReadableValue(\"\
            \"Haemoglobin\"\");\n\n    const standard = '';\n    if ( programEncounter.findLatestObservationInEntireEnrolment(\"\
            \"In which standard he/she is studying?\"\") ) {\n        standard = programEncounter.findLatestObservationInEntireEnrolment(\"\
            \"In which standard he/she is studying?\"\").getReadableValue();\n   \
            \ } else {\n        standard = false;\n    }\n\n    const addressType\
            \ = individual.lowestAddressLevel.type;\n    \n    const isIn12Standard\
            \ = standard == 12;\n    const isInSchoolOrBoarding = (addressType ===\
            \ 'School') || (addressType === 'Boarding');   \n    const condition1\
            \ = !(isIn12Standard && isInSchoolOrBoarding);\n    \n    function IsBaselineAlreadyScheduled(earliestDate){\n\
            \      const year = moment(earliestDate).year();\n      const alreadyScheduled\
            \ = programEnrolment.encounters.some((enc)=> enc.encounterType.name ===\
            \ 'Annual Visit - Baseline' && moment(enc.earliestVisitDateTime).year()\
            \ == year);\n      \n      return alreadyScheduled;\n    }\n\n    if (\
            \ (goingToSchool === 'Yes' && condition1) || ( goingToSchool != 'Yes'\
            \ && condition1 ) ) {\n      const earliestDate = moment(programEncounter.earliestVisitDateTime\
            \ || programEncounter.encounterDateTime).month(4).date(15).toDate();\n\
            \      const maxDate = moment(earliestDate).month(9).date(31).toDate();\n\
            \      \n      if(!IsBaselineAlreadyScheduled(earliestDate)){\n      \
            \  scheduleBuilder.add({\n          name: \"\"Annual Visit - Baseline\"\
            \",\n          encounterType: \"\"Annual Visit - Baseline\"\",\n     \
            \     earliestDate,\n          maxDate\n        });\n      }\n    }\n\n\
            \    const wetherDroppedOutOfSchool = programEncounter.getObservationReadableValue('Going\
            \ to school');\n\n      let outOfSchoolVisitScheduled = programEncounter.programEnrolment.getEncounters(true)\n\
            \      .filter(enc => enc.encounterType.name == 'Out of school follow\
            \ up' && enc.encounterDateTime == null && enc.cancelDateTime == null);\n\
            \      \n    if ( goingToSchool === 'Dropped out' && lowestAddressIsVillage\
            \ && outOfSchoolVisitScheduled.length < 1 ) {\n    \n    const earliestDate\
            \ = moment(programEncounter.encounterDateTime || programEncounter.earliestVisitDateTime).toDate();\n\
            \        const maxDate = moment(earliestDate).add(30, 'days').toDate();\n\
            \      \n        scheduleBuilder.add({\n          name: \"\"Out of school\
            \ follow up\"\",\n          encounterType: \"\"Out of school follow up\"\
            \",\n          earliestDate,\n          maxDate\n        });  \n    \n\
            \    }\n\n    if (hbForAnemia < 8 && goingToSchool === 'Yes' && lowestAddressIsVillage\
            \ && condition1) {\n      const nextMonthDate = moment(programEncounter.earliestVisitDateTime\
            \ || programEncounter.encounterDateTime).add(1, 'month').toDate();\n \
            \     const maxDate = moment(nextMonthDate).add(7, 'days').toDate();\n\
            \n      scheduleBuilder.add({\n        name: \"\"Severe Anaemia Follow-up\"\
            \",\n        encounterType: \"\"Severe Anemia Follow-up\"\",\n       \
            \ earliestDate: nextMonthDate,\n        maxDate: maxDate\n      });\n\
            \    } else if (hbForAnemia >= 8 && hbForAnemia < 11 && goingToSchool\
            \ === 'Yes' && lowestAddressIsVillage && condition1) {\n      const earliestDate\
            \ = moment(programEncounter.earliestVisitDateTime || programEncounter.encounterDateTime).add(1,\
            \ 'month').toDate();\n      const maxDate = moment(earliestDate).add(7,\
            \ 'days').toDate();\n\n      scheduleBuilder.add({\n        name: \"\"\
            Moderate Anaemia Follow-up\"\",\n        encounterType: \"\"Moderate Anemia\
            \ Follow-up\"\",\n        earliestDate,\n        maxDate\n      });\n\
            \    }\n\n    const chronicSickness = programEncounter.getObservationReadableValue(\"\
            \"Is there any other condition you want to mention about him/her\"\");\n\
            \n    if (!_.includes(chronicSickness, 'No problem') && goingToSchool\
            \ === 'Yes' && lowestAddressIsVillage && condition1) {\n      const earliestDate\
            \ = moment(programEncounter.earliestVisitDateTime || programEncounter.encounterDateTime).add(1,\
            \ 'month').toDate();\n      const maxDate = moment(earliestDate).add(7,\
            \ 'days').toDate();\n\n      scheduleBuilder.add({\n        name: \"\"\
            Chronic Sickness follow up\"\",\n        encounterType: \"\"Chronic Sickness\
            \ follow up\"\",\n        earliestDate,\n        maxDate\n      });\n\
            \    }\n\n         let str = programEncounter.findLatestObservationInEntireEnrolment(\"\
            \"Sickling test result\"\");\n      ;\n      const sickleTestResult =\
            \ (str)?str.getReadableValue():programEncounter.getObservationReadableValue(\"\
            \"Sickling test result\"\");\n\n\n    if (sickleTestResult === \"\"Disease\"\
            \" && goingToSchool === 'Yes' && lowestAddressIsVillage && condition1)\
            \ {\n      const earliestDate = moment(programEncounter.earliestVisitDateTime\
            \ || programEncounter.encounterDateTime).month(9).date(15).toDate();\n\
            \      const maxDate = moment(earliestDate).add(7, 'days').toDate();\n\
            \n      scheduleBuilder.add({\n        name: \"\"Sickle Cell Disease Follow-up\"\
            \",\n        encounterType: \"\"Sickle Cell Disease Follow-up\"\",\n \
            \       earliestDate,\n        maxDate\n      });\n    }\n\n    const\
            \ menstrualAbsenteeism = programEncounter.getObservationReadableValue(\"\
            \"Does she remain absent during menstruation\"\");\n\n    if (menstrualAbsenteeism\
            \ === \"\"Yes\"\" && goingToSchool === 'Yes' && lowestAddressIsVillage\
            \ && condition1) {\n      const earliestDate = moment(programEncounter.earliestVisitDateTime\
            \ || programEncounter.encounterDateTime).add(1, 'month').toDate();\n \
            \     const maxDate = moment(earliestDate).add(15, 'days').toDate();\n\
            \n      scheduleBuilder.add({\n        name: \"\"Menstrual Absenteeism\
            \ Follow-up\"\",\n        encounterType: \"\"Menstrual Absenteeism Follow-up\"\
            \",\n        earliestDate,\n        maxDate\n      });\n    }\n\n    const\
            \ bmi = programEncounter.getObservationReadableValue(\"\"BMI (kg/mÂ²)\"\
            \");\n    \n    const height = programEncounter.getObservationValue('03f3ac9c-a05f-4760-a546-62460f8e921a');\n\
            \    const weight = programEncounter.getObservationValue('229a03d3-3097-4ba4-99c5-a73c6aa7cae1');\n\
            \n    const {zScore} = imports.common.calculateGrowthStatusForAdolescent({\n\
            \      individual: programEncounter.programEnrolment.individual, \n  \
            \    weight: weight, \n      height: height, \n      asOnDate: programEncounter.encounterDateTime\n\
            \    })\n\n    if (zScore == -3 && goingToSchool === 'Yes' && lowestAddressIsVillage\
            \ && condition1) {\n      const earliestDate = moment(programEncounter.earliestVisitDateTime\
            \ || programEncounter.encounterDateTime).add(1, 'month').toDate();\n \
            \     const maxDate = moment(earliestDate).add(15, 'days').toDate();\n\
            \n      scheduleBuilder.add({\n        name: \"\"Severe Malnutrition Follow-up\"\
            \",\n        encounterType: \"\"Severe Malnutrition Follow-up\"\",\n \
            \       earliestDate,\n        maxDate\n      });\n    }\n\n    const\
            \ addiction = programEncounter.getObservationReadableValue(\"\"Do you\
            \ have any addiction\"\");\n\n    if (!_.includes(addiction, \"\"None\"\
            \") && goingToSchool === 'Yes' && lowestAddressIsVillage && condition1)\
            \ {\n      let nextMonthDate = moment(programEncounter.earliestVisitDateTime\
            \ || programEncounter.encounterDateTime).add(1, 'month').toDate();\n \
            \     const maxDate = moment(earliestDate).add(15, 'days').toDate();\n\
            \n      scheduleBuilder.add({\n        name: \"\"Addiction Follow-up\"\
            \",\n        encounterType: \"\"Addiction Follow-up\"\",\n        earliestDate:\
            \ nextMonthDate,\n        maxDate: maxDate\n      })\n    }\n  }\n  \n\
            \  return scheduleBuilder.getAll();\n};\"\nEncounter,\"\"\"use strict\"\
            \";\n({ params, imports }) => {\n  const encounter = params.entity;\n\
            \  const moment = imports.moment;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({encounter});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({encounter}).when.ageInYears.greaterThan(6).matches();\n\
            \  \n  if(condition11 ){\n    const earliestDate = moment(encounter.getObservationReadableValue('fbf6eee4-ed36-4570-a305-e97eacd50136')).add(0,\
            \ 'days').startOf('day').toDate();\n    const maxDate = moment(encounter.getObservationReadableValue('fbf6eee4-ed36-4570-a305-e97eacd50136')).add(30,\
            \ 'days').endOf('day').toDate();\n    scheduleBuilder.add({name: \"\"\
            Screening Followup\"\", encounterType: \"\"Screening Followup\"\", earliestDate,\
            \ maxDate});  \n}\n  \n  return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\
            \"\"use strict\"\";\n({params, imports}) => {\n    const programEncounter\
            \ = params.entity;\n    const _ = imports.lodash;\n    const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({\n        programEncounter\n\
            \    });\n\n    const takenToMedicalFacility = programEncounter.getObservationReadableValue(\"\
            \"QRT facilitated child to medical facility?\"\") == \"\"Yes\"\";\n  \
            \  const referredToNRC = programEncounter.getObservationReadableValue(\"\
            \"Advice given\"\") == \"\"Referred to NRC\"\";\n    \n    function lastfilledEncounter(encounterType)\
            \ {\n        const lastVisitEncounters = programEncounter.programEnrolment.getEncountersOfType(encounterType,\
            \ false);\n        const latestEncounter = _.chain(lastVisitEncounters)\n\
            \            .filter((encounter) => encounter.encounterDateTime && encounter.voided\
            \ == false)\n            .maxBy((encounter) => encounter.encounterDateTime)\n\
            \            .value();\n        return latestEncounter;\n    }\n\n   \
            \ const qrtEncounter = lastfilledEncounter('Growth Monitoring');\n   \
            \ if (qrtEncounter) {\n        const isSAMInLastGM = qrtEncounter ? qrtEncounter.getObservationReadableValue(\"\
            \"Nutritional Status\"\") == \"\"SAM\"\" : false;\n        if (takenToMedicalFacility\
            \ || isSAMInLastGM) {\n            scheduleBuilder.add({\n           \
            \     name: 'Child Home Visit',\n                encounterType: 'Child\
            \ Home Visit',\n                earliestDate: imports.moment(programEncounter.encounterDateTime).add(15,\
            \ 'days').startOf('day').toDate(),\n                maxDate: imports.moment(programEncounter.encounterDateTime).add(22,\
            \ 'days').endOf('day').toDate()\n            });\n        }\n  }\n   \
            \ \n    if(referredToNRC){\n          scheduleBuilder.add({\n        \
            \        name: 'NRC Admission',\n                encounterType: 'NRC Admission',\n\
            \                earliestDate: imports.moment(programEncounter.encounterDateTime).startOf('day').toDate(),\n\
            \                maxDate: imports.moment(programEncounter.encounterDateTime).add(60,\
            \ 'days').endOf('day').toDate()\n            });\n    }\n\n\n    return\
            \ scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\"\"use strict\"\
            \";\n({params, imports}) => {\n    const programEncounter = params.entity;\n\
            \    const _ = imports.lodash;\n    const moment = imports.moment;\n \
            \   const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\n\
            \        programEncounter\n    });\n\n\n    function getPWHomeVisitDate(qrtEncounterDate)\
            \ {\n        const intervalInDays = imports.moment(programEncounter.earliestVisitDateTime).diff(imports.moment(qrtEncounterDate),\
            \ 'days');\n\n        let daysToAdd = 0;\n        if (intervalInDays <=\
            \ 15) {\n            daysToAdd = 30;\n        } else if (intervalInDays\
            \ <= 30) {\n            daysToAdd = 45;\n        } else if (intervalInDays\
            \ <= 45) {\n            daysToAdd = 60;\n        }\n\n        return daysToAdd\
            \ !== 0 ? imports.moment(qrtEncounterDate).add(daysToAdd, 'days').toDate()\
            \ : null;\n    }\n\n\n    function lastfilledEncounter(encounterType)\
            \ {\n        const lastVisitEncounters = programEncounter.programEnrolment.getEncountersOfType(encounterType,\
            \ false);\n        const latestEncounter = _.chain(lastVisitEncounters)\n\
            \            .filter((encounter) => encounter.encounterDateTime && encounter.voided\
            \ == false)\n            .maxBy((encounter) => encounter.encounterDateTime)\n\
            \            .value();\n        return latestEncounter;\n    }\n \n  \
            \ \n    const qrtEncounter = lastfilledEncounter('QRT PW');\n    if (qrtEncounter)\
            \ {\n        const qrtEncounterDate = qrtEncounter ? imports.moment(qrtEncounter.encounterDateTime).toDate()\
            \ : null;\n        const visitDate = getPWHomeVisitDate(qrtEncounterDate);\n\
            \        \n         let isEditScenario = programEncounter.programEnrolment.encounters.some((enc)\
            \ => \n            enc.encounterType.name === 'PW Home Visit' && \n  \
            \          enc.voided === false && \n            imports.moment(enc.earliestVisitDateTime).isSame(visitDate,\
            \ 'day')\n          );\n    \n        if (visitDate && !isEditScenario)\
            \ {\n            scheduleBuilder\n                .add({\n           \
            \         name: \"\"PW Home Visit\"\",\n                    encounterType:\
            \ \"\"PW Home Visit\"\",\n                    earliestDate: imports.moment(visitDate).startOf('day').toDate(),\n\
            \                    maxDate: imports.moment(visitDate).add(7, 'days').endOf('day').toDate()\n\
            \                });\n        }\n    }\n    \n    \n    const isHighRiskCondition\
            \ = programEncounter.programEnrolment.getObservationReadableValue('High\
            \ risk condition');\n    const currentlyActiveInProgram = !programEncounter.programEnrolment.programExitDateTime;\n\
            \    const supervisorPWEncounter = lastfilledEncounter('Supervisor PW\
            \ Home Visit');\n    let spwEncounterDate;\n    let spwEncounterMonth;\n\
            \    if (supervisorPWEncounter) {\n        spwEncounterDate = imports.moment(supervisorPWEncounter.encounterDateTime).toDate();\n\
            \        spwEncounterMonth = imports.moment(spwEncounterDate).month();\n\
            \    }      \n    const earliestDate = moment(programEncounter.encounterDateTime);\n\
            \    const earliestDateMonth = earliestDate.month();\n\n    let isAlreadyScheduled\
            \ = programEncounter.programEnrolment.encounters.some((enc) =>\n     \
            \   enc.encounterType.name == 'Supervisor PW Home Visit' &&\n        enc.voided\
            \ == false &&\n        moment(enc.earliestVisitDateTime).isSame(earliestDate,\
            \ 'day')\n    );\n    if((spwEncounterMonth !== earliestDateMonth) &&\
            \ !isAlreadyScheduled && isHighRiskCondition && isHighRiskCondition.length\
            \ > 0 && currentlyActiveInProgram) {\n        \n        scheduleBuilder.add({\n\
            \            name: 'Supervisor PW Home Visit',\n            encounterType:\
            \ 'Supervisor PW Home Visit',\n            earliestDate: earliestDate.startOf('day').toDate(),\n\
            \            maxDate:  earliestDate.endOf('month').toDate()\n        });\n\
            \    }\n    return scheduleBuilder.getAll();\n}\"\nProgramEncounter,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const programEncounter\
            \ = params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({ programEncounter });\n\
            \n  const hasExitedProgram = (programEncounter) => programEncounter.programEnrolment.programExitDateTime;\n\
            \n  if (!hasExitedProgram(programEncounter)) {\n    const encounters =\
            \ programEncounter.programEnrolment.getEncounters();\n\n    const numberOfBaselineEncountersCompleted\
            \ = encounters.filter(enc => \n      enc.encounterType.name === \"\"Annual\
            \ Visit - Baseline\"\" && \n      enc.encounterDateTime != null\n    ).length;\n\
            \n    const numberOfEndlineEncountersCompleted = encounters.filter(enc\
            \ => \n      enc.encounterType.name === \"\"Annual Visit - Endline\"\"\
            \ && \n      enc.encounterDateTime != null\n    ).length;\n\n    const\
            \ numberOfAddictionFollowupEncoutnersCompleted = encounters.filter(enc\
            \ =>\n      enc.encounterType.name === \"\"Addiction Follow-up\"\"\n \
            \   ).length;\n\n    if ((numberOfBaselineEncountersCompleted + numberOfEndlineEncountersCompleted)\
            \ * 3 > numberOfAddictionFollowupEncoutnersCompleted) {\n      const earliestDate\
            \ = moment(programEncounter.encounterDateTime).add(1,'month').toDate();\n\
            \      const maxDate = moment(earliestDate).add(15, 'days').toDate();\n\
            \      scheduleBuilder.add({\n        name: \"\"Addiction Follow-up\"\"\
            ,\n        encounterType: \"\"Addiction Follow-up\"\",\n        earliestDate,\n\
            \        maxDate\n      });\n    }\n  }\n\n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounter,\"\"\"use strict\"\";\n({ params, imports }) =>\
            \ {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\
            \ programEncounter });\n\n  const hasExitedProgram = (programEncounter)\
            \ => programEncounter.programEnrolment.programExitDateTime;\n\n  if (!hasExitedProgram(programEncounter))\
            \ {\n    const encounters = programEncounter.programEnrolment.getEncounters();\n\
            \n    const numberOfBaselineEncountersCompleted = encounters.filter(enc\
            \ => \n      enc.encounterType.name === \"\"Annual Visit - Baseline\"\"\
            \ && \n      enc.encounterDateTime != null\n    ).length;\n\n    const\
            \ numberOfEndlineEncountersCompleted = encounters.filter(enc => \n   \
            \   enc.encounterType.name === \"\"Annual Visit - Endline\"\" && \n  \
            \    enc.encounterDateTime != null\n    ).length;\n\n    const numberOfMenstrualAbsenteeismEncoutnersCompleted\
            \ = encounters.filter(enc =>\n      enc.encounterType.name === \"\"Menstrual\
            \ Absenteeism Follow-up\"\"\n    ).length;\n\n    if ((numberOfBaselineEncountersCompleted\
            \ + numberOfEndlineEncountersCompleted) * 3 > numberOfMenstrualAbsenteeismEncoutnersCompleted)\
            \ {\n      const earliestDate = moment(programEncounter.encounterDateTime).add(1,\
            \ 'month').toDate();\n      const maxDate = moment(earliestDate).add(15,\
            \ 'days').toDate();\n      scheduleBuilder.add({\n        name: \"\"Menstrual\
            \ Absenteeism Follow-up\"\",\n        encounterType: \"\"Menstrual Absenteeism\
            \ Follow-up\"\",\n        earliestDate,\n        maxDate\n      });\n\
            \    }\n  }\n\n  return scheduleBuilder.getAll();\n};\"\nProgramEncounterCancellation,\"\
            //SAMPLE RULE EXAMPLE\n\"\"use strict\"\";\n({ params, imports }) => {\n\
            \  const programEncounter = params.entity;\n  const scheduleBuilder =\
            \ new imports.rulesConfig.VisitScheduleBuilder({\n    programEncounter\n\
            \  });\n  const moment = imports.moment;\n  const cancelledEnc = programEncounter.name;\n\
            \  const cancelledDate = programEncounter.cancelDateTime;\n  \n  const\
            \ earliestDate = moment(cancelledDate).add(7, 'days').toDate();\n  const\
            \ maxDate = moment(cancelledDate).add(10, 'days').toDate();\n   scheduleBuilder.add({name:cancelledEnc\
            \ , encounterType: \"\"Substance use details\"\", earliestDate, maxDate});\
            \  \n\n\n  return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const programEncounter\
            \ = params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.ageInYears.greaterThanOrEqualTo(14).matches();\n\
            \  \n  if(condition11 ){\n    const earliestDate = moment(programEncounter.getObservationReadableValue('fbf6eee4-ed36-4570-a305-e97eacd50136')).add(0,\
            \ 'days').startOf('day').toDate();\n    const maxDate = moment(programEncounter.getObservationReadableValue('fbf6eee4-ed36-4570-a305-e97eacd50136')).add(30,\
            \ 'days').endOf('day').toDate();\n    scheduleBuilder.add({name: \"\"\
            Diabetes/HTN Followup\"\", encounterType: \"\"Diabetes/HTN Followup\"\"\
            , earliestDate, maxDate});  \n  }\n  \n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEnrolment,\"\"\"use strict\"\";\n({ params, imports }) =>\
            \ {\n  const programEnrolment = params.entity;\n  const moment = imports.moment;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEnrolment});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEnrolment}).when.ageInYears.greaterThanOrEqualTo(14).matches();\n\
            \  \n  if(condition11 ){\n    const earliestDate = moment(programEnrolment.getObservationReadableValue('fbf6eee4-ed36-4570-a305-e97eacd50136')).add(0,\
            \ 'days').startOf('day').toDate();\n    const maxDate = moment(programEnrolment.getObservationReadableValue('fbf6eee4-ed36-4570-a305-e97eacd50136')).add(30,\
            \ 'days').endOf('day').toDate();\n    scheduleBuilder.add({name: \"\"\
            Diabetes/HTN Followup\"\", encounterType: \"\"Diabetes/HTN Followup\"\"\
            , earliestDate, maxDate});  \n}\n  \n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounterCancellation,\"//SAMPLE RULE EXAMPLE\n\"\"use strict\"\
            \";\n({ params, imports }) => {\n  const programEncounter = params.entity;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\n\
            \    programEncounter\n  });\n  \n  const moment = imports.moment;\n \
            \ const _ = imports.lodash;\n  const cancelReason = programEncounter.findCancelEncounterObservationReadableValue(\"\
            \"Cancel reason\"\");\n  \n  const earliestDate = moment(programEncounter.earliestVisitDateTime).add(1,\
            \ 'month').startOf('month').toDate();\n  let isEditScenario = programEncounter.programEnrolment.encounters.some((enc)\
            \ => \n            enc.encounterType.name === 'Growth Monitoring' && \n\
            \            enc.voided === false && \n            imports.moment(enc.earliestVisitDateTime).isSame(earliestDate,\
            \ 'day')\n          );\n    \n    if(programEncounter.programEnrolment.individual.getAgeInYears()\
            \ <= 5 && cancelReason != 'Death' && cancelReason != 'Migrated to other\
            \ geography' && !isEditScenario) {\n        scheduleBuilder.add({\n  \
            \          name: 'Growth Monitoring',\n            encounterType: 'Growth\
            \ Monitoring',\n            earliestDate: earliestDate,\n            maxDate:\
            \  moment(earliestDate).endOf('month').toDate()\n        });\n    }\n\
            \  \n  return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\"\"\
            use strict\"\";\n({ params, imports }) => {\n  const programEncounter\
            \ = params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const isDateOfDischargeDefined = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"\
            \"71e84ef3-4f1d-4814-84fc-3672b3a72423\"\").defined.matches();\n  \n \
            \ const isChildHomeVisitAlreadyScheduled = programEncounter.programEnrolment.getEncounters()\n\
            \  .some( enc => enc.encounterType.name === 'Child Home Visit' && enc.name\
            \ === 'Child Home Visit - Post NRC' && !enc.encounterDateTime && !enc.cancelDateTime\
            \ )\n  \n  if(isDateOfDischargeDefined && !isChildHomeVisitAlreadyScheduled){\n\
            \    const earliestDate = moment(programEncounter.getObservationReadableValue('71e84ef3-4f1d-4814-84fc-3672b3a72423')).add(15,\
            \ 'days').startOf('day').toDate();\n    const maxDate = moment(earliestDate).add(7,\
            \ 'days').endOf('day').toDate();\n    scheduleBuilder.add({name: \"\"\
            Child Home Visit - Post NRC\"\", encounterType: \"\"Child Home Visit\"\
            \", earliestDate, maxDate, visitCreationStrategy: \"\"createNew\"\"});\
            \  \n  }\n  \n  return scheduleBuilder.getAll();\n \n};\"\nEncounter,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const encounter = params.entity;\n\
            \  const moment = imports.moment;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({encounter});\n\
            \  const visitMonthYear = moment(encounter.encounterDateTime).format('MMMM\
            \ YYYY'); \n  const visitName = `Training Completion - for ${visitMonthYear}`;\n\
            \n  function visitAlreadyScheduled(visitType, visitName){\n    return\
            \ encounter.individual.getEncounters().some((enc)=> enc.encounterType.name\
            \ == visitType && enc.name == visitName);\n  }\n\n  const isTrainingRequired\
            \ = new imports.rulesConfig.RuleCondition({encounter}).when.valueInEncounter(\"\
            \"159cdded-1238-4448-a6bb-2cf301c4905b\"\").containsAnswerConceptName(\"\
            \"8ebbf088-f292-483e-9084-7de919ce67b7\"\").matches();\n  \n  if(isTrainingRequired\
            \ && !visitAlreadyScheduled(\"\"Training Completion\"\", visitName)){\n\
            \    const earliestDate = moment(encounter.encounterDateTime).add(1, 'month').startOf('month').toDate();\n\
            \    const maxDate = moment(earliestDate).endOf('month').toDate();\n \
            \   scheduleBuilder.add({\n      name: visitName, \n      encounterType:\
            \ \"\"Training Completion\"\", \n      earliestDate, \n      maxDate,\n\
            \      visitCreationStrategy: \"\"createNew\"\"\n    });  \n  }\n  \n\
            \  return scheduleBuilder.getAll();\n};\"\nProgramEnrolment,\"\"\"use\
            \ strict\"\";\n({ params, imports }) => {\n  const programEnrolment =\
            \ params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({programEnrolment});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEnrolment}).when.ageInYears.lessThanOrEqualTo(6).matches();\n\
            \  \n  if(condition11 ){\n    const earliestDate = moment(programEnrolment.getObservationReadableValue('fbf6eee4-ed36-4570-a305-e97eacd50136')).add(0,\
            \ 'days').startOf('day').toDate();\n    const maxDate = moment(programEnrolment.getObservationReadableValue('fbf6eee4-ed36-4570-a305-e97eacd50136')).add(30,\
            \ 'days').endOf('day').toDate();\n    scheduleBuilder.add({name: \"\"\
            Malnutrition Followup\"\", encounterType: \"\"Malnutrition Followup\"\"\
            , earliestDate, maxDate});  \n}\n  \n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounter,\"\"\"use strict\"\";\n({ params, imports }) =>\
            \ {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.ageInYears.lessThanOrEqualTo(6).matches();\n\
            \  \n  console.log('condition11-->',condition11);\n  \n  if(condition11){\n\
            \    const earliestDate = moment(programEncounter.getObservationReadableValue('fbf6eee4-ed36-4570-a305-e97eacd50136')).add(0,\
            \ 'days').toDate();\n    const maxDate = moment(programEncounter.getObservationReadableValue('fbf6eee4-ed36-4570-a305-e97eacd50136')).add(30,\
            \ 'days').toDate();\n    scheduleBuilder.add({name: \"\"Malnutrition Followup\"\
            \", encounterType: \"\"Malnutrition Followup\"\", earliestDate, maxDate});\
            \  \n}\n  \n  return scheduleBuilder.getAll();\n};\"\nEncounter,\"\"\"\
            use strict\"\";\n({ params, imports }) => {\n  const encounter = params.entity;\n\
            \  const moment = imports.moment;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({encounter});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({encounter}).when.ageInYears.greaterThan(6).and.when.valueInEncounter(\"\
            \"3a822fa1-c524-4d6d-afba-998f516f42e3\"\").containsAnswerConceptName(\"\
            \"722371f5-3cb7-493e-8334-aa3c9cc88b86\"\").matches();\n    \n  const\
            \ condition12 = new imports.rulesConfig.RuleCondition({encounter}).when.valueInEncounter(\"\
            \"a3ef5831-4073-463e-9cef-2403167f7d8d\"\").containsAnswerConceptName(\"\
            \"1bc21eb3-f2f3-4d85-bdc0-ec1ae0e56672\"\").or.when.valueInEncounter(\"\
            \"b5d0a3d6-c39f-49ad-8e49-d0be09116c21\"\").containsAnswerConceptName(\"\
            \"a6a7e47d-c258-4e4e-840c-d8bd6cefc7b4\"\").matches();\n  \n  const condition22\
            \ = new imports.rulesConfig.RuleCondition({encounter}).when.ageInYears.greaterThan(6).matches();\n\
            \  \n  if(condition11 ){\n    const earliestDate = moment(encounter.encounterDateTime).add(365,\
            \ 'days').startOf('day').toDate();\n    const maxDate = moment(encounter.encounterDateTime).add(395,\
            \ 'days').endOf('day').toDate();\n    scheduleBuilder.add({name: \"\"\
            Screening\"\", encounterType: \"\"Screening\"\", earliestDate, maxDate});\
            \  \n}\n    if(condition12 && condition22 ){\n    const earliestDate =\
            \ moment(encounter.getObservationReadableValue('fbf6eee4-ed36-4570-a305-e97eacd50136')).add(0,\
            \ 'days').startOf('day').toDate();\n    const maxDate = moment(encounter.getObservationReadableValue('fbf6eee4-ed36-4570-a305-e97eacd50136')).add(30,\
            \ 'days').endOf('day').toDate();\n    scheduleBuilder.add({name: \"\"\
            Screening Followup\"\", encounterType: \"\"Screening Followup\"\", earliestDate,\
            \ maxDate});  \n}\n  \n  return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const programEncounter\
            \ = params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.ageInMonths.lessThanOrEqualTo(24).matches();\n\
            \  const dateOfBirth = programEncounter.programEnrolment.individual.dateOfBirth;\n\
            \  \n  if(condition11 ){\n    const earliestDate = moment(dateOfBirth).add(720\
            \ - 20, 'days').toDate();\n    const maxDate = moment(dateOfBirth).add(740,\
            \ 'days').toDate();\n    scheduleBuilder.add({name: \"\"MDAT 24 month\"\
            \", encounterType: \"\"MDAT 24M\"\", earliestDate, maxDate});  \n}\n \
            \ \n  return scheduleBuilder.getAll();\n};\"\nEncounter,\"//SAMPLE RULE\
            \ EXAMPLE\n\"\"use strict\"\";\n({ params, imports }) => {\n  const encounter\
            \ = params.entity;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\n\
            \    encounter\n  });\n  const _ = imports.lodash;\n  const moment = imports.moment;\n\
            \  const registrationDate = encounter.individual.registrationDate;\n \
            \ const ageInYears = encounter.individual.getAgeInYears();\n  const encounterDate\
            \ = encounter.encounterDateTime;\n  \n  const getEnc = encounter.individual.getEncounters(true);\n\
            \  const getAllCompletedEncounters = _.chain(getEnc)\n  .filter(enc =>\
            \ enc.encounterDateTime != null)\n  .map(e => e.name)\n  .value();\n \
            \ \n  const allBloodSampleResultEncounters = _.chain(getEnc)\n  .filter(enc\
            \ => enc.encounterType.name === 'Record blood sample result')\n  .map(e\
            \ => e.name)\n  .value();\n   \n   let bloodCollectionConsent = encounter.getObservationReadableValue('9ed8822f-d840-439d-aefb-729f1c313cf6');\n\
            \   \n  const editScenarioFunction = () => {\n  let eligible = true;\n\
            \      for ( let i=0; i<getAllCompletedEncounters.length; i++) {\n   \
            \       if ( getAllCompletedEncounters[i] === encounter.name ) return\
            \ eligible = false;\n      }\n     return eligible;\n  };\n\n  if (encounter.name\
            \ === 'Collect baseline blood sample details' && ageInYears >= 17 ) {\n\
            \  \n  if ( editScenarioFunction() ) {\n    scheduleBuilder\n        \
            \    .add({\n                name: \"\"Collect 1st year blood sample\"\
            \",\n                encounterType: \"\"Collect blood sample details\"\
            \",\n                earliestDate:  moment(encounterDate).add(365, 'days').toDate()\
            \ ,\n                maxDate: moment(encounterDate).add(372, 'days').toDate()\n\
            \            });\n    };\n   \n   if (bloodCollectionConsent == \"\"Yes\"\
            \" && !_.includes(allBloodSampleResultEncounters, 'Record baseline blood\
            \ sample result 1' ) ) {\n   scheduleBuilder\n            .add({\n   \
            \             name: \"\"Record baseline blood sample result 1\"\",\n \
            \               encounterType: \"\"Record blood sample result\"\",\n \
            \               earliestDate:  moment(encounterDate).add(0, 'days').toDate()\
            \ ,\n                maxDate: moment(encounterDate).add(2, 'days').toDate()\n\
            \            });\n      };\n  };\n  \n  if (encounter.name === 'Collect\
            \ 1st year blood sample' && ageInYears >= 17) {\n  \n  if ( editScenarioFunction()\
            \ ) {\n    scheduleBuilder\n            .add({\n                name:\
            \ \"\"Collect 2nd year blood sample\"\",\n                encounterType:\
            \ \"\"Collect blood sample details\"\",\n                earliestDate:\
            \  moment(encounterDate).add(730, 'days').toDate() ,\n               \
            \ maxDate: moment(encounterDate).add(737, 'days').toDate()\n         \
            \   });\n    };\n    \n   if (bloodCollectionConsent == \"\"Yes\"\" &&\
            \ !_.includes(allBloodSampleResultEncounters, 'Record blood sample result\
            \ 2') ) {            \n    scheduleBuilder\n            .add({\n     \
            \           name: \"\"Record blood sample result 2\"\",\n            \
            \    encounterType: \"\"Record blood sample result\"\",\n            \
            \    earliestDate:  moment(encounterDate).add(0, 'days').toDate() ,\n\
            \                maxDate: moment(encounterDate).add(2, 'days').toDate()\n\
            \            });\n      }\n  };\n\n  if (encounter.name === 'Collect 2nd\
            \ year blood sample') {\n    \n   if (bloodCollectionConsent == \"\"Yes\"\
            \" && !_.includes(allBloodSampleResultEncounters, 'Record blood sample\
            \ result 3')) {    \n    scheduleBuilder\n            .add({\n       \
            \         name: \"\"Record blood sample result 3\"\",\n              \
            \  encounterType: \"\"Record blood sample result\"\",\n              \
            \  earliestDate:  moment(encounterDate).add(1, 'days').toDate() ,\n  \
            \              maxDate: moment(encounterDate).add(4, 'days').toDate()\n\
            \            });\n      }\n  };\n  \n\n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounter,\"\"\"use strict\"\";\n({ params, imports }) =>\
            \ {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.ageInMonths.lessThanOrEqualTo(24).matches();\n\
            \  const dateOfBirth = programEncounter.programEnrolment.individual.dateOfBirth;\n\
            \  \n  if(condition11 ){\n    const earliestDate = moment(dateOfBirth).add(545\
            \ - 20, 'days').toDate();\n    const maxDate = moment(dateOfBirth).add(560,\
            \ 'days').toDate();\n    scheduleBuilder.add({name: \"\"MDAT 18 month\"\
            \", encounterType: \"\"MDAT 18M\"\", earliestDate, maxDate});  \n}\n \
            \ \n  return scheduleBuilder.getAll();\n};\"\nProgramEnrolment,\"\"\"\
            use strict\"\";\n({ params, imports }) => {\n  const programEnrolment\
            \ = params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({programEnrolment});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEnrolment}).when.lowestAddressLevel.defined.matches();\n\
            \  \n  const getEnc = programEnrolment.getEncounters(true);\n  const getAllCompletedEncounters\
            \ = _.chain(getEnc)\n  .filter(enc => enc.encounterDateTime != null)\n\
            \  .map(e => e.name)\n  .value();\n   \n  const comparisonFunction = ()\
            \ => {\n  let eligible = true;\n      for ( let i=0; i<getAllCompletedEncounters.length;\
            \ i++) {\n          if ( getAllCompletedEncounters[i] === \"\"Record child\
            \ baseline anthropomtery details\"\" ) return eligible = false;\n    \
            \  }\n      return eligible;\n  };\n  \n  // console.log('getAllCompletedEncounters--------->',getAllCompletedEncounters);\n\
            \  // console.log('comparisonFunction--------->',comparisonFunction());\n\
            \  \n  if( condition11 && comparisonFunction() ){\n    const earliestDate\
            \ = moment(programEnrolment.enrolmentDateTime).add(0, 'days').toDate();\n\
            \    const maxDate = moment(programEnrolment.enrolmentDateTime).add(20,\
            \ 'days').toDate();\n    scheduleBuilder.add({name: \"\"Record child baseline\
            \ anthropometry details\"\", encounterType: \"\"Record child anthropometry\
            \ details\"\", earliestDate, maxDate});  \n}\n\n  const dateOfBirth =\
            \ programEnrolment.individual.dateOfBirth; // Access dateOfBirth\n\n \
            \ const condition22 = new imports.rulesConfig.RuleCondition({ programEnrolment\
            \ })\n    .when\n    .ageInMonths.lessThanOrEqualTo(6) // Ensure ageInMonths\
            \ is calculated correctly\n    .matches();\n\n  if (condition22) {\n \
            \   const earliestDate = moment(dateOfBirth).add(90 - 20, \"\"days\"\"\
            ).toDate(); // Use dateOfBirth\n    const maxDate = moment(dateOfBirth).add(110,\
            \ \"\"days\"\").toDate(); // Use dateOfBirth\n    scheduleBuilder.add({\
            \ name: \"\"MDAT 3 month\"\", encounterType: \"\"MDAT 3M\"\", earliestDate,\
            \ maxDate });\n  }\n  \n    if (condition22) {\n    const earliestDate\
            \ = moment(dateOfBirth).add(90, \"\"days\"\").toDate(); // Use dateOfBirth\n\
            \    const maxDate = moment(dateOfBirth).add(110, \"\"days\"\").toDate();\
            \ // Use dateOfBirth\n    scheduleBuilder.add({ name: \"\"3 Month child\
            \ metadata\"\", encounterType: \"\"Child metadata 3 month\"\", earliestDate,\
            \ maxDate });\n  }\n   \n  \n  \n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounterCancellation,\"\"\"use strict\"\";\n({ params, imports\
            \ }) => {\n  const programEncounter = params.entity;\n  const moment =\
            \ imports.moment;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const encounterType = programEncounter.encounterType.name;\n\n\
            \  const isActiveInProgram = !programEncounter.programEnrolment.programExitDateTime;\n\
            \n  const pncVistFrequency = {\n      'PNC Followup 1': {nextFollowupName:\
            \ 'PNC Followup 2', delimeter: 'day', value: 7},\n      'PNC Followup\
            \ 2': {nextFollowupName: 'PNC Followup 3', delimeter: 'day', value: 14},\n\
            \      'PNC Followup 3': {nextFollowupName: 'PNC Followup 4', delimeter:\
            \ 'day', value: 21},\n      'PNC Followup 4': {nextFollowupName: 'PNC\
            \ Followup 5', delimeter: 'day', value: 28},\n      'PNC Followup 5':\
            \ {nextFollowupName: 'PNC Followup 6', delimeter: 'day', value: 42},\n\
            \      'PNC Followup 6': {nextFollowupName: 'PNC Followup 7', delimeter:\
            \ 'month', value: 3},\n      'PNC Followup 7': {nextFollowupName: 'PNC\
            \ Followup 8', delimeter: 'month', value: 4},\n      'PNC Followup 8':\
            \ {nextFollowupName: 'PNC Followup 9', delimeter: 'month', value: 5},\n\
            \      'PNC Followup 9': {nextFollowupName: 'PNC Followup 10', delimeter:\
            \ 'month', value: 6}\n  }\n\n  const currentProgramEncounterName = programEncounter.name;\n\
            \  const nextVisitObj = pncVistFrequency[currentProgramEncounterName];\n\
            \n  const existingEncounters = programEncounter.programEnrolment.getEncountersOfType(\"\
            \"Delivery\"\");\n\n  let dateOfDelivery = null;\n\n  if(existingEncounters\
            \ && existingEncounters.length > 0) {\n      dateOfDelivery = existingEncounters[0].getObservationReadableValue('5f9a5098-d052-4843-8e13-0c1f455490fc');\n\
            \  }\n  function isAlreadyScheduled(nextVisitName, earliestDate) {   \
            \ \n      const nextVisitDate = moment(earliestDate);\n      const existingEncounters\
            \ = programEncounter.programEnrolment.getEncountersOfType(encounterType);\n\
            \      return existingEncounters.some((enc) =>\n          enc.voided ==\
            \ false &&\n          (enc.name == nextVisitName ||\n          moment(enc.earliestVisitDateTime).isSame(nextVisitDate,\
            \ 'day'))\n      );\n  }\n  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInCancelEncounter(\"\
            \"e19ded48-c845-4a50-91ab-0d559d570b39\"\").containsAnyAnswerConceptName(\"\
            \"7aa91832-43d7-4ed6-8fe4-feabf1455cf7\"\",\"\"c28401fc-3b61-4c8d-a2a6-6c97df6ff61b\"\
            \").matches();\n  \n  if(condition11 && isActiveInProgram && nextVisitObj\
            \ && dateOfDelivery){\n      const earliestDate = moment(dateOfDelivery).add(nextVisitObj.value,\
            \ nextVisitObj.delimeter).startOf('day').toDate();\n      const maxDate\
            \ = moment(earliestDate).add(10, 'days').endOf('day').toDate();\n    \
            \  \n      if (!isAlreadyScheduled(nextVisitObj.nextFollowupName, earliestDate))\
            \ {\n          scheduleBuilder.add({name: nextVisitObj.nextFollowupName,\
            \ encounterType: encounterType, earliestDate, maxDate});  \n      }\n\
            \  }\n  \n  return scheduleBuilder.getAll();\n};\"\nProgramEnrolment,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const programEnrolment\
            \ = params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({programEnrolment});\n\
            \n  const isChildFollowUpAlreadyScheduled = programEnrolment.getEncountersOfType(\"\
            \"Child - Follow up\"\").length > 0;\n  \n  if(!isChildFollowUpAlreadyScheduled\
            \ ){\n    const earliestDate = moment(programEnrolment.enrolmentDateTime).add(2,\
            \ 'days').startOf('day').toDate();\n    const maxDate = moment(earliestDate).add(10,\
            \ 'days').endOf('day').toDate();\n    scheduleBuilder.add({name: \"\"\
            Child Followup 1\"\", encounterType: \"\"Child - Follow up\"\", earliestDate,\
            \ maxDate});  \n}\n  \n  return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\
            \n\"\"use strict\"\";\n({ params, imports }) => {\n  const programEncounter\
            \ = params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \n  const condition12 = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInRegistration(\"\
            \"cf7b2dff-fbbb-486a-a57d-cf6b554442dc\"\").containsAnswerConceptName(\"\
            \"1e8059b5-06d9-4121-9ef9-4bb6da5b06a9\"\").or.when.valueInRegistration(\"\
            \"72aeaaed-756f-4b62-b72f-53df76745cac\"\").defined.matches();\n  \n \
            \   const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"\
            \"cb4952df-4be8-42d4-afab-ca89ee3f2be6\"\").defined.matches();\n\n  \n\
            \  if(condition12 ){\n    const earliestDate = moment(programEncounter.encounterDateTime).add(160,\
            \ 'days').toDate();\n    const maxDate = moment(programEncounter.encounterDateTime).add(180,\
            \ 'days').toDate();\n    scheduleBuilder.add({name: \"\"24H Food recall\
            \ 6M family member\"\", encounterType: \"\"Food recall 24 family member\"\
            \", earliestDate, maxDate});  \n}\n    if(condition11 ){\n    const earliestDate\
            \ = moment(programEncounter.programEnrolment.enrolmentDateTime).add(160,\
            \ 'days').toDate();\n    const maxDate = moment(programEncounter.programEnrolment.enrolmentDateTime).add(180,\
            \ 'days').toDate();\n    scheduleBuilder.add({name: \"\"Substance use\
            \ 6 M follow-up\"\", encounterType: \"\"Substance use follow-up (6 M)\"\
            \", earliestDate, maxDate});  \n}\n  \n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounter,\"\"\"use strict\"\";\n({ params, imports }) =>\
            \ {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"\
            \"b4d12cc6-bdbf-44d5-bf5d-f277fda9942c\"\").defined.matches();\n    \n\
            \  const deliveryDate = programEncounter.programEnrolment.individual.getEncounters(true)\n\
            \    .filter(enc => enc.encounterType.name === 'Delivery')\n    .map(enc\
            \ => enc.getObservationValue('13eb9132-480f-4e7b-a89f-53c26dc5447d'))[0];\
            \ // Extract first date\n  \n  if(condition11 ){\n    const earliestDate\
            \ = moment(deliveryDate).add(365, 'days').toDate();\n    const maxDate\
            \ = moment(deliveryDate).add(385, 'days').toDate();\n    scheduleBuilder.add({name:\
            \ \"\"12th month 24H food recall (Mother)\"\", encounterType: \"\"Food\
            \ recall 24 hours\"\", earliestDate, maxDate});  \n}\n  \n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounterCancellation,\"//SAMPLE RULE EXAMPLE\n\"\"use strict\"\
            \";\n({ params, imports }) => {\n  const programEncounter = params.entity;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\n\
            \    programEncounter\n  });\n  const formElement = params.formElement;\n\
            \  const moment = imports.moment;\n  const cancelledEnc = programEncounter.name;\n\
            \  const cancelledDate = programEncounter.cancelDateTime;\n  \n  const\
            \ reasonForCancelIsDeathOrMigration = new imports.rulesConfig.RuleCondition({programEncounter,\
            \ formElement}).when.valueInCancelEncounter(\"\"ee6d9279-6b34-4606-a279-be51a9e0e09c\"\
            \").containsAnyAnswerConceptName(\"\"3891a42a-61f8-4948-b501-476a54c3963c\"\
            \",\"\"53e2a5f8-ec3e-4b26-84e1-a8c20aaa64b4\"\").matches();\n  \n  const\
            \ earliestDate = moment(cancelledDate).add(7, 'days').toDate();\n  const\
            \ maxDate = moment(cancelledDate).add(10, 'days').toDate();\n  \n  if\
            \ (!reasonForCancelIsDeathOrMigration) scheduleBuilder.add({name:cancelledEnc\
            \ , encounterType: \"\"Record mother anthropometry details\"\", earliestDate,\
            \ maxDate});  \n\n\n  return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\
            //SAMPLE RULE EXAMPLE\n\"\"use strict\"\";\n({ params, imports }) => {\n\
            \    const programEncounter = params.entity;\n    const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({\n        programEncounter\n\
            \    });\n    const _ = imports.lodash;\n    const moment = imports.moment;\n\
            \n    const encounterScheduler = [\n        { \"\"name\"\": \"\"Record\
            \ 3rd month mother anthropometry details\"\", \"\"encName\"\": \"\"Record\
            \ mother anthropometry details\"\", \"\"earliest\"\": 90, \"\"max\"\"\
            : 110 },\n        { \"\"name\"\": \"\"Record 6th month mother anthropometry\
            \ details\"\", \"\"encName\"\": \"\"Record mother anthropometry details\"\
            \", \"\"earliest\"\": 180, \"\"max\"\": 200 },\n        { \"\"name\"\"\
            : \"\"Record 12th month mother anthropometry details\"\", \"\"encName\"\
            \": \"\"Record mother anthropometry details\"\", \"\"earliest\"\": 365,\
            \ \"\"max\"\": 385 },\n        { \"\"name\"\": \"\"Record 18th month mother\
            \ anthropometry details\"\", \"\"encName\"\": \"\"Record mother anthropometry\
            \ details\"\", \"\"earliest\"\": 545, \"\"max\"\": 565 },\n        { \"\
            \"name\"\": \"\"Record 2nd year mother anthropometry details\"\", \"\"\
            encName\"\": \"\"Record mother anthropometry details\"\", \"\"earliest\"\
            \": 730, \"\"max\"\": 750 },\n        { \"\"name\"\": \"\"Record 3rd year\
            \ mother anthropometry details\"\", \"\"encName\"\": \"\"Record mother\
            \ anthropometry details\"\", \"\"earliest\"\": 1095, \"\"max\"\": 1115\
            \ },\n        { \"\"name\"\": \"\"Record 4th year mother anthropometry\
            \ details\"\", \"\"encName\"\": \"\"Record mother anthropometry details\"\
            \", \"\"earliest\"\": 1460, \"\"max\"\": 1480 },\n        { \"\"name\"\
            \": \"\"Record 5th year mother anthropometry details\"\", \"\"encName\"\
            \": \"\"Record mother anthropometry details\"\", \"\"earliest\"\": 1825,\
            \ \"\"max\"\": 1845 }\n    ];\n\n    const dataOfDelivery = programEncounter.programEnrolment.individual.getEncounters(true)\n\
            \        .filter( enc => enc.encounterType.name === 'Delivery' )\n   \
            \     .map( enc => enc.getObservationValue('13eb9132-480f-4e7b-a89f-53c26dc5447d')\
            \ );\n    \n    let schedule = _.chain(encounterScheduler)\n        .filter(e\
            \ => (programEncounter.programEnrolment.hasEncounter('Record mother anthropometry\
            \ details', e.name)) === false)\n        .first()\n        .value();\n\
            \    \n    const getEnc = programEncounter.programEnrolment.getEncounters(true);\n\
            \    const getAllCompletedEncounters = _.chain(getEnc)\n        .filter(e\
            \ => e.encounterDateTime != null)\n        .map(e => e.name)\n       \
            \ .value();\n    \n    const comparisonFunction = () => {\n        let\
            \ eligible = true;\n        for ( let i=0; i<getAllCompletedEncounters.length;\
            \ i++) {\n            if ( getAllCompletedEncounters[i] === programEncounter.name\
            \ ) return eligible = false;\n        };\n        return eligible;\n \
            \   }; \n      \n    if ( !_.isEmpty(schedule) && comparisonFunction()\
            \ ) {\n\n        scheduleBuilder.add({\n            name: schedule.name,\n\
            \            encounterType: schedule.encName,\n            earliestDate:\
            \  moment(dataOfDelivery[0]).add(schedule.earliest, 'days').toDate() ,\n\
            \            maxDate: moment(dataOfDelivery[0]).add(schedule.max, 'days').toDate()\n\
            \        });\n    }\n\n    return scheduleBuilder.getAll();\n};\"\nEncounter,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n    const encounter =\
            \ params.entity;\n    const moment = imports.moment;\n    const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({ encounter });\n   \
            \ const _ = imports.lodash;\n\n    const getEnc = encounter.individual.getEncounters(true);\n\
            \    const getAllEncounters = _.chain(getEnc)\n        .map(e => e.name)\n\
            \        .value();\n\n    const comparisonFunction = (followUpName) =>\
            \ {\n        // Check if the specific follow-up encounter is already scheduled\n\
            \        return !scheduleBuilder.getAll().some(enc => enc.name === followUpName);\n\
            \    };\n\n    // Refactored schedule adding logic into a function\n \
            \   const addAppointment = (name, earliestDateOffset, maxDateOffset, encounterType\
            \ = \"\"Record Anthropometry details\"\") => {\n        const earliestDate\
            \ = moment(encounter.individual.registrationDate).add(earliestDateOffset,\
            \ \"\"days\"\").toDate();\n        const maxDate = moment(encounter.individual.registrationDate).add(maxDateOffset,\
            \ \"\"days\"\").toDate();\n\n        scheduleBuilder.add({\n         \
            \   name,\n            encounterType,\n            earliestDate,\n   \
            \         maxDate,\n        });\n    };\n\n    // Use addAppointment function\
            \ with comparisonFunction\n    if (encounter.name === \"\"Record Anthropometry\
            \ details\"\" && comparisonFunction(\"\"6M Anthropometry\"\")) {\n   \
            \     addAppointment(\"\"6M Anthropometry\"\", 160, 180);\n    }\n   \
            \ else if (encounter.name === \"\"6M Anthropometry\"\" && comparisonFunction(\"\
            \"12M Anthropometry\"\")) {\n        addAppointment(\"\"12M Anthropometry\"\
            \", 360, 380);\n    }\n    else if (encounter.name === \"\"12M Anthropometry\"\
            \" && comparisonFunction(\"\"24M Anthropometry\"\")) {\n        addAppointment(\"\
            \"24M Anthropometry\"\", 710, 725);\n    }\n    else if (encounter.name\
            \ === \"\"24M Anthropometry\"\" && comparisonFunction(\"\"3Y Anthropometry\"\
            \")) {\n        addAppointment(\"\"3Y Anthropometry\"\", 1075, 1105);\n\
            \    }\n    else if (encounter.name === \"\"3Y Anthropometry\"\" && comparisonFunction(\"\
            \"4Y Anthropometry\"\")) {\n        addAppointment(\"\"4Y Anthropometry\"\
            \", 1440, 1470);\n    }\n    else if (encounter.name === \"\"4Y Anthropometry\"\
            \" && comparisonFunction(\"\"5Y Anthropometry\"\")) {\n        addAppointment(\"\
            \"5Y Anthropometry\"\", 1805, 1835);\n    }\n\n    // ... continue with\
            \ remaining appointments using addAppointment and the modified comparisonFunction\n\
            \n    return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\"\"\
            use strict\"\";\n({ params, imports }) => {\n  const programEncounter\
            \ = params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({ programEncounter });\n\
            \n  const isChildOlderThan36Months = new imports.rulesConfig.RuleCondition({\
            \ programEncounter })\n    .when.ageInMonths.greaterThanOrEqualTo(36)\n\
            \    .matches();\n\n  const dateOfBirth = programEncounter.programEnrolment.individual.dateOfBirth;\n\
            \  \n  const mdat26m = programEncounter.programEnrolment.getEncountersOfType('MDAT\
            \ 36M')\n  \n  const isAlreadyScheduled = mdat26m && mdat26m.length >\
            \ 0;\n\n  if (!isAlreadyScheduled && isChildOlderThan36Months && dateOfBirth)\
            \ {\n    const earliestDate = moment(dateOfBirth).add(36, 'months').subtract(20,\
            \ 'days').startOf('day').toDate();\n    const maxDate = moment(earliestDate).add(20,\
            \ 'days').endOf('day').toDate();\n\n    scheduleBuilder.add({\n      name:\
            \ \"\"MDAT 36M\"\",\n      encounterType: \"\"MDAT 36M\"\",\n      earliestDate,\n\
            \      maxDate\n    });\n  }\n\n  return scheduleBuilder.getAll();\n};\"\
            \nProgramEncounter,\"\"\"use strict\"\";\n({ params, imports }) => {\n\
            \    const programEncounter = params.entity;\n    const moment = imports.moment;\n\
            \    const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \n    const isNotActiveInProgram = programEncounter.programEnrolment.programExitDateTime;\n\
            \n    const individualIsDead = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"\
            \"72ead993-4a80-4e96-86dc-44d48dc868e9\"\").containsAnswerConceptName(\"\
            \"3891a42a-61f8-4948-b501-476a54c3963c\"\").matches();\n\n    if(individualIsDead\
            \ || isNotActiveInProgram) {\n        return scheduleBuilder.getAll();\n\
            \    }\n\n    const currentEncounterName = programEncounter.name;\n\n\
            \    const existingEncounters = programEncounter.programEnrolment.getEncountersOfType(\"\
            \"Substance use follow up\"\");\n\n    function isAlreadyScheduled(existingEncounters,\
            \ earliestDate, encounterName) {\n        return existingEncounters.some((enc)\
            \ =>\n            enc.voided === false &&\n            (enc.name == encounterName\
            \ ||\n            moment(enc.earliestVisitDateTime).isSame(earliestDate,\
            \ 'day'))\n        );\n    }\n\n    function getNextEncounter(currentEncounterName)\
            \ {\n        const match = currentEncounterName.match(/^(\\d+)([MY])/);\n\
            \        if (!match) return null;\n        \n        let year = parseInt(match[1],\
            \ 10);\n        const unit = match[2];\n        \n        if (year ===\
            \ 24 && unit === 'M') {\n          return {\n            name: `3Y Substance\
            \ use follow-up`,\n            year: 3\n          };\n        }\n  \n\
            \        year++;\n        \n        return {\n            name: `${year}Y\
            \ Substance use follow-up`,\n            year: year\n        };\n    }\n\
            \n    const nextEncounter = getNextEncounter(currentEncounterName);\n\
            \    if(nextEncounter) {    \n        const earliestDate = moment(programEncounter.programEnrolment.enrolmentDateTime).add(nextEncounter.year,\
            \ 'year').startOf('day').toDate();\n        const maxDate = moment(earliestDate).add(40,\
            \ 'days').endOf('day').toDate();\n    \n        if(!isAlreadyScheduled(existingEncounters,\
            \ moment(earliestDate), nextEncounter.name)) {\n            scheduleBuilder.add({\n\
            \                name: nextEncounter.name, \n                encounterType:\
            \ \"\"Substance use follow up\"\", \n                earliestDate, \n\
            \                maxDate\n            });  \n        }\n    }\n    \n\
            \    return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\"\"use\
            \ strict\"\";\n({ params, imports }) => {\n    const programEncounter\
            \ = params.entity;\n    const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\n\
            \        programEncounter\n    });\n    const _ = imports.lodash;\n  \
            \  const moment = imports.moment;\n    const encounterScheduler = [\n\
            \        { \"\"name\"\": \"\"Record 3rd month child anthropometry details\"\
            \", \"\"encName\"\": \"\"Record child anthropometry details\"\", \"\"\
            earliest\"\": 90 - 20, \"\"max\"\": 110 },\n        { \"\"name\"\": \"\
            \"Record 6th month child anthropometry details\"\", \"\"encName\"\": \"\
            \"Record child anthropometry details\"\", \"\"earliest\"\": 180 - 20,\
            \ \"\"max\"\": 200 },\n        { \"\"name\"\": \"\"Record 12th month child\
            \ anthropometry details\"\", \"\"encName\"\": \"\"Record child anthropometry\
            \ details\"\", \"\"earliest\"\": 365 - 20, \"\"max\"\": 385 },\n     \
            \   { \"\"name\"\": \"\"Record 18th month child anthropometry details\"\
            \", \"\"encName\"\": \"\"Record child anthropometry details\"\", \"\"\
            earliest\"\": 545 - 20, \"\"max\"\": 565 },\n        { \"\"name\"\": \"\
            \"Record 2nd year child anthropometry details\"\", \"\"encName\"\": \"\
            \"Record child anthropometry details\"\", \"\"earliest\"\": 730 - 20,\
            \ \"\"max\"\": 750 },\n        { \"\"name\"\": \"\"Record 3rd year child\
            \ anthropometry details\"\", \"\"encName\"\": \"\"Record child anthropometry\
            \ details\"\", \"\"earliest\"\": 1095 - 20, \"\"max\"\": 1115 },\n   \
            \     { \"\"name\"\": \"\"Record 4th year child anthropometry details\"\
            \", \"\"encName\"\": \"\"Record child anthropometry details\"\", \"\"\
            earliest\"\": 1460 - 20, \"\"max\"\": 1480 },\n        { \"\"name\"\"\
            : \"\"Record 5th year child anthropometry details\"\", \"\"encName\"\"\
            : \"\"Record child anthropometry details\"\", \"\"earliest\"\": 1825 -\
            \ 20, \"\"max\"\": 1845 }\n    ];\n\n    const dateOfBirth = programEncounter.programEnrolment.individual.dateOfBirth;\n\
            \    \n    let schedule = _.chain(encounterScheduler)\n        .filter(e\
            \ => (programEncounter.programEnrolment.hasEncounter('Record child anthropometry\
            \ details', e.name)) === false)\n        .first()\n        .value();\n\
            \    \n    const getEnc = programEncounter.programEnrolment.getEncounters(true);\n\
            \    const getAllCompletedEncounters = _.chain(getEnc)\n        .filter(e\
            \ => e.encounterDateTime != null)\n        .map(e => e.name)\n       \
            \ .value();\n  \n    const comparisonFunction = () => {\n        let eligible\
            \ = true;\n        for ( let i=0; i<getAllCompletedEncounters.length;\
            \ i++) {\n            if ( getAllCompletedEncounters[i] === programEncounter.name\
            \ ) return eligible = false;\n        };\n        return eligible;\n \
            \   }; \n    \n    if ( !_.isEmpty(schedule) && comparisonFunction() )\
            \ {\n\n        scheduleBuilder.add({\n            name: schedule.name,\n\
            \            encounterType: schedule.encName,\n            earliestDate:\
            \  moment(dateOfBirth).add(schedule.earliest, 'days').toDate() ,\n   \
            \         maxDate: moment(dateOfBirth).add(schedule.max, 'days').toDate()\n\
            \        });\n    }\n\n    return scheduleBuilder.getAll();\n};\"\nProgramEncounterCancellation,\"\
            //SAMPLE RULE EXAMPLE\n\"\"use strict\"\";\n({ params, imports }) => {\n\
            \  const programEncounter = params.entity;\n  const scheduleBuilder =\
            \ new imports.rulesConfig.VisitScheduleBuilder({\n    programEncounter\n\
            \  });\n  const formElement = params.formElement;\n  const moment = imports.moment;\n\
            \  const cancelledEnc = programEncounter.name;\n  const cancelledDate\
            \ = programEncounter.cancelDateTime;\n  \n  const reasonForCancelIsDeathOrMigration\
            \ = new imports.rulesConfig.RuleCondition({programEncounter, formElement}).when.valueInCancelEncounter(\"\
            \"ee6d9279-6b34-4606-a279-be51a9e0e09c\"\").containsAnyAnswerConceptName(\"\
            \"3891a42a-61f8-4948-b501-476a54c3963c\"\",\"\"53e2a5f8-ec3e-4b26-84e1-a8c20aaa64b4\"\
            \").matches();\n  \n  const earliestDate = moment(cancelledDate).add(7,\
            \ 'days').toDate();\n  const maxDate = moment(cancelledDate).add(10, 'days').toDate();\n\
            \  \n  if (!reasonForCancelIsDeathOrMigration) scheduleBuilder.add({name:cancelledEnc\
            \ , encounterType: \"\"Record child anthropometry details\"\", earliestDate,\
            \ maxDate});  \n\n\n  return scheduleBuilder.getAll();\n};\"\nIndividualProfile,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const individual =\
            \ params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({individual});\n  const\
            \ _ = imports.lodash;\n  \n  const lmpDefined = new imports.rulesConfig.RuleCondition({individual}).when.valueInRegistration(\"\
            \"292a3bf0-8777-4551-ad5d-8d0d8af7747e\"\").defined.matches();\n    \n\
            \  const condition12 = new imports.rulesConfig.RuleCondition({individual}).when.ageInMonths.greaterThanOrEqualTo(6).and.when.valueInRegistration(\"\
            \"292a3bf0-8777-4551-ad5d-8d0d8af7747e\"\").notDefined.matches();\n  \
            \  \n  \n  const deliveryEncPresent = _.find(individual.encounters, enc\
            \ => enc.getObservationValue('13eb9132-480f-4e7b-a89f-53c26dc5447d'));\n\
            \  \n  const getEnc = individual.getEncounters(true);\n  const getAllCompletedEncounters\
            \ = _.chain(getEnc)\n  .filter(enc => enc.encounterDateTime != null)\n\
            \  .map(e => e.name)\n  .value();\n   \n  const comparisonFunction = ()\
            \ => {\n  let eligible = true;\n      for ( let i=0; i<getAllCompletedEncounters.length;\
            \ i++) {\n          if ( getAllCompletedEncounters[i] === \"\"Record Anthropometry\
            \ details\"\" ) return eligible = false;\n      }\n      return eligible;\n\
            \  };\n  \n//   console.log('getAllCompletedEncounters--------->',getAllCompletedEncounters);\n\
            //   console.log('comparisonFunction--------->',comparisonFunction());\n\
            \  \n  if(lmpDefined && !deliveryEncPresent){\n    const earliestDate\
            \ = moment(individual.getObservationReadableValue('1404c12e-face-4aec-a30a-2a2ac0648ac2')).add(0,\
            \ 'days').toDate();\n    const maxDate = moment(individual.getObservationReadableValue('1404c12e-face-4aec-a30a-2a2ac0648ac2')).add(15,\
            \ 'days').toDate();\n    scheduleBuilder.add({name: \"\"Delivery\"\",\
            \ encounterType: \"\"Delivery\"\", earliestDate, maxDate});  \n}\n   \
            \ if( condition12 && comparisonFunction() ){\n    const earliestDate =\
            \ moment(individual.registrationDate).add(0, 'days').toDate();\n    const\
            \ maxDate = moment(individual.registrationDate).add(3, 'days').toDate();\n\
            \    scheduleBuilder.add({name: \"\"Record Anthropometry details\"\",\
            \ encounterType: \"\"Record Anthropometry details\"\", earliestDate, maxDate});\
            \  \n}\n  \n  return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const programEncounter\
            \ = params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.ageInMonths.lessThanOrEqualTo(15).matches();\n\
            \  const dateOfBirth = programEncounter.programEnrolment.individual.dateOfBirth;\n\
            \  \n  if(condition11 ){\n    const earliestDate = moment(dateOfBirth).add(365,\
            \ \"\"days\"\").toDate(); // Use dateOfBirth\n    const maxDate = moment(dateOfBirth).add(385,\
            \ \"\"days\"\").toDate(); // Use dateOfBirth\n    scheduleBuilder.add({\
            \ name: \"\"12 Month child metadata\"\", encounterType: \"\"Child Metadata\
            \ 12M\"\", earliestDate, maxDate });\n  }\n  \n  return scheduleBuilder.getAll();\n\
            };\n\"\nProgramEncounter,\"\"\"use strict\"\";\n({ params, imports })\
            \ => {\n    const programEncounter = params.entity;\n    const moment\
            \ = imports.moment;\n    const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\
            \ programEncounter });\n\n    const activeInMotherProgram = !programEncounter.programEnrolment.programExitDateTime;\n\
            \n    const _ = imports.lodash;\n\n    const existingEncounters = programEncounter.programEnrolment.getEncountersOfType(\"\
            \"Mental health and social support\"\");\n    \n    const alreadyScheduled\
            \ = existingEncounters.some(enc => enc.uuid != programEncounter.uuid &&\
            \ enc.encounterDateTime == null)\n\n    function isAlreadyScheduled(existingEncounters,\
            \ earliestDate) {\n        return existingEncounters.some((enc) =>\n \
            \           enc.voided === false &&\n            moment(enc.earliestVisitDateTime).isSame(earliestDate,\
            \ 'day')\n        );\n    }\n\n    const deliveryEncounters = programEncounter.programEnrolment.individual\n\
            \        .getEncounters(true)\n        .filter(enc => enc.encounterType.name\
            \ === \"\"Delivery\"\")\n        .map(enc => enc.getObservationValue(\"\
            \"13eb9132-480f-4e7b-a89f-53c26dc5447d\"\"));\n\n    function getEncounterName(years)\
            \ {\n        if (years === 1) return \"\"12 Month Women Follow-up form\"\
            \";\n        if (years === 2) return \"\"24 Month Women Follow-up form\"\
            \";\n       \n        return `${years}Y Women Follow-up form`;\n    }\n\
            \    \n    if(!alreadyScheduled && activeInMotherProgram && deliveryEncounters.length\
            \ > 0){\n        const existingEncountersLength = existingEncounters.length;\n\
            \        let latestEncounter = existingEncounters[existingEncountersLength\
            \ - 1];\n        if(latestEncounter.encounterDateTime != null) {\n   \
            \         latestEncounter = existingEncounters[0];\n        }\n      \
            \  \n        const dateOfDelivery = moment(deliveryEncounters[0]);\n \
            \       if(programEncounter.name == '3rd month mental health and social\
            \ support') {\n            const earliestDate = dateOfDelivery.clone().add(180,\
            \ \"\"days\"\");\n            if(!isAlreadyScheduled(existingEncounters,\
            \ earliestDate)){\n                scheduleBuilder.add({\n           \
            \         name: \"\"Record 6th month mental health and social support\
            \ details\"\",\n                    encounterType: programEncounter.encounterType.name,\n\
            \                    earliestDate: earliestDate.toDate(),\n          \
            \          maxDate: earliestDate.clone().add(15, \"\"days\"\").toDate()\n\
            \                });\n            }\n        }\n        else if(latestEncounter.name\
            \ == programEncounter.name){\n            const noConscent = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"\
            \"d8581767-8ef2-4ef4-8324-9474e0032cf7\"\").containsAnswerConceptName(\"\
            \"1e8059b5-06d9-4121-9ef9-4bb6da5b06a9\"\").matches();\n            const\
            \ isHealthStatusDefined = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"\
            \"72ead993-4a80-4e96-86dc-44d48dc868e9\"\").defined.matches();\n     \
            \       const isWomenDead = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"\
            \"72ead993-4a80-4e96-86dc-44d48dc868e9\"\").containsAnswerConceptName(\"\
            \"3891a42a-61f8-4948-b501-476a54c3963c\"\").matches();\n            if(existingEncountersLength\
            \ <= 3 || (existingEncountersLength > 3 && (noConscent || (isHealthStatusDefined\
            \ && !isWomenDead)))){\n\n                const year = existingEncountersLength\
            \ - 1;\n                const encounterName = getEncounterName(year);\n\
            \                \n                const earliestDate = dateOfDelivery.clone().add(year,\
            \ \"\"year\"\");\n                if(!isAlreadyScheduled(existingEncounters,\
            \ earliestDate)){\n                    scheduleBuilder.add({\n       \
            \                 name: encounterName,\n                        encounterType:\
            \ programEncounter.encounterType.name,\n                        earliestDate:\
            \ earliestDate.toDate(),\n                        maxDate: earliestDate.clone().add(15,\
            \ \"\"days\"\").toDate()\n                    });\n                }\n\
            \            }\n        }\n    }\n\n    return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounter,\"\"\"use strict\"\";\n({ params, imports }) =>\
            \ {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.latestValueInAllEncounters(\"\
            \"cb4952df-4be8-42d4-afab-ca89ee3f2be6\"\").defined.matches();\n  \n \
            \ if(condition11 ){\n    const earliestDate = moment(programEncounter.programEnrolment.enrolmentDateTime).add(700,\
            \ 'days').toDate();\n    const maxDate = moment(programEncounter.programEnrolment.enrolmentDateTime).add(740,\
            \ 'days').toDate();\n    scheduleBuilder.add({name: \"\"24M Substance\
            \ use follow-up\"\", encounterType: \"\"Substance use follow up\"\", earliestDate,\
            \ maxDate});  \n}\n  \n  return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\
            \"\"use strict\"\";\n\n({ params, imports }) => {\n  const programEncounter\
            \ = params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({ programEncounter });\n\
            \n  const condition11 = new imports.rulesConfig.RuleCondition({ programEncounter\
            \ })\n    .when\n    .valueInEncounter(\"\"850ec947-aefe-41d6-a5e4-adbcfd467b4b\"\
            \")\n    .containsAnswerConceptName(\"\"d0f42754-27ff-4675-a55f-1716a3887ca0\"\
            \")\n    .matches();\n\n  if (condition11) {\n    const earliestDate =\
            \ moment(programEncounter.encounterDateTime).add(0, 'days').toDate();\n\
            \    const maxDate = moment(programEncounter.encounterDateTime).add(7,\
            \ 'days').toDate();\n    scheduleBuilder.add({ name: \"\"Ancillary care\"\
            \", encounterType: \"\"ancillary care\"\", earliestDate, maxDate });\n\
            \  }\n\n  const encounterScheduler = [\n        {\"\"name\"\": \"\"Record\
            \ 6th month morbidity\"\",\"\"encName\"\":'Morbidity assessment', \"\"\
            earliest\"\": 180, \"\"max\"\": 195},\n        {\"\"name\"\": \"\"Record\
            \ 12th month morbidity\"\",\"\"encName\"\":'Morbidity assessment', \"\"\
            earliest\"\": 365, \"\"max\"\": 380},\n        {\"\"name\"\": \"\"Record\
            \ 18th month morbidity\"\",\"\"encName\"\":'Morbidity assessment', \"\"\
            earliest\"\": 545, \"\"max\"\": 360},\n        {\"\"name\"\": \"\"Record\
            \ 2nd year morbidity\"\",\"\"encName\"\":'Morbidity assessment', \"\"\
            earliest\"\": 730, \"\"max\"\":745 },        \n    ];\n    \n    let schedule\
            \ = _.chain(encounterScheduler)\n                  .filter(e => (programEncounter.programEnrolment.hasEncounter('Morbidity\
            \ assessment', e.name)) === false)\n                  .first()\n     \
            \             .value();\n  \n   const getEnc = programEncounter.programEnrolment.getEncounters(true);\n\
            \   const getAllCompletedEncounters = _.chain(getEnc)\n   .filter(e =>\
            \ e.encounterDateTime != null)\n  .map(e => e.name)\n  .value();\n  \n\
            \  const comparisonFunction = () => {\n  let eligible = true;\n      for\
            \ ( let i=0; i<getAllCompletedEncounters.length; i++) {\n          if\
            \ ( getAllCompletedEncounters[i] === programEncounter.name ) return eligible\
            \ = false;\n      };\n      return eligible;\n  }; \n    \n   if ( !_.isEmpty(schedule)\
            \ && comparisonFunction() ) {\n\n   scheduleBuilder\n            .add({\n\
            \                name: schedule.name,\n                encounterType:\
            \ schedule.encName,\n                earliestDate:  moment(programEncounter.encounterDateTime).add(schedule.earliest,\
            \ 'days').toDate() ,\n                maxDate: moment(programEncounter.encounterDateTime).add(schedule.max,\
            \ 'days').toDate()\n            });\n\n   }\n\n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEnrolment,\"\"\"use strict\"\";\n\n({ params, imports })\
            \ => {\n  const programEnrolment = params.entity;\n  const moment = imports.moment;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\
            \ programEnrolment });\n\n  const condition12 = new imports.rulesConfig.RuleCondition({\
            \ programEnrolment }).when.lowestAddressLevel.defined.matches();\n\n \
            \ const completedEncounterNames = _.chain(programEnrolment.getEncounters(true))\n\
            \    .filter(enc => enc.encounterDateTime != null)\n    .map(e => e.name)\n\
            \    .value();\n\n  const isEligibleForEncounter = (encounterType) =>\
            \ {\n    return !completedEncounterNames.includes(encounterType); // Check\
            \ for completed encounters with the same type\n  };\n\n  if (condition12\
            \ && isEligibleForEncounter(\"\"Record mother anthropometry details\"\"\
            )) {\n    const earliestDate = moment(programEnrolment.enrolmentDateTime).add(0,\
            \ 'days').toDate();\n    const maxDate = moment(programEnrolment.enrolmentDateTime).add(8,\
            \ 'days').toDate();\n    scheduleBuilder.add({name: \"\"Record mother\
            \ baseline anthropometry details\"\", encounterType: \"\"Record mother\
            \ anthropometry details\"\", earliestDate, maxDate});  \n}\n\n  const\
            \ deliveryDate = programEnrolment.individual.getEncounters(true)\n   \
            \ .filter(enc => enc.encounterType.name === 'Delivery')\n    .map(enc\
            \ => enc.getObservationValue('13eb9132-480f-4e7b-a89f-53c26dc5447d'))[0];\
            \ // Extract first date\n\n  if (condition12 && isEligibleForEncounter(\"\
            \"Mental health and social support\"\") && deliveryDate) {\n    const\
            \ earliestDate = moment(deliveryDate).add(90, \"\"days\"\").toDate();\n\
            \    const maxDate = moment(deliveryDate).add(110, \"\"days\"\").toDate();\n\
            \    scheduleBuilder.add({ name: \"\"3rd month mental health and social\
            \ support\"\", encounterType: \"\"Mental health and social support\"\"\
            , earliestDate, maxDate });\n  }\n  \n  if (condition12 && isEligibleForEncounter(\"\
            \"Food recall 24 hours\"\") && deliveryDate) {\n    const earliestDate\
            \ = moment(deliveryDate).add(90, \"\"days\"\").toDate();\n    const maxDate\
            \ = moment(deliveryDate).add(110, \"\"days\"\").toDate();\n    scheduleBuilder.add({\
            \ name: \"\"3rd month 24H food recall (Mother)\"\", encounterType: \"\"\
            Food recall 24 hours\"\", earliestDate, maxDate });\n  }  \n\n  return\
            \ scheduleBuilder.getAll();\n};\n\"\nProgramEncounter,\"\"\"use strict\"\
            \";\n({params, imports}) => {\n    const programEncounter = params.entity;\n\
            \    const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\n\
            \        programEncounter\n    });\n    const moment = imports.moment;\n\
            \    const _ = imports.lodash;\n\n    const earliestDate = moment(programEncounter.earliestVisitDateTime).add(1,\
            \ 'month').startOf('month').toDate();\n    let isEditScenario = programEncounter.programEnrolment.encounters.some((enc)\
            \ =>\n        enc.encounterType.name === 'Growth Monitoring' &&\n    \
            \    enc.voided === false &&\n        imports.moment(enc.earliestVisitDateTime).isSame(earliestDate,\
            \ 'day')\n    );\n\n    if(programEncounter.programEnrolment.individual.getAgeInYears()\
            \ < 5 && !isEditScenario) {\n        scheduleBuilder.add({\n         \
            \   name: 'Growth Monitoring',\n            encounterType: 'Growth Monitoring',\n\
            \            earliestDate: earliestDate,\n            maxDate:  moment(earliestDate).endOf('month').toDate()\n\
            \        });\n    }\n\n\n\n    const isTreatmentNotAtHome = programEncounter.getObservationReadableValue(\"\
            \"What is the treatment advise for the SAM/MAM/GF2 child?\"\") ? programEncounter.getObservationReadableValue(\"\
            \"What is the treatment advise for the SAM/MAM/GF2 child?\"\") != \"\"\
            Treatment at home\"\" : false;\n    const isTreatmentAtHome = programEncounter.getObservationReadableValue(\"\
            \"What is the treatment advise for the SAM/MAM/GF2 child?\"\") ? programEncounter.getObservationReadableValue(\"\
            \"What is the treatment advise for the SAM/MAM/GF2 child?\"\") == \"\"\
            Treatment at home\"\" : false;\n    const isSAM = programEncounter.getObservationReadableValue(\"\
            \"Nutritional Status\"\") == \"\"SAM\"\";\n    const isGF1 = programEncounter.getObservationReadableValue(\"\
            \"Growth Faltering\"\") == \"\"GF1\"\";\n           \n    if((isTreatmentNotAtHome\
            \ && !isEditScenario) || (isSAM && !isEditScenario) ){\n        scheduleBuilder.add({\n\
            \            name: 'QRT Child',\n            encounterType: 'QRT Child',\n\
            \            earliestDate: moment(programEncounter.encounterDateTime).startOf('day').toDate(),\n\
            \            maxDate: moment(programEncounter.encounterDateTime).add(30,\
            \ 'days').endOf('day').toDate()\n        });\n    }else if ((isTreatmentAtHome\
            \ || isGF1 ) && !isEditScenario && !isSAM){\n        scheduleBuilder.add({\n\
            \            name: 'Child Home Visit',\n            encounterType: 'Child\
            \ Home Visit',\n            earliestDate: moment(programEncounter.encounterDateTime).add(15,\
            \ 'days').startOf('day').toDate(),\n            maxDate: moment(programEncounter.encounterDateTime).add(22,\
            \ 'days').endOf('day').toDate()\n        });\n    }\n        return scheduleBuilder.getAll();\n\
            \    };\"\nProgramEncounter,\"\"\"use strict\"\";\n({ params, imports\
            \ }) => {\n    const programEncounter = params.entity;\n    const moment\
            \ = imports.moment;\n    const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \    const encounterType = programEncounter.encounterType.name;\n\n  \
            \  const isActiveInProgram = !programEncounter.programEnrolment.programExitDateTime;\n\
            \n    const pncVistFrequency = {\n        'PNC Followup 1': {nextFollowupName:\
            \ 'PNC Followup 2', delimeter: 'day', value: 7},\n        'PNC Followup\
            \ 2': {nextFollowupName: 'PNC Followup 3', delimeter: 'day', value: 14},\n\
            \        'PNC Followup 3': {nextFollowupName: 'PNC Followup 4', delimeter:\
            \ 'day', value: 21},\n        'PNC Followup 4': {nextFollowupName: 'PNC\
            \ Followup 5', delimeter: 'day', value: 28},\n        'PNC Followup 5':\
            \ {nextFollowupName: 'PNC Followup 6', delimeter: 'day', value: 42},\n\
            \        'PNC Followup 6': {nextFollowupName: 'PNC Followup 7', delimeter:\
            \ 'month', value: 3},\n        'PNC Followup 7': {nextFollowupName: 'PNC\
            \ Followup 8', delimeter: 'month', value: 4},\n        'PNC Followup 8':\
            \ {nextFollowupName: 'PNC Followup 9', delimeter: 'month', value: 5},\n\
            \        'PNC Followup 9': {nextFollowupName: 'PNC Followup 10', delimeter:\
            \ 'month', value: 6}\n    }\n\n    const currentProgramEncounterName =\
            \ programEncounter.name;\n    const nextVisitObj = pncVistFrequency[currentProgramEncounterName];\n\
            \n    const existingEncounters = programEncounter.programEnrolment.getEncountersOfType(\"\
            \"Delivery\"\");\n\n    let dateOfDelivery = null;\n\n    if(existingEncounters\
            \ && existingEncounters.length > 0) {\n        dateOfDelivery = existingEncounters[0].getObservationReadableValue('5f9a5098-d052-4843-8e13-0c1f455490fc');\n\
            \    }\n    function isAlreadyScheduled(nextVisitName, earliestDate) {\
            \    \n        const nextVisitDate = moment(earliestDate);\n        const\
            \ existingEncounters = programEncounter.programEnrolment.getEncountersOfType(encounterType);\n\
            \        return existingEncounters.some((enc) =>\n            enc.voided\
            \ == false &&\n            (enc.name == nextVisitName ||\n           \
            \ moment(enc.earliestVisitDateTime).isSame(nextVisitDate, 'day'))\n  \
            \      );\n    }\n\n    if(isActiveInProgram && nextVisitObj && dateOfDelivery){\n\
            \        const earliestDate = moment(dateOfDelivery).add(nextVisitObj.value,\
            \ nextVisitObj.delimeter).startOf('day').toDate();\n        const maxDate\
            \ = moment(earliestDate).add(10, 'days').endOf('day').toDate();\n    \
            \    \n        if (!isAlreadyScheduled(nextVisitObj.nextFollowupName,\
            \ earliestDate)) {\n            scheduleBuilder.add({name: nextVisitObj.nextFollowupName,\
            \ encounterType: encounterType, earliestDate, maxDate});  \n        }\n\
            \    }\n    \n    return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n    const programEncounter\
            \ = params.entity;\n    const moment = imports.moment;\n    const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \    \n    const isActiveInProgram = !programEncounter.programEnrolment.programExitDateTime;\n\
            \n    const isPNCAlreadyScheduled = programEncounter.programEnrolment.getEncountersOfType(\"\
            \"PNC\"\").length > 0;\n    \n    if(isActiveInProgram && !isPNCAlreadyScheduled){\n\
            \        const dateOfDelivery = programEncounter.getObservationReadableValue('5f9a5098-d052-4843-8e13-0c1f455490fc');\n\
            \        const earliestDate = moment(dateOfDelivery).add(2, 'days').startOf('day').toDate();\n\
            \        const maxDate = moment(earliestDate).add(10, 'days').endOf('day').toDate();\n\
            \        scheduleBuilder.add({name: \"\"PNC Followup 1\"\", encounterType:\
            \ \"\"PNC\"\", earliestDate, maxDate});  \n    }\n    \n    return scheduleBuilder.getAll();\n\
            };\"\nProgramEnrolment,\"\"\"use strict\"\";\n({ params, imports }) =>\
            \ {\n    const programEnrolment = params.entity;\n    const moment = imports.moment;\n\
            \    const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEnrolment});\n\
            \n    const isDeliveryNotDone = new imports.rulesConfig.RuleCondition({programEnrolment}).when.valueInEnrolment(\"\
            \"c8ac7466-f74b-45ed-9207-622bd2f86a89\"\").containsAnswerConceptName(\"\
            \"30ade50e-fef5-4de1-9a6b-965cc66132ba\"\").matches();\n    \n    const\
            \ isDeliveryFormNotFilled = programEnrolment.getEncountersOfType(\"\"\
            Delivery\"\").length == 0;\n\n    const isANCAlreadyScheduled = programEnrolment.getEncountersOfType(\"\
            \"ANC - Follow Up\"\").length > 0;\n    \n    if(isDeliveryNotDone &&\
            \ isDeliveryFormNotFilled && !isANCAlreadyScheduled){\n        const earliestDate\
            \ = moment(programEnrolment.enrolmentDateTime).add(0, 'days').toDate();\n\
            \        const maxDate = moment(programEnrolment.enrolmentDateTime).add(10,\
            \ 'days').toDate();\n        scheduleBuilder.add({name: \"\"ANC - Follow\
            \ Up\"\", encounterType: \"\"ANC - Follow Up\"\", earliestDate, maxDate});\
            \  \n    }\n    \n    return scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const programEncounter\
            \ = params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const encounterType = programEncounter.encounterType.name;\n\n\
            \  const isActiveInProgram = !programEncounter.programEnrolment.programExitDateTime;\n\
            \  \n  let deliveryEncounters = programEncounter.programEnrolment.getEncountersOfType('Delivery');\n\
            \  \n  if(deliveryEncounters.length == 0 && isActiveInProgram){\n    const\
            \ earliestDate = moment(programEncounter.encounterDateTime).add(30, 'days').toDate();\n\
            \    const maxDate = moment(earliestDate).add(10, 'days').toDate();\n\
            \    scheduleBuilder.add({name: \"\"ANC - Follow Up\"\", encounterType:\
            \ \"\"ANC - Follow Up\"\", earliestDate, maxDate});  \n  }\n  \n  return\
            \ scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\"\"use strict\"\
            \";\n({ params, imports }) => {\n    const programEncounter = params.entity;\n\
            \    const moment = imports.moment;\n    const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \    \n    const isActiveInProgram = !programEncounter.programEnrolment.programExitDateTime;\n\
            \    const isAlreadyScheduled = programEncounter.programEnrolment.getEncountersOfType(\"\
            \"Community Hb Screening - Follow Up\"\").length > 0;\n    \n    if(isActiveInProgram\
            \ && !isAlreadyScheduled){\n        const earliestDate = moment(programEncounter.encounterDateTime).add(3,\
            \ 'month').startOf('day').toDate();\n        const maxDate = moment(earliestDate).add(10,\
            \ 'days').endOf('day').toDate();\n        scheduleBuilder.add({name: \"\
            \"Community Followup 1\"\", encounterType: \"\"Community Hb Screening\
            \ - Follow Up\"\", earliestDate, maxDate});  \n    }\n    \n    return\
            \ scheduleBuilder.getAll();\n};\"\nProgramEncounter,\"\"\"use strict\"\
            \";\n({ params, imports }) => {\n    const programEncounter = params.entity;\n\
            \    const moment = imports.moment;\n    const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \n    const encounterType = programEncounter.encounterType.name;\n\n \
            \   const isActiveInProgram = !programEncounter.programEnrolment.programExitDateTime;\n\
            \n    const baseDate = programEncounter.encounterDateTime;\n\n    function\
            \ isAlreadyScheduled(nextVisitName, earliestDate) {    \n        const\
            \ nextVisitDate = moment(earliestDate);\n        const existingEncounters\
            \ = programEncounter.programEnrolment.getEncountersOfType(encounterType);\n\
            \        return existingEncounters.some((enc) =>\n            enc.voided\
            \ == false &&\n            (enc.name == nextVisitName ||\n           \
            \ moment(enc.earliestVisitDateTime).isSame(nextVisitDate, 'day'))\n  \
            \      );\n    }\n\n    function getNextVisitName(currentVisitName) {\n\
            \        const match = currentVisitName.match(/^Community Followup (\\\
            d+)$/);\n        if (match) {\n            const nextNumber = parseInt(match[1],\
            \ 10) + 1;\n            return `Community Followup ${nextNumber}`;\n \
            \       }\n        return null;\n    }\n    \n    const nextVisitName\
            \ = getNextVisitName(programEncounter.name);\n\n    if(isActiveInProgram){\n\
            \        const earliestDate = moment(baseDate).add(3, 'month').startOf('day').toDate();\n\
            \        const maxDate = moment(earliestDate).add(10, 'days').endOf('day').toDate();\n\
            \        \n        if (!isAlreadyScheduled(nextVisitName, earliestDate))\
            \ {\n            scheduleBuilder.add({name: nextVisitName, encounterType:\
            \ encounterType, earliestDate, maxDate});  \n        }\n    }\n    \n\
            \    return scheduleBuilder.getAll();\n};\"\nEncounter,\"\"\"use strict\"\
            \";\n({ params, imports }) => {\n  const encounter = params.entity;\n\
            \  const moment = imports.moment;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({encounter});\n\
            \  \n  const encounterType = encounter.encounterType.name;\n\n  const\
            \ baseDate = encounter.encounterDateTime;\n\n  function isAlreadyScheduled(nextVisitName,\
            \ earliestDate) {\n    const nextVisitDate = moment(earliestDate).startOf('day');\n\
            \    const existingEncounters = encounter.individual.encounters || [];\n\
            \    existingEncounters.forEach(enc => {\n      const name = enc.name.trim();\n\
            \      const date = enc.earliestVisitDateTime ? moment(enc.earliestVisitDateTime).format('YYYY-MM-DD')\
            \ : 'N/A';\n    });\n\n    return existingEncounters.some((enc) => {\n\
            \      const encounterName = enc.name.trim();\n      const scheduledDate\
            \ = enc.earliestVisitDateTime\n        ? moment(enc.earliestVisitDateTime).startOf('day')\n\
            \        : null;\n\n      return (\n        enc.voided === false &&\n\
            \        (\n          encounterName === nextVisitName ||\n          (scheduledDate\
            \ && scheduledDate.isSame(nextVisitDate, 'day')) \n        )\n      );\n\
            \    });\n  }\n\n  function getNextVisitName(currentVisitName) {\n   \
            \   const match = currentVisitName.match(/^Community Followup (\\d+)$/);\n\
            \      if (match) {\n          const nextNumber = parseInt(match[1], 10)\
            \ + 1;\n          return `School Health - Screening Follow up ${nextNumber}`;\n\
            \      }\n      return null;\n  }\n\n  const dob = encounter.individual.dateOfBirth;\n\
            \  const today = moment();\n  const ageInYears = moment(today).diff(moment(dob),\
            \ 'years', true);  // accurate decimal age\n\n  const isAgeEligible =\
            \ ageInYears >= 5 && ageInYears <= 19;\n  \n  const nextVisitName = getNextVisitName(encounter.name);\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({encounter}).when.valueInEncounter(\"\
            \"3f1d701c-9c33-46dd-9143-b56e06fc495b\"\").containsAnyAnswerConceptName(\"\
            \"0a7fd778-3eb1-425d-8064-7b3f5a1b9463\"\",\"\"3757eb2a-8eae-48b1-9469-37bbd59dda35\"\
            \",\"\"cb5b6fe3-bd8b-434e-ac8b-9ef7b324c8aa\"\",\"\"254ceb8a-760f-4230-b821-48535ac7a8c4\"\
            \").matches();\n  \n  if(condition11 && isAgeEligible) {\n    const earliestDate\
            \ = moment(encounter.encounterDateTime).add(3, 'month').toDate();\n  \
            \  const maxDate = moment(earliestDate).add(10, 'days').toDate();\n  \
            \  \n    if (!isAlreadyScheduled(nextVisitName, earliestDate)) { \n  \
            \    scheduleBuilder.add({name: nextVisitName, encounterType: encounterType,\
            \ earliestDate, maxDate});  \n    }\n  }\n  \n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounter,\"\"\"use strict\"\";\n({params, imports}) => {\n\
            \    const programEncounter = params.entity;\n    const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({\n        programEncounter\n\
            \    });\n\n    let dateOfFollowup = imports.moment(programEncounter.encounterDateTime).add(15,\
            \ 'days');    \n    \n    let isEditScenario = programEncounter.programEnrolment.encounters.some((enc)\
            \ => \n    enc.encounterType.name === 'PW Home Visit' && \n    enc.voided\
            \ === false && \n    imports.moment(enc.earliestVisitDateTime).isSame(dateOfFollowup,\
            \ 'day')\n    );\n\n    if (dateOfFollowup && !isEditScenario ) {\n  \
            \      scheduleBuilder\n            .add({\n                name: \"\"\
            PW Home Visit\"\",\n                encounterType: \"\"PW Home Visit\"\
            \",\n                earliestDate: imports.moment(dateOfFollowup).startOf('day').toDate(),\n\
            \                maxDate: imports.moment(dateOfFollowup).add(7, 'days').endOf('day').toDate()\n\
            \            });\n    }\n    return scheduleBuilder.getAll();\n};\"\n\
            ProgramEncounter,\"\"\"use strict\"\";\n({ params, imports }) => {\n \
            \ const programEncounter = params.entity;\n  const moment = imports.moment;\n\
            \  const _ = imports.lodash;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\n\
            \    programEncounter\n  });\n  \n  const nextScheules = {\n    3: {'nextInterval':\
            \ 7, 'encounterNo': 2},\n    7: {'nextInterval': 14, 'encounterNo': 3},\n\
            \    14: {'nextInterval': 21, 'encounterNo': 4},\n    21: {'nextInterval':\
            \ 28, 'encounterNo': 5},\n    28: {'nextInterval': 42, 'encounterNo':\
            \ 6}\n  }\n  \n  const currentEncounterEarliestVisitDateTime = moment(programEncounter.earliestVisitDateTime);\n\
            \  const allEncounters = programEncounter.programEnrolment.getEncounters();\n\
            \  const deliveryEncounter = allEncounters.filter((enc) => enc.encounterType.name\
            \ == 'Delivery')[0];\n  const dateOfDelivery = deliveryEncounter.getObservationValue('f72ec1db-50d5-409e-883a-421825fbebb5');\n\
            \  const currentInterval = currentEncounterEarliestVisitDateTime.diff(moment(dateOfDelivery),\
            \ 'days');\n  const nextInterval = nextScheules[currentInterval];\n\n\
            \  function isNextEncounterAlreadyExist(encounters, nextEncounterEarliestVisitDateTime)\
            \ { \n    return encounters.filter((enc) => moment(enc.earliestVisitDateTime).isSame(nextEncounterEarliestVisitDateTime,\
            \ 'day')).length === 1;\n  }\n\n  if(nextInterval){\n    \n    const pncEncounters\
            \ = allEncounters.filter((enc) => enc.encounterType.name == 'PNC');\n\n\
            \    if(pncEncounters.length < 6){\n      \n      const earliestDate =\
            \ moment(dateOfDelivery).add(nextInterval['nextInterval'], 'days').toDate();\
            \ \n      const alreadyExist = isNextEncounterAlreadyExist(pncEncounters,\
            \ earliestDate);\n\n      if(!alreadyExist){\n        const maxDate =\
            \ moment(earliestDate).add(2, 'days').endOf('day').toDate();\n       \
            \ scheduleBuilder.add({\n          name: \"\"PNC Followup-\"\" + nextInterval['encounterNo'],\
            \ \n          encounterType: \"\"PNC\"\", \n          earliestDate: earliestDate,\
            \ \n          maxDate: maxDate\n        });  \n      }\n    }\n  }\n \
            \ \n  return scheduleBuilder.getAll();\n};\"\nIndividualProfile,\"//SAMPLE\
            \ RULE EXAMPLE\n\"\"use strict\"\";\n({params, imports}) => {\n    const\
            \ individual = params.entity;\n    const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\n\
            \        individual\n    });\n    const moment = imports.moment;\n   \
            \ const _ = imports.lodash;\n\n    const startDate = moment(individual.registrationDate).add(1,\
            \ 'month').startOf('month');\n\n    let isVHSNDAlreadyScheduled = individual.encounters.some((enc)\
            \ =>\n        enc.encounterType.name === 'Supervisor VHSND Visit' &&\n\
            \        enc.voided === false &&\n        moment(enc.earliestVisitDateTime).isSame(startDate,\
            \ 'day')\n    );\n\n    let isGrowthMonitoringAlreadyScheduled = individual.encounters.some((enc)\
            \ =>\n        enc.encounterType.name === 'Supervisor Growth Monitoring\
            \ Session' &&\n        enc.voided === false &&\n        moment(enc.earliestVisitDateTime).isSame(startDate,\
            \ 'day')\n    );\n\n    if(!isVHSNDAlreadyScheduled) {\n        const\
            \ earliestDate = moment(startDate).startOf('month');\n        scheduleBuilder.add({\n\
            \            name: 'Supervisor VHSND Visit',\n            encounterType:\
            \ 'Supervisor VHSND Visit',\n            earliestDate: earliestDate.toDate(),\n\
            \            maxDate:  earliestDate.endOf('month').toDate()\n        });\n\
            \    }\n    if(!isGrowthMonitoringAlreadyScheduled) {\n        const earliestDate\
            \ = moment(startDate).startOf('month');\n        scheduleBuilder.add({\n\
            \            name: 'Supervisor Growth Monitoring',\n            encounterType:\
            \ 'Supervisor Growth Monitoring Session',\n            earliestDate: earliestDate.toDate(),\n\
            \            maxDate:  earliestDate.endOf('month').toDate()\n        });\n\
            \    }\n    \n    return scheduleBuilder.getAll();\n}\"\nEncounter,\"\
            //SAMPLE RULE EXAMPLE\n\"\"use strict\"\";\n({params, imports}) => {\n\
            \    const encounter = params.entity;\n    const scheduleBuilder = new\
            \ imports.rulesConfig.VisitScheduleBuilder({\n        encounter\n    });\n\
            \    const moment = imports.moment;\n    const _ = imports.lodash;\n\n\
            \    const earliestDate = moment(encounter.earliestVisitDateTime).add(1,\
            \ 'month').startOf('month');\n    const currentlyActive= !encounter.individual.voided;\n\
            \n\n  let isAlreadyScheduled = _.some(encounter.individual.encounters,\
            \ (enc) =>\n    enc.encounterType.name === 'Supervisor VHSND Visit' &&\n\
            \    enc.voided === false &&\n    moment(enc.earliestVisitDateTime).isSame(earliestDate,\
            \ 'day')\n);\n\n\n    if(!isAlreadyScheduled && currentlyActive) {\n \
            \       scheduleBuilder.add({\n            name: 'Supervisor VHSND Visit',\n\
            \            encounterType: 'Supervisor VHSND Visit',\n            earliestDate:\
            \ earliestDate.toDate(),\n            maxDate: earliestDate.endOf('month').toDate()\n\
            \        });\n    }\n\n    return scheduleBuilder.getAll();\n}\"\nProgramEncounterCancellation,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n  const programEncounter\
            \ = params.entity;\n  const moment = imports.moment;\n  const _ = imports.lodash;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\n\
            \    programEncounter\n  });\n  \n  const isDeathOrDeliveryOrAbortionOrMigrated\
            \ = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInCancelEncounter(\"\
            \"f0a6eee8-3421-46cb-a500-309127e98231\"\").containsAnyAnswerConceptName(\"\
            \"1c3c9c97-ba3f-46a2-88af-2a4e26dd0039\"\",\"\"1d98de98-c449-4d9f-93ce-f70bb233f509\"\
            \",\"\"83caedd7-16a7-4346-941c-342eadb97c18\"\").matches();\n  \n  console.log('isDeathOrDeliveryOrAbortionOrMigrated-->',\
            \ isDeathOrDeliveryOrAbortionOrMigrated);\n\n  if(!isDeathOrDeliveryOrAbortionOrMigrated){\n\
            \    const nextScheules = {\n      3: {'nextInterval': 7, 'encounterNo':\
            \ 2},\n      7: {'nextInterval': 14, 'encounterNo': 3},\n      14: {'nextInterval':\
            \ 21, 'encounterNo': 4},\n      21: {'nextInterval': 28, 'encounterNo':\
            \ 5},\n      28: {'nextInterval': 42, 'encounterNo': 6}\n    }\n    \n\
            \    const currentEncounterEarliestVisitDateTime = moment(programEncounter.earliestVisitDateTime);\n\
            \    const allEncounters = programEncounter.programEnrolment.getEncounters();\n\
            \    const deliveryEncounter = allEncounters.filter((enc) => enc.encounterType.name\
            \ == 'Delivery')[0];\n    const dateOfDelivery = deliveryEncounter.getObservationValue('f72ec1db-50d5-409e-883a-421825fbebb5');\n\
            \    const currentInterval = currentEncounterEarliestVisitDateTime.diff(moment(dateOfDelivery),\
            \ 'days');\n    const nextInterval = nextScheules[currentInterval];\n\
            \  \n    function isNextEncounterAlreadyExist(encounters, nextEncounterEarliestVisitDateTime)\
            \ { \n      return encounters.filter((enc) => moment(enc.earliestVisitDateTime).isSame(nextEncounterEarliestVisitDateTime,\
            \ 'day')).length === 1;\n    }\n  \n    if(nextInterval){\n      \n  \
            \    const pncEncounters = allEncounters.filter((enc) => enc.encounterType.name\
            \ == 'PNC');\n  \n      if(pncEncounters.length < 6){\n        \n    \
            \    const earliestDate = moment(dateOfDelivery).add(nextInterval['nextInterval'],\
            \ 'days').toDate(); \n        const alreadyExist = isNextEncounterAlreadyExist(pncEncounters,\
            \ earliestDate);\n  \n        if(!alreadyExist){\n          const maxDate\
            \ = moment(earliestDate).add(2, 'days').endOf('day').toDate();\n     \
            \     scheduleBuilder.add({\n            name: \"\"PNC Followup-\"\" +\
            \ nextInterval['encounterNo'], \n            encounterType: \"\"PNC\"\"\
            , \n            earliestDate: earliestDate, \n            maxDate: maxDate\n\
            \          });  \n        }\n      }\n    }\n  }\n  \n  return scheduleBuilder.getAll();\n\
            };\"\nIndividualEncounterCancellation,\"//SAMPLE RULE EXAMPLE\n\"\"use\
            \ strict\"\";\n({params, imports}) => {\n    const encounter = params.entity;\n\
            \    const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\n\
            \        encounter\n    });\n    const moment = imports.moment;\n    const\
            \ _ = imports.lodash;\n\n    const earliestDate = moment(encounter.earliestVisitDateTime).add(1,\
            \ 'month').startOf('month');\n    const currentlyActive= !encounter.individual.voided;\n\
            \n\n     let isAlreadyScheduled = _.some(encounter.individual.encounters,\
            \ (enc) =>\n    enc.encounterType.name === 'Supervisor Growth Monitoring\
            \ Session' &&\n    enc.voided === false &&\n    moment(enc.earliestVisitDateTime).isSame(earliestDate,\
            \ 'day')\n);\n    \n     \n    if(!isAlreadyScheduled && currentlyActive)\
            \ {\n        scheduleBuilder.add({\n            name: 'Supervisor Growth\
            \ Monitoring Session',\n            encounterType: 'Supervisor Growth\
            \ Monitoring Session',\n            earliestDate: earliestDate.toDate(),\n\
            \            maxDate:  earliestDate.endOf('month').toDate()\n        });\n\
            \    }\n\n    return scheduleBuilder.getAll();\n}\"\nProgramEncounter,\"\
            //SAMPLE RULE EXAMPLE\n\"\"use strict\"\";\n({ params, imports }) => {\n\
            \  const programEncounter = params.entity;\n  const scheduleBuilder =\
            \ new imports.rulesConfig.VisitScheduleBuilder({\n    programEncounter\n\
            \  });\n\n  const noPNCEncounters = programEncounter.programEnrolment.encounters.filter((enc)\
            \ => enc.encounterType.name == 'PNC').length == 0;\n  if(noPNCEncounters){\n\
            \    const dateOfDelivery = programEncounter.getObservationValue('f72ec1db-50d5-409e-883a-421825fbebb5');\n\
            \    const earliestDate = imports.moment(dateOfDelivery).add(3, 'Days').toDate();\n\
            \    scheduleBuilder.add({\n      name: 'PNC Followup-1',\n      encounterType:\
            \ 'PNC',\n      earliestDate: earliestDate,\n      maxDate: imports.moment(earliestDate).add(2,\
            \ 'days').endOf('day').toDate()\n    });  \n  }\n  return scheduleBuilder.getAll();\n\
            };\"\nProgramEncounter,\"\"\"use strict\"\";\n({ params, imports }) =>\
            \ {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n\
            \  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"\
            \"055a54be-f12a-4e32-8fbc-aa2560ab88e4\"\").containsAnswerConceptName(\"\
            \"1cb277a5-6666-4482-9108-c9c7737ec505\"\").matches();\n  \n  if(condition11\
            \ ){\n    const earliestDate = moment(programEncounter.encounterDateTime).add(0,\
            \ 'days').toDate();\n    const maxDate = moment(programEncounter.encounterDateTime).add(30,\
            \ 'days').endOf('day').toDate();\n    scheduleBuilder.add({name: \"\"\
            NRC Discharge\"\", encounterType: \"\"NRC Discharge\"\", earliestDate,\
            \ maxDate});  \n}\n  \n  return scheduleBuilder.getAll();\n};\"\nProgramEncounterCancellation,\"\
            \"\"use strict\"\";\n({ params, imports }) => {\n    const programEncounter\
            \ = params.entity;\n    const moment = imports.moment;\n    const scheduleBuilder\
            \ = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n\
            \n    const condition11 = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInCancelEncounter(\"\
            \"f0a6eee8-3421-46cb-a500-309127e98231\"\").containsAnswerConceptName(\"\
            \"f169230d-809b-4d06-9ccb-96586977bb68\"\").matches();\n\nfunction getPWHomeVisitDate(qrtEncounterDate)\
            \ {\n    const intervalInDays = imports.moment(programEncounter.earliestVisitDateTime).diff(imports.moment(qrtEncounterDate),\
            \ 'days');\n\n        let daysToAdd = 0;\n        if (intervalInDays <=\
            \ 15) {\n            daysToAdd = 30;\n        } else if (intervalInDays\
            \ <= 30) {\n            daysToAdd = 45;\n        } else if (intervalInDays\
            \ <= 45) {\n            daysToAdd = 60;\n        }\n\n        return daysToAdd\
            \ !== 0 ? imports.moment(qrtEncounterDate).add(daysToAdd, 'days').toDate()\
            \ : null;\n}\n\n    function getLatestQRTVist() {\n        const lastQRTVisitEncounters\
            \ = programEncounter.programEnrolment.getEncountersOfType('QRT PW', false);\n\
            \        const latestEncounter = _.chain(lastQRTVisitEncounters)\n   \
            \         .filter((encounter) => encounter.encounterDateTime && encounter.voided\
            \ == false)\n            .maxBy((encounter) => encounter.encounterDateTime)\n\
            \            .value();\n        return latestEncounter;\n    }\n    \n\
            \    const cancelledPWHomeVisits = _.chain(\n        programEncounter.programEnrolment.getEncountersOfType('PW\
            \ Home Visit', false))\n    .filter((encounter) => encounter.cancelDateTime)\n\
            \    .some((encounter) => encounter.uuid === programEncounter.uuid)\n\
            \    .value();\n    \n    const qrtEncounter = getLatestQRTVist();\n \
            \   if (qrtEncounter && condition11 && !cancelledPWHomeVisits) {\n   \
            \     \n        const qrtEncounterDate = qrtEncounter ? imports.moment(qrtEncounter.encounterDateTime).toDate()\
            \ : null;\n        const visitDate = getPWHomeVisitDate(qrtEncounterDate);\n\
            \       if(visitDate){\n        scheduleBuilder\n            .add({\n\
            \                name: \"\"PW Home Visit\"\",\n                encounterType:\
            \ \"\"PW Home Visit\"\",\n                earliestDate: imports.moment(visitDate).startOf('day').toDate(),\n\
            \                maxDate: imports.moment(visitDate).add(7, 'days').endOf('day').toDate()\n\
            \            });\n        }\n    }\n\n    return scheduleBuilder.getAll()\n\
            };\"\nProgramEnrolment,\"//SAMPLE RULE EXAMPLE\n\"\"use strict\"\";\n\
            ({params, imports}) => {\n    const programEnrolment = params.entity;\n\
            \    const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\n\
            \        programEnrolment\n    });\n    const moment = imports.moment;\
            \     \n    const earliestDate = moment(programEnrolment.enrolmentDateTime).add(1,\
            \ 'month').startOf('month').toDate();\n\n    if(programEnrolment.individual.getAgeInYears()\
            \ < 5 && !programEnrolment.hasEncounter('Growth Monitoring', 'Growth Monitoring'))\
            \ {\n        scheduleBuilder.add({\n            name: 'Growth Monitoring',\n\
            \            encounterType: 'Growth Monitoring',\n            earliestDate:\
            \ earliestDate,\n            maxDate:  moment(earliestDate).endOf('month').toDate()\n\
            \        });\n    }\n\n    return scheduleBuilder.getAll();\n};\"\nProgramEnrolment,\"\
            \n\"\"use strict\"\";\n({params, imports}) => {\n    const programEnrolment\
            \ = params.entity;\n    const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({\n\
            \        programEnrolment\n    });\n    const moment = imports.moment;\n\
            \    const scheduledOrCompletedEncountersOfType = (type) => {\n      \
            \  const data = programEnrolment.encounters.filter((enc)=> enc.encounterType.name\
            \ === type && enc.voided == false && enc.cancelDateTime == null);\n  \
            \      return data;\n    }\n\n    const condition0 = !programEnrolment.programExitDateTime;\n\
            \    const condition1 = scheduledOrCompletedEncountersOfType('ANC').length\
            \ == 0;\n    let deliveryEncounter = scheduledOrCompletedEncountersOfType('Delivery');\n\
            \    const condition2 = deliveryEncounter.length == 0;\n    const condition3\
            \ = deliveryEncounter.filter(enc=>enc.encounterDateTime != null).length\
            \ == 0;\n\n    if(condition0 && condition1 && condition3){\n        let\
            \ earliestDate = moment(programEnrolment.enrolmentDateTime).add(1,'M').startOf('M');\n\
            \        scheduleBuilder.add({\n            name: 'ANC',\n           \
            \ encounterType: 'ANC',\n            earliestDate: earliestDate.toDate(),\n\
            \            maxDate: moment(earliestDate).endOf('month').toDate()\n \
            \       });\n    }\n    //&& condition2\n    if(condition0 && condition3){\n\
            \        let edd = programEnrolment.getObservationReadableValue(\"\"Estimated\
            \ date of delivery\"\");\n        let earliestDate = moment(edd).subtract(90,'days').toDate();\n\
            \        let maxDate = moment(edd).add(2,'days').toDate();\n        scheduleBuilder.add({\n\
            \            name: 'Delivery',\n            encounterType: 'Delivery',\n\
            \            earliestDate,maxDate\n        });\n    }\n\n\n    return\
            \ scheduleBuilder.getAll();\n};\"\nIndividualEncounterCancellation,\"\
            //SAMPLE RULE EXAMPLE\n\"\"use strict\"\";\n({params, imports}) => {\n\
            \    const encounter = params.entity;\n    const scheduleBuilder = new\
            \ imports.rulesConfig.VisitScheduleBuilder({\n        encounter\n    });\n\
            \    const moment = imports.moment;\n    const _ = imports.lodash;\n\n\
            \    const earliestDate = moment(encounter.earliestVisitDateTime).add(1,\
            \ 'month').startOf('month');\n    const currentlyActive= !encounter.individual.voided;\n\
            \n\n  let isAlreadyScheduled = _.some(encounter.individual.encounters,\
            \ (enc) =>\n    enc.encounterType.name === 'Supervisor VHSND Visit' &&\n\
            \    enc.voided === false &&\n    moment(enc.earliestVisitDateTime).isSame(earliestDate,\
            \ 'day')\n);\n\n\n    if(!isAlreadyScheduled && currentlyActive) {\n \
            \       scheduleBuilder.add({\n            name: 'Supervisor VHSND Visit',\n\
            \            encounterType: 'Supervisor VHSND Visit',\n            earliestDate:\
            \ earliestDate.toDate(),\n            maxDate: earliestDate.endOf('month').toDate()\n\
            \        });\n    }\n\n    return scheduleBuilder.getAll();\n}\"\nEncounter,\"\
            //SAMPLE RULE EXAMPLE\n\"\"use strict\"\";\n({params, imports}) => {\n\
            \    const encounter = params.entity;\n    const scheduleBuilder = new\
            \ imports.rulesConfig.VisitScheduleBuilder({\n        encounter\n    });\n\
            \    const moment = imports.moment;\n    const _ = imports.lodash;\n\n\
            \    const currentlyActive= !encounter.individual.voided;\n    const earliestDate\
            \ = moment(encounter.earliestVisitDateTime).add(1, 'month').startOf('month');\n\
            \     let isAlreadyScheduled = _.some(encounter.individual.encounters,\
            \ (enc) =>\n    enc.encounterType.name === 'Supervisor Growth Monitoring\
            \ Session' &&\n    enc.voided === false &&\n    moment(enc.earliestVisitDateTime).isSame(earliestDate,\
            \ 'day')\n);\n    \n     \n    if(!isAlreadyScheduled && currentlyActive)\
            \ {\n        scheduleBuilder.add({\n            name: 'Supervisor Growth\
            \ Monitoring Session',\n            encounterType: 'Supervisor Growth\
            \ Monitoring Session',\n            earliestDate: earliestDate.toDate(),\n\
            \            maxDate:  earliestDate.endOf('month').toDate()\n        });\n\
            \    }\n\n    return scheduleBuilder.getAll();\n}\"\n\n## Helper Functions\n\
            * [Observation Access Methods](#observation-access-methods)\n  * [`getObservationReadableValue()`](#getobservationreadablevalueconceptnameoruuid-parentconceptnameoruuid)\n\
            \  * [`getObservationValue()`](#getobservationvalueconceptnameoruuid-parentconceptnameoruuid)\n\
            \  * [`findObservation()`](#findobservationconceptnameoruuid-parentconceptnameoruuid)\n\
            \  * [`findLatestObservationInEntireEnrolment()`](#findlatestobservationinentirenrolmentconceptnameoruuid-currentencounter)\n\
            \  * [`hasObservation()`](#hasobservationconceptnameoruuid)\n* [Age and\
            \ Time Calculation Methods](#age-and-time-calculation-methods)\n  * [`getAgeInYears()`](#getageinyearsasondate-precise)\n\
            \  * [`getAgeInMonths()`](#getageinmonthsasondate-precise)\n  * [`getAgeInWeeks()`](#getageinweeksondate-precise)\n\
            \  * [`getAge()`](#getageasondate)\n* [Cancel Encounter Methods](#cancel-encounter-methods)\n\
            \  * [`findCancelEncounterObservation()`](#findcancelencounterobservationconceptnameoruuid)\n\
            \  * [`findCancelEncounterObservationReadableValue()`](#findcancelencounterobservationreadablevalueconceptnameoruuid)\n\
            * [Encounter Navigation Methods](#encounter-navigation-methods)\n  * [`getEncounters()`](#getencountersremovecancelledencounters)\n\
            \  * [`findLatestObservationFromEncounters()`](#findlatestobservationfromencountersconceptnameoruuid-currentencounter)\n\
            \  * [`findLastEncounterOfType()`](#findlastencounteroftypecurrentencounter-encountertypes)\n\
            \  * [`scheduledEncounters()`](#scheduledencounters)\n  * [`scheduledEncountersOfType()`](#scheduledencountersoftypeencountertypename)\n\
            * [Individual and Subject Methods](#individual-and-subject-methods)\n\
            \  * [`isFemale()`](#isfemale)\n  * [`isMale()`](#ismale)\n  * [`isPerson()`](#isperson)\n\
            \  * [`isHousehold()`](#ishousehold)\n  * [`isGroup()`](#isgroup)\n  *\
            \ [`getMobileNumber()`](#getmobilenumber)\n  * [`nameString`](#namestring)\n\
            * [Location and Address Methods](#location-and-address-methods)\n  * [`lowestAddressLevel`](#lowestaddresslevel)\n\
            \  * [`lowestTwoLevelAddress()`](#lowesttwoleveladdressi18n)\n  * [`fullAddress()`](#fulladdressi18n)\n\
            * [Relationship and Group Methods](#relationship-and-group-methods)\n\
            \  * [`getRelatives()`](#getrelativesrelationname-inverse)\n  * [`getRelative()`](#getrelativerelationname-inverse)\n\
            \  * [`getGroups()`](#getgroups)\n  * [`getGroupSubjects()`](#getgroupsubjects)\n\
            * [Validation and Status Methods](#validation-and-status-methods)\n  *\
            \ [`hasBeenEdited()`](#hasbeenedited)\n  * [`isCancelled()`](#iscancelled)\n\
            \  * [`isScheduled()`](#isscheduled)\n  * [`isRejectedEntity()`](#isrejectedentity)\n\
            * [Media and Utility Methods](#media-and-utility-methods)\n  * [`findMediaObservations()`](#findmediaobservations)\n\
            \  * [`getProfilePicture()`](#getprofilepicture)\n  * [`getEntityTypeName()`](#getentitytypename)\n\
            \  * [`toJSON()`](#tojson)"
        - id: vs-prompt-2
          role: user
          text: '{{#sys.query#}} {{#sys.files#}}'
        reasoning_format: tagged
        selected: false
        title: LLM - Visit Schedule
        type: llm
        vision:
          enabled: false
      height: 86
      id: '1732870000003'
      position:
        x: 1251.4050029628945
        y: 900
      positionAbsolute:
        x: 1251.4050029628945
        y: 900
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    - data:
        answer: '{{#1732870000003.text#}}'
        selected: false
        title: Answer - Visit Schedule
        type: answer
        variables: []
      height: 101
      id: '1732870000004'
      position:
        x: 1550
        y: 900
      positionAbsolute:
        x: 1550
        y: 900
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    viewport:
      x: 131.70090220745374
      y: -90.58280630261243
      zoom: 0.6331972201915773
  rag_pipeline_variables: []
